"use strict";var dn=Object.create;var fo=Object.defineProperty;var cn=Object.getOwnPropertyDescriptor;var fn=Object.getOwnPropertyNames;var gn=Object.getPrototypeOf,yn=Object.prototype.hasOwnProperty;var Yo=(o,t)=>{for(var r in t)fo(o,r,{get:t[r],enumerable:!0})},Ce=(o,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of fn(t))!yn.call(o,e)&&e!==r&&fo(o,e,{get:()=>t[e],enumerable:!(n=cn(t,e))||n.enumerable});return o};var g=(o,t,r)=>(r=o!=null?dn(gn(o)):{},Ce(t||!o||!o.__esModule?fo(r,"default",{value:o,enumerable:!0}):r,o)),bn=o=>Ce(fo({},"__esModule",{value:!0}),o);var ei={};Yo(ei,{AutomationCreator:()=>No,AutomationEditor:()=>Bo,AutomationsManager:()=>Yr,BlueprintActivator:()=>Ro,BlueprintsList:()=>Mo,BlueprintsManager:()=>tn,MyAutomations:()=>$o,MyBlueprints:()=>Vo,PoweredByRollout:()=>on,RolloutConnectProvider:()=>pn,components:()=>ge,curlyTemplate:()=>mn.curlyTemplate,defaultTheme:()=>oi});module.exports=bn(ei);var ge={};Yo(ge,{AutomationCreator:()=>No,AutomationEditor:()=>Bo,AutomationsManager:()=>Yr,BlueprintActivator:()=>Ro,BlueprintsList:()=>Mo,BlueprintsManager:()=>tn,MyAutomations:()=>$o,MyBlueprints:()=>Vo,PoweredByRollout:()=>on,RolloutConnectProvider:()=>pn});var so=g(require("react")),Ur=require("@rollouthq/api-client-react");var I=g(require("react")),Qr=require("react"),zr=require("spin-delay"),ko=require("@rollouthq/api-client-react"),le=require("@rollouthq/common");var vo=g(require("react")),Po=require("react"),Jt=require("@rollouthq/common");var Kt={};Yo(Kt,{BooleanInput:()=>On,DropdownInput:()=>In,FindBy:()=>vn,MultiSelectInput:()=>Kn,NoInputsComponent:()=>Nn,RichTextInput:()=>Sn});var M=g(require("react")),_o=require("@rollouthq/common");var yo=g(require("react"));var _e=require("@rollouthq/ui"),[he,$]=(0,_e.createContext)({name:"AppComponentRenderer"});var ve=require("react"),Dt=require("ts-object-path"),Pe=require("@rollouthq/common");var Ae=require("ts-object-path"),Et=require("zod");function Ie(o,t){let r=(0,Ae.getPath)(t);return Ho(o,r)}function Ho(o,t){let r=t.slice(1),n=o instanceof Et.ZodOptional?o.unwrap():o;if(n instanceof Et.ZodObject){let e=n.shape[t[0]];return t.length>1?Ho(e,r):e}if(n instanceof Et.ZodRecord){let e=n.valueSchema;return t.length>1?Ho(e,r):e}throw console.error("getByPath: unhandled prop type:",n),new Error("getByPath: unhandled prop type")}function j(o){let t=$(),{inputParams:r,setInputParams:n,importedData:e,credentialId:i,isBlueprintActivation:a}=t,s=(0,Dt.getPath)(o),l=(0,Dt.get)(r,o),p=(0,ve.useCallback)(S=>{let D=structuredClone(r);(0,Dt.set)(D,o,S),n(D)},[n,r]),d="inputParamsSchema"in e?e.inputParamsSchema:(0,Pe.inputDefToZodObject)(e.inputParamDefs),u=Ie(d,o),f=u.isOptional(),m=u.description,y=(m==null?void 0:m.label)??Cn(s),x=(m==null?void 0:m.description)??"",A=(m==null?void 0:m.isCredentialDependent)??!1,h=d.safeParse(r),B=A&&i==null&&!a?void 0:xn(h,o);return{value:l,setValue:p,isOptional:f,label:y,description:x,isCredentialDependent:A,error:B,path:s}}function xn(o,t){let r=(0,Dt.getPath)(t);if(!o.success)return o.error.issues.find(n=>n.path.join(".")===r.join("."))}function Cn(o){return o.map(t=>_n(t.toString())).join(" ")}function _n(o){let t=o.replace(/([A-Z\d])/g,r=>` ${r.toLowerCase()}`);return`${t[0].toUpperCase()}${t.slice(1)}`}var Tt=g(require("react")),Fe=require("@rollouthq/ui");function go(o){let{label:t,description:r,error:n,isRequired:e,children:i}=o;return Tt.default.createElement("div",{className:"rollout-form-control"},t&&Tt.default.createElement("div",{className:"rollout-form-control__label"},t,e&&Tt.default.createElement("span",{className:"rollout-form-control__required-hint"}," ","(required)")),r&&Tt.default.createElement("div",{className:"rollout-form-control__description"},r),Tt.default.createElement("div",{className:"rollout-form-control__input","data-error":(0,Fe.dataAttr)(!!n)},i),n&&Tt.default.createElement("div",{className:"rollout-form-control__error"},n))}var bo=require("@rollouthq/ui");function lt(o){let{bind:t,children:r,description:n,error:e,isRequired:i=!1}=o,{credentialId:a,isBlueprintActivation:s=!1}=$(),l=j(t),p=l.isCredentialDependent&&a==null&&!s;if(s&&!l.isCredentialDependent)return null;function d(){return p?yo.default.createElement(bo.Flex,{css:{alignItems:"center",padding:"8px",backgroundColor:"$surfaceSecondary",borderRadius:"4px",color:"$grayMedium",fontSize:"13px",fontWeight:500}},yo.default.createElement(bo.UserForm,{css:{marginRight:"6px"}}),"Input provided by user when automation is activated"):r}let u=o.label??"";return yo.default.createElement(go,{description:n,error:e,isRequired:i,label:u},d())}var xo=g(require("react"));var Se=g(require("react"));function De(o){return Se.default.createElement("div",{className:"rollout-card"},o.children)}function k(o){let{defaultField:t,ctx:r,renderer:n}=o;return n==null||n===!0?xo.default.createElement(t,null):n===!1?null:n({...r,createElement:xo.createElement,Card:De})}var Te=require("@rollouthq/ui"),[Co,K]=(0,Te.createContext)({name:"Form"});var Y=require("@rollouthq/ui"),[hn,An]=(0,Y.createContext)({name:"DropdownInput"});function In(o){let r=j(o.bind).path.join("."),{renderInputParams:n}=$(),e=k({defaultField:Ke,renderer:n==null?void 0:n[r],ctx:{InputParamField:Ke}});return M.default.createElement(hn,{value:o},e)}function Ke(o){var C;let t=An(),{bind:r,dependencies:n,fetchOptions:e,allowOnlyVariables:i}=t,a=j(r),{value:s,setValue:l}=a,p=t.label??a.label,d=t.description??a.description,u=t.placeholder||"Select option",[f,m]=(0,M.useState)([]),[y,x]=(0,M.useState)(!1),{shouldShowErrors:A}=K(),{variables:h,disabled:B}=$(),S=t.isDisabled||B||n!=null&&n.every(Boolean)!==!0||o.disabled;(0,M.useEffect)(()=>{async function _(){x(!0);let et=await e();m(et),x(!1)}!i&&!S&&_()},[JSON.stringify(n),i,S]),(0,M.useEffect)(()=>{i&&s&&!(0,_o.isVariable)(s)&&l(void 0)},[i,s]);let D=h.map(_=>({id:`${_o.ROLLOUTHQ_VARIABLE_PREFIX}${_.id}`,name:`@${_.label}`})),N=[...D,...f],E=N.find(_=>_.id===s),Q=M.default.createElement(Y.ComboBox,{"aria-label":"Variable dropdown",optionKey:"id",isDisabled:S,defaultItems:D,menuTrigger:"focus",selectedOption:E,isLoading:y,inputPlaceholder:u,onSelectionChange:_=>l(_==null?void 0:_.id)},M.default.createElement(Y.ComboBoxSection,{title:"Variables"},D.map(_=>M.default.createElement(Y.ComboBoxItem,{key:_.id},_.name)))),ot=M.default.createElement(Y.ComboBox,{"aria-label":"Variable dropdown",optionKey:"id",isDisabled:S,defaultItems:N,menuTrigger:"focus",selectedOption:E,key:s,isLoading:y,inputPlaceholder:u,onSelectionChange:_=>l(_==null?void 0:_.id)},M.default.createElement(Y.ComboBoxSection,{title:"Options"},f.map(_=>M.default.createElement(Y.ComboBoxItem,{key:_.id},_.name))),M.default.createElement(Y.ComboBoxSection,{title:"Variables"},D.map(_=>M.default.createElement(Y.ComboBoxItem,{key:_.id},_.name)))),U=i?Q:ot;return M.default.createElement(lt,{bind:r,label:p,description:d,error:A?(C=a.error)==null?void 0:C.message:void 0,isRequired:!a.isOptional},U)}var ct=g(require("react"));function vn(o){var f;let{filterInput:t,filterValueInput:r,selectInput:n}=o,{bind:e}=o,i=j(e),{shouldShowErrors:a}=K(),{value:s,setValue:l,isOptional:p}=i,d=o.label??i.label,u=o.description??i.description;return(0,ct.useEffect)(()=>{s==null&&l("filter")},[s]),ct.default.createElement(ct.default.Fragment,null,ct.default.createElement(lt,{bind:e,label:d,isRequired:!p,description:u,error:a?(f=i.error)==null?void 0:f.message:void 0},ct.default.createElement("div",{className:"rollout-form-control-find__container"},ct.default.createElement("button",{type:"button","aria-label":"Search from list button",className:s=="select"?"rollout-form-control-find__active":"rollout-form-control-find__disabled",onClick:()=>l("select")},"From list"),ct.default.createElement("button",{type:"button","aria-label":"Search by filter button",className:s=="filter"?"rollout-form-control-find__active":"rollout-form-control-find__disabled",onClick:()=>l("filter")},"From search"))),s=="filter"&&t,s=="filter"&&r,s=="select"&&n)}var ft=g(require("react")),ke=require("@rollouthq/common");var ho=require("@rollouthq/ui"),[Pn,Fn]=(0,ho.createContext)({name:"RichTextInput"});function Sn(o){let r=j(o.bind).path.join("."),{renderInputParams:n}=$(),e=k({defaultField:we,renderer:n==null?void 0:n[r],ctx:{InputParamField:we}});return ft.default.createElement(Pn,{value:o},e)}function we(o){var x;let t=Fn(),{bind:r,inputProps:n,placeholder:e}=t,i=j(r),a=t.label??i.label,s=t.description??i.description,l=$(),{variables:p}=l,{shouldShowErrors:d}=K(),u=l.disabled||t.disabled||o.disabled,f=!i.isOptional||t.isRequired,m=(0,ft.useCallback)(A=>{i.setValue(A??void 0)},[i.setValue]),y=(0,ft.useMemo)(()=>i.value&&(0,ke.resolveMentions)(i.value,p),[i.value,p]);return ft.default.createElement(lt,{bind:r,label:a,isRequired:f,description:s,error:d?(x=i.error)==null?void 0:x.message:void 0},ft.default.createElement("div",{className:"rollout-rich-text-input"},ft.default.createElement(ho.RichEditor,{value:y??null,setValue:m,placeholder:e,formattingEnabled:!1,linksEnabled:!1,mentionVariables:p,isDisabled:u,...n})))}var gt=g(require("react"));var Ao=require("@rollouthq/ui"),[Dn,Tn]=(0,Ao.createContext)({name:"MultiSelectInput"});function Kn(o){let r=j(o.bind).path.join("."),{renderInputParams:n}=$(),e=k({defaultField:Oe,renderer:n==null?void 0:n[r],ctx:{InputParamField:Oe}});return gt.default.createElement(Dn,{value:o},e)}function Oe(o){var B;let t=Tn(),{bind:r,dependencies:n,fetchOptions:e,placeholder:i}=t,a=j(r),s=$(),{value:l,setValue:p}=a,d=t.label??a.label,u=t.description??a.description,f=s.disabled||o.disabled||!(n!=null&&n.every(Boolean)),[m,y]=(0,gt.useState)([]),[x,A]=(0,gt.useState)(!1),{shouldShowErrors:h}=K();return(0,gt.useEffect)(()=>{async function S(){if(A(!0),!f){let D=await e();y(D)}A(!1)}S()},[f]),gt.default.createElement(lt,{bind:r,label:d,description:u,error:h?(B=a.error)==null?void 0:B.message:void 0},gt.default.createElement(Ao.MultiSelect,{label:d,isDisabled:f,items:m,isLoading:x,inputPlaceholder:i||"Select option",onSelectionChange:S=>{p(S.map(D=>D.id).join(", "))},value:l}))}var Io=g(require("react"));var Be=require("@rollouthq/ui"),[wn,kn]=(0,Be.createContext)({name:"BooleanInput"});function On(o){let r=j(o.bind).path.join("."),{renderInputParams:n}=$(),e=k({defaultField:Ne,renderer:n==null?void 0:n[r],ctx:{InputParamField:Ne}});return Io.default.createElement(wn,{value:o},e)}function Ne(o){var f;let t=kn(),{bind:r}=t,n=j(r),{shouldShowErrors:e}=K(),a=$().disabled||o.disabled,{value:s,setValue:l,isOptional:p}=n,d=t.label??n.label,u=t.description??n.description;return Io.default.createElement(lt,{bind:r,label:d,isRequired:!p,description:u,error:e?(f=n.error)==null?void 0:f.message:void 0},Io.default.createElement("input",{type:"checkbox",checked:s,disabled:a,onChange:m=>l(m.target.checked)}))}var Xo=g(require("react")),Nn=()=>Xo.default.createElement(Xo.default.Fragment,null,"No inputs");var Ee=require("react"),$e=g(require("react")),Re=require("@rollouthq/ui"),[Bn,$t]=(0,Re.createContext)({name:"RolloutApiBaseUrlContext"});function Le(o){let{children:t,...r}=o,n=(0,Ee.useMemo)(()=>r,Object.values(r));return $e.default.createElement(Bn,{value:n},t)}var Me=typeof document>"u"?Po.useEffect:vo.useLayoutEffect;function Rt(o){let{apiBaseUrl:t}=$t(),[r,n]=(0,Po.useState)();return Me(()=>{Object.assign(window,{ROLLOUT_CONNECT_DEPS:{zod:{z:Jt.z},react:vo.default,["@rollouthq/common"]:{z:Jt.z,isVariable:Jt.isVariable},["@rollouthq/connect-react/components/action-inputs"]:Kt}})},[]),Me(()=>{if(o==null)return n(void 0);if(!o.appKey||!o.triggerKey)return;let e=`${t}/connect-react/${o.appKey}/triggers/${o.triggerKey}.js`;new Function("path","return import(path)")(e).then(a=>{n(a)})},[JSON.stringify(o)]),r}var Ve=require("react"),je=g(require("react")),Qe=require("@rollouthq/ui"),[En,ze]=(0,Qe.createContext)({name:"RolloutAllowedAppsContextProvider"});function Ue(o){let{children:t,...r}=o,n=(0,Ve.useMemo)(()=>r,Object.values(r));return je.default.createElement(En,{value:n},t)}var qe=require("react"),We=require("@rollouthq/api-client-react");function Ze(o){let t=(0,We.useLazyQuery)("apps.actions");return(0,qe.useEffect)(()=>{(o==null?void 0:o.appKey)!=null&&t.fetch({appKey:o.appKey})},[o==null?void 0:o.appKey]),t}var Ye=require("@rollouthq/api-client-react");function He(o){let{allowedApps:t}=o;return(0,Ye.useQuery)(["apps.list"],{select:t!=null?r=>r.filter(n=>t.includes(n.key)):void 0})}var Ge=g(require("assert")),tr=require("react"),Jo=require("@rollouthq/api-client-react/");var Xe=g(require("popup-centered")),wt=require("react"),Je=require("@rollouthq/api-client-react");function Fo(o){let[t,r]=(0,wt.useState)(null),[n,e]=(0,wt.useState)(),{client:i}=(0,Je.useTRPCContext)();(0,wt.useEffect)(()=>{function s(l){var d;let p=l.data._rollouthq;p!=null&&p.ok?(p==null?void 0:p.type)==="credential-added"&&p.appKey===n&&p.credentialId!=null&&((d=o.onCredentialAdded)==null||d.call(o,p.credentialId)):p!=null&&p.error&&r(p.error)}return window.addEventListener("message",s,!1),()=>{window.removeEventListener("message",s)}},[n]);let a=(0,wt.useCallback)(async s=>{e(s.appKey),r(null);try{let{url:l}=await i.query("oauth.getURL",{appKey:s.appKey,customParams:s.customParams});(0,Xe.default)(l,"",{width:800,height:800})}catch{r("Woops! Something went wrong linking account.")}},[]);return{oauthPopupError:t,openOAuthPopup:a}}function Gt(o){let{appKey:t,setCredentialId:r}=o,{openOAuthPopup:n}=Fo({onCredentialAdded:l=>{r(l),a.refetch()}}),i=(0,Jo.useQuery)(["apps.authInfo",{appKey:t}],{enabled:t!=null}).data,a=(0,Jo.useQuery)(["apps.credentials",{appKey:t,authType:i==null?void 0:i.type}],{enabled:t!=null&&i!=null}),s=a.data;(0,tr.useEffect)(()=>{if(!(i==null||s==null)){if(i.type==="none"||i.type==="apiKey"&&i.singleCredentialOnly){let l=s.length>0;return(0,Ge.default)(l,"No credentials found!"),r(s[0].id)}(i.type==="oauth1"||i.type==="oauth2")&&i.singleCredentialOnly&&(s.length===0?n({appKey:t}):r(s[0].id))}},[i,s])}var vt=require("@rollouthq/ui");var H=g(require("react"));var or=g(require("react"));var er=require("@rollouthq/ui");function O(o){let{apiBaseUrl:t}=$t(),{appKey:r,css:n}=o,e=`${t}/connect-react/${r}/icon`;return or.default.createElement(er.st.img,{key:r,src:e,css:{width:"1em",...n}})}var to=g(require("react")),rr=require("@rollouthq/api-client-react"),nr=require("@rollouthq/ui/"),[$n,So]=(0,nr.createContext)({name:"RolloutEndUserProvider"});function ir(o){var n;let r=(n=(0,rr.useQuery)(["end-users.getInfo"]).data)==null?void 0:n.appKey;return r==null?null:to.default.createElement(Rn,{appKey:r},o.children)}function Rn(o){let{appKey:t}=o,r=(0,to.useMemo)(()=>({appKey:t}),[t]);return to.default.createElement($n,{value:r},o.children)}var Do=require("ts-object-path");function Ct(o,t){if(o.success)return;let r=(0,Do.createProxy)(),n=(0,Do.getPath)(t(r));return o.error.issues.find(e=>e.path.join(".")===n.join("."))}var _t=require("@rollouthq/ui");var ar=require("@rollouthq/ui"),[lr,R]=(0,ar.createContext)({name:"AutomationForm"});function Ln(o){var u,f;let{appKey:t}=So(),{apps:r,data:n,setData:e,validation:i}=R(),{action:a}=n,s=Ct(i,m=>m.action),l=(0,H.useMemo)(()=>{var m;return((m=r.data)==null?void 0:m.filter(y=>y.hasActions))??[]},[r.data]),p=(u=r.data)==null?void 0:u.find(m=>m.key===(a==null?void 0:a.appKey)),{shouldShowErrors:d}=K();return H.default.createElement("div",{className:"rollout-automation-form__action-app"},H.default.createElement("div",{style:{display:"none"}},(f=r.data)==null?void 0:f.map(m=>H.default.createElement(O,{key:m.key,appKey:m.key}))),H.default.createElement(_t.FormControl,{error:d?s==null?void 0:s.message:void 0},H.default.createElement(_t.ComboBox,{"aria-label":"Action dropdown",defaultItems:l,selectedOption:p,isDisabled:o.isDisabled,icon:p==null?void 0:H.default.createElement(O,{appKey:p.key}),inputPlaceholder:"Select app",menuTrigger:"focus",onSelectionChange:m=>e(y=>{var D;if(m==null)return{...y,action:void 0};let x=m.key===t,A=((D=y.trigger)==null?void 0:D.appKey)===t,S=x&&A||!x&&!A;return{...y,action:{appKey:m.key,inputParams:{}},trigger:S?void 0:y.trigger}})},m=>H.default.createElement(_t.ComboBoxItem,{key:m._comboboxKey,textValue:m.name},H.default.createElement(_t.Center,{className:"rollout-listbox__option-icon"},H.default.createElement(O,{appKey:m.key})),m.name))))}function oo(o){return H.default.createElement(Ln,{isDisabled:o.disabled})}var eo=g(require("react")),gr=require("@rollouthq/api-client-react/");var fr=g(require("assert")),P=g(require("react")),To=require("@rollouthq/api-client-react");var z=g(require("react")),ur=require("@rollouthq/api-client-react"),mr=require("@rollouthq/ui");var ht=g(require("react")),sr=require("@rollouthq/ui"),pr=(0,ht.forwardRef)((o,t)=>{let{isTestingConnection:r,value:n,onChange:e}=o,{infoHTML:i,label:a,placeholder:s}=o.definition;return ht.default.createElement("div",null,ht.default.createElement("label",{className:"rollout-automation-form__api-token-input-label"},a),i!=null&&ht.default.createElement("div",{dangerouslySetInnerHTML:{__html:i},className:"rollout-automation-form__api-token-input-info"}),ht.default.createElement("div",null,ht.default.createElement(sr.TextField,{ref:t,className:"rollout-automation-form__api-token-input","aria-label":"Token input text field",isDisabled:r,placeholder:s,value:n,onChange:e})))});function dr(o){let{appKey:t,saveApiToken:r,authType:n,firstApiTokenInput:e,openOAuthPopup:i,closeModal:a,savingApiToken:s}=o,[l,p]=(0,z.useState)({}),[d,u]=(0,z.useState)(!1),[f,m]=(0,z.useState)(!1),[y,x]=(0,z.useState)(!1),A=(0,ur.useMutation)("credentials.test-connection"),h=B();(0,z.useEffect)(()=>{d&&(u(!1),m(!1))},[l]);function B(){return"customParams"in n&&n.customParams!=null?n.customParams.every(Q=>(l==null?void 0:l[Q.key])!=null):!0}function S(){x(!0),A.mutate({appKey:t,apiToken:l},{onSuccess:Q=>{u(!0),m(Q),x(!1)}})}function D(){var Q;if(n==null)return null;if("customParams"in n)return(Q=n.customParams)==null?void 0:Q.map((ot,U)=>z.default.createElement(pr,{key:U,ref:U===0?e:void 0,definition:ot,value:(l==null?void 0:l[ot.key])??"",onChange:C=>p({...l,[ot.key]:C}),isTestingConnection:y}))}let N=()=>{i({appKey:t,customParams:l}),x(!1),a()},E=()=>{f&&l!=null?r(l):S()};return z.default.createElement("div",{className:"rollout-automation-form__api-token-input-container"},D(),(n==null?void 0:n.type)==="apiKey"?z.default.createElement("div",{className:"rollout-automation-form__api-token-apitoken-button-container"},z.default.createElement("button",{type:"button","aria-label":"Save button",disabled:!h||y||s,className:`rollout-button--primary ${y?"rollout-automation-form__api-token-test-button":"rollout-automation-form__api-token-save-button"}`,onClick:E},(y||s)&&z.default.createElement(mr.Spinner,null),d&&f?"Save":y?"Testing Connection ...":"Test Connection"),d&&z.default.createElement("span",{className:"rollout-automation-form__api-token-connection-result"},f?"\u2705 Connection Success":"\u26A0\uFE0F Woops! Check your credentials")):z.default.createElement("button",{type:"button","aria-label":"Save button",disabled:!h||y||s,className:"rollout-button--primary",onClick:N},"Add account"))}var w=require("@rollouthq/ui"),cr={id:"ADD_OPTION",label:"Add new account",avatar:void 0,icon:P.default.createElement(w.Plus,null)};function Mn(o){let{isDisabled:t,appKey:r,setCredentialId:n,credentialId:e,authInfoQuery:i,error:a}=o,{shouldShowErrors:s}=K(),[l,p]=(0,P.useState)(!1),[d,u]=(0,P.useState)(!1),f=(0,To.useMutation)("credentials.add-api-token"),m=(0,To.useQuery)(["apps.credentials",{appKey:r}]),y=(0,P.useRef)(null),x=(0,P.useRef)(null),[A,h]=(0,P.useState)(!1),{openOAuthPopup:B,oauthPopupError:S}=Fo({onCredentialAdded:C=>{n(C),m.refetch()}});(0,P.useEffect)(()=>{p(S!=null)},[S]);let D=(0,P.useMemo)(()=>[...m.data??[],cr],[m.data]),N=D.find(C=>C.id===e),E=A?P.default.createElement(w.GreenPlus,null):N&&N.avatar!=null?P.default.createElement(w.Avatar,{src:N.avatar,name:N.label,alt:N.label}):P.default.createElement(w.Person,null);function Q(C){C!=null&&(u(!0),f.mutate({appKey:r,credential:C},{onSuccess:_=>{var et;h(!1),m.refetch(),(et=x.current)==null||et.blur(),n(_),u(!1)},onError:()=>u(!1)}))}let ot=D,U=ot.find(C=>C.id===e);return P.default.createElement("div",{className:"rollout-automation-form__credentials","data-avatar":!0,"data-selected":(0,w.dataAttr)((N==null?void 0:N.avatar)!=null)},P.default.createElement(w.FormControl,{error:s?a==null?void 0:a.message:void 0},P.default.createElement(w.ComboBox,{"aria-label":"Account dropdown",customRef:x,defaultItems:ot,selectedOption:U,menuTrigger:"focus",icon:E,isDisabled:t,isLoading:m.isFetching||i.isFetching,inputPlaceholder:A?"Connect new account":"Select account",onSelectionChange:C=>{if(C==null)return n(void 0);let _=i.data,et=C===cr;if((0,fr.default)(_!=null,"No app auth info"),et){(_.type==="oauth1"||_.type==="oauth2")&&(_.customParams!=null?(h(!0),setTimeout(()=>{var dt;return(dt=y.current)==null?void 0:dt.focus()})):B({appKey:r})),_.type==="apiKey"&&(h(!0),setTimeout(()=>{var dt;return(dt=y.current)==null?void 0:dt.focus()})),p(!1);return}p(!1),h(!1),n(C.id)}},C=>(r==="gmail"||r==="googleCalendar"||r==="googleDocs"||r==="googleSheets")&&C.id==="ADD_OPTION"?P.default.createElement(w.ComboBoxItem,{key:C._comboboxKey,textValue:C.label},P.default.createElement(w.GoogleSignIn,null)):P.default.createElement(w.ComboBoxItem,{key:C._comboboxKey,textValue:C.label},P.default.createElement(w.Center,{className:"rollout-listbox__option-icon"},P.default.createElement(w.Avatar,{"aria-label":"Option icon",src:C.avatar,name:"icon"in C?null:C.label,alt:C.label,icon:"icon"in C?C.icon:void 0})),C.label))),l&&P.default.createElement("div",{className:"rollout-automation-form-oauth__error__message"},S??"Oops! Couldn't link that account."),A&&i.data!=null&&P.default.createElement(dr,{appKey:r,authType:i.data,saveApiToken:Q,savingApiToken:d,credentialId:e,firstApiTokenInput:y,openOAuthPopup:B,closeModal:()=>h(!1)}))}function kt(o){let{appKey:t,authInfoQuery:r,credentialId:n,error:e,setCredentialId:i,isDisabled:a}=o,s=r.data;return s==null||(s.type==="oauth1"||s.type==="oauth2"||s.type==="apiKey")&&s.singleCredentialOnly||s.type==="none"?null:P.default.createElement(Mn,{appKey:t,authInfoQuery:r,credentialId:n,setCredentialId:i,error:e,isDisabled:a})}function Vn(o){let{appKey:t,credentialId:r,setCredentialId:n,error:e,isDisabled:i}=o,a=(0,gr.useQuery)(["apps.authInfo",{appKey:t}]);return a.data==null?null:eo.default.createElement(kt,{appKey:t,authInfoQuery:a,credentialId:r,setCredentialId:n,error:e,isDisabled:i})}function ro(o){let{data:t,setData:r,validation:n}=R(),{action:e}=t,i=(0,eo.useCallback)(a=>r(s=>({...s,action:{...s.action,credentialId:a}})),[]);return(e==null?void 0:e.actionKey)==null?null:eo.default.createElement(Vn,{appKey:e.appKey,credentialId:e.credentialId,setCredentialId:i,error:n.success?void 0:n.error.issues.find(a=>a.path.join(".")==="action.credentialId"),isDisabled:o.disabled})}var At=g(require("react"));var It=require("@rollouthq/ui");function jn(o){var f;let{data:t,setData:r,actions:n,validation:e}=R(),{shouldShowErrors:i,setShouldShowErrors:a}=K(),l=(()=>e.success?null:e.error.issues.find(m=>m.path.join(".")==="action.actionKey"))(),p=t.action!=null?At.default.createElement(O,{appKey:t.action.appKey}):void 0,d=n.data??[],u=(f=n.data)==null?void 0:f.find(m=>{var y;return m.key===((y=t.action)==null?void 0:y.actionKey)});return At.default.createElement("div",{className:"rollout-automation-form__action-action"},At.default.createElement(It.FormControl,{error:i?l==null?void 0:l.message:void 0},At.default.createElement(It.ComboBox,{"aria-label":"Action dropdown",defaultItems:d,selectedOption:u,isDisabled:o.isDisabled,icon:p,isLoading:n.isLoading,inputPlaceholder:"Select action",menuTrigger:"focus",onSelectionChange:m=>(a(!1),r(y=>({...y,action:{...y.action,actionKey:m==null?void 0:m.key,inputParams:{}}})))},m=>At.default.createElement(It.ComboBoxItem,{key:m._comboboxKey,textValue:m.name},At.default.createElement(It.Center,{className:"rollout-listbox__option-icon"},p),m.name))))}function no(o){return At.default.createElement(jn,{isDisabled:o.disabled})}var Or=g(require("assert")),Nt=g(require("react"));var Kr=g(require("assert")),yt=g(require("react")),wr=require("@rollouthq/api-client-react");var Vt=g(require("react")),Sr=require("ts-object-path"),Dr=require("@rollouthq/api-client-react");var Mt=g(require("react")),vr=require("ts-assert-unreachable");var yr=g(require("react")),br=require("@rollouthq/ui/");function xr(o){return yr.default.createElement(br.TextField,{className:"rollout-input",value:o.value??"",onChange:o.setValue,isDisabled:o.isDisabled})}var Go=g(require("react")),Cr=require("@rollouthq/common"),_r=require("@rollouthq/ui");function hr(o){let t=o.value&&(0,Cr.resolveMentions)(o.value,o.variables);return Go.default.createElement("div",{className:"rollout-rich-text-input"},Go.default.createElement(_r.RichEditor,{value:t??null,setValue:r=>o.setValue(r??void 0),formattingEnabled:!1,linksEnabled:!1,mentionVariables:o.variables,isDisabled:o.isDisabled}))}var Pr=require("@rollouthq/ui/");var te=g(require("react")),Lt=require("@rollouthq/ui");function Ar(o){let{def:t,value:r,setValue:n,getDynamicOptions:e}=o,a=(0,Lt.useAsyncMemo)(async()=>{var l;return((l=t.dropdownConfiguration)==null?void 0:l.type)==="static"?t.dropdownConfiguration.staticOptions.map(p=>({key:p,label:p})):await e({inputKey:t.key})},[JSON.stringify(t.dropdownConfiguration)]).value??[],s=a.find(l=>l.key===r);return te.default.createElement(Lt.ComboBox,{defaultItems:a,selectedOption:s,menuTrigger:"focus",icon:null,inputPlaceholder:"Select option",onSelectionChange:l=>{n(l==null?void 0:l.key)},isDisabled:o.isDisabled},l=>te.default.createElement(Lt.ComboBoxItem,{key:l._comboboxKey,textValue:l.label},l.label))}var[Qn,zn]=(0,Pr.createContext)({name:"InputDefRenderer"});function Fr(o){let{renderInputParams:t}=$(),r=k({defaultField:Ir,renderer:t==null?void 0:t[o.def.key],ctx:{InputParamField:Ir}});return Mt.default.createElement(Qn,{value:o},r)}function Ir(o){let t=zn(),{def:r,value:n,setValue:e,variables:i,getDynamicOptions:a}=t;function s(){if(r.type==="plainText")return Mt.default.createElement(xr,{def:r,value:n,setValue:e,isDisabled:o.disabled});if(r.type==="dropdown")return Mt.default.createElement(Ar,{def:r,value:n,setValue:e,getDynamicOptions:a,isDisabled:o.disabled});if(r.type==="string")return Mt.default.createElement(hr,{def:r,value:n,setValue:e,variables:i,isDisabled:o.disabled});(0,vr.unreachableCase)(r)}return Mt.default.createElement(go,{label:r.label,isRequired:!0,error:void 0},s())}var Un=(0,Sr.createProxy)();function Ot(o){let{api:t,credentialId:r,inputParams:n,setInputParams:e,importedData:i,variables:a,getDynamicOptions:s}=o;return Vt.default.createElement(he,{value:o},"Component"in i?Vt.default.createElement(i.Component,{b:Un,credentialId:r,inputParams:n,setInputParams:e,api:t,useQuery:Dr.useQuery,inputComponents:Kt}):Vt.default.createElement(Vt.default.Fragment,null,i.inputParamDefs.map(l=>Vt.default.createElement(Fr,{key:l.key,def:l,value:n[l.key],setValue:p=>e({...n,[l.key]:p}),variables:a,getDynamicOptions:s}))))}var Ko=g(require("react")),wo=require("react"),io=require("@rollouthq/common");var Tr=typeof document>"u"?wo.useEffect:Ko.useLayoutEffect;function jt(o){let{actionRef:t}=o,{apiBaseUrl:r}=$t(),[n,e]=(0,wo.useState)();return Tr(()=>{Object.assign(window,{ROLLOUT_CONNECT_DEPS:{zod:{z:io.z},react:Ko.default,["@rollouthq/common"]:{z:io.z,isVariable:io.isVariable},["@rollouthq/connect-react/components/action-inputs"]:Kt}})},[]),Tr(()=>{if(t!=null){let{appKey:i,actionKey:a}=t;if(!i||!a)return;let s=`${r}/connect-react/${i}/actions/${a}.js`;new Function("path","return import(path)")(s).then(p=>e(p))}},[t==null?void 0:t.appKey,t==null?void 0:t.actionKey]),n}function kr(){return yt.default.createElement("div",{className:"rollout-automation-form__action-inputs"},yt.default.createElement("div",null,yt.default.createElement("div",{className:"rollout-automation-form__label"},"Set up action"),yt.default.createElement(oe,null)))}function oe(){var l;let{client:o}=(0,wr.useTRPCContext)(),{data:t,setData:r,variables:n,renderFields:e}=R(),i=t.action,a=jt({actionRef:t.action}),s=(0,yt.useCallback)(p=>{r(d=>({...d,action:{...d.action,inputParams:p}}))},[r]);return a==null||i.credentialId==null?null:((0,Kr.default)(typeof(e==null?void 0:e.action)!="function"&&typeof(e==null?void 0:e.action)!="boolean"),yt.default.createElement("div",{className:"rollout-automation-form__action-inputs-wrapper"},yt.default.createElement(Ot,{api:o,credentialId:i.credentialId,inputParams:i.inputParams,setInputParams:s,renderInputParams:(l=e==null?void 0:e.action)==null?void 0:l.inputParams,importedData:a,variables:n,getDynamicOptions:()=>{throw new Error("Dynamic options not implemented in actions")}})))}function ee(){var a,s,l;let{data:o,renderFields:t}=R(),{action:r}=o;(0,Or.default)(typeof(t==null?void 0:t.action)!="function"&&typeof(t==null?void 0:t.action)!="boolean");let n=k({defaultField:oo,renderer:(a=t==null?void 0:t.action)==null?void 0:a.appKey,ctx:{ActionAppKeyField:oo}}),e=k({defaultField:no,renderer:(s=t==null?void 0:t.action)==null?void 0:s.actionKey,ctx:{ActionKeyField:no}}),i=k({defaultField:ro,renderer:(l=t==null?void 0:t.action)==null?void 0:l.credentialId,ctx:{ActionCredentialIdField:ro}});return Nt.default.createElement(Nt.default.Fragment,null,Nt.default.createElement("div",{className:"rollout-automation-form__action"},Nt.default.createElement("div",{className:"rollout-automation-form__label"},"Select action"),Nt.default.createElement("div",{className:"rollout-automation-form__helper-text"},"This is what your automation will do when triggered"),n,e,i),(r==null?void 0:r.actionKey)!=null&&r.credentialId!=null&&Nt.default.createElement(kr,null))}var Lr=g(require("assert")),q=g(require("react")),Mr=require("@rollouthq/api-client-react");var st=g(require("react")),Nr=require("@rollouthq/api-client-react");var pt=require("@rollouthq/ui");function qn(o){let{appKey:t}=So(),{data:r,setData:n,validation:e}=R(),{trigger:i}=r,a=(0,Nr.useQuery)(["triggers.apps"]),{shouldShowErrors:s}=K(),l=Ct(e,u=>u.trigger),p=a.data??[],d=p==null?void 0:p.find(u=>u.key===(i==null?void 0:i.appKey));return st.default.createElement("div",{className:"rollout-automation-form__trigger-app"},st.default.createElement(pt.FormControl,{error:s?l==null?void 0:l.message:void 0},st.default.createElement(pt.ComboBox,{"aria-label":"Trigger app dropdown",defaultItems:p,selectedOption:d,menuTrigger:"focus",icon:i==null?st.default.createElement(pt.Rocket,null):st.default.createElement(O,{appKey:i.appKey}),isDisabled:o.isDisabled,inputPlaceholder:"Select app",onSelectionChange:u=>n(f=>{var B;if(u==null)return{...f,trigger:void 0};let m=u.key===t,y=((B=f.action)==null?void 0:B.appKey)===t,h=m&&y||!m&&!y;return{...f,trigger:{appKey:u.key,inputParams:{}},action:h?void 0:f.action}})},u=>st.default.createElement(pt.ComboBoxItem,{key:u._comboboxKey,textValue:u.name},st.default.createElement(pt.Center,{className:"rollout-listbox__option-icon"},st.default.createElement(O,{appKey:u.key})),u.name))))}function ao(o){return st.default.createElement(qn,{isDisabled:o.disabled})}var ut=g(require("react")),Br=require("@rollouthq/api-client-react");var rt=require("@rollouthq/ui");function Wn(o){let{isDisabled:t}=o,{shouldShowErrors:r}=K(),{validation:n,data:e,setData:i}=R(),{trigger:a}=e,s=(0,Br.useQuery)(["apps.triggers",{appKey:a==null?void 0:a.appKey}],{enabled:(a==null?void 0:a.appKey)!=null}),l=Ct(n,u=>u.trigger.triggerKey),p=s.data??[],d=p.find(u=>u.key===(a==null?void 0:a.triggerKey));return ut.default.createElement(rt.FormControl,{error:r?l==null?void 0:l.message:void 0},ut.default.createElement(rt.ComboBox,{"aria-label":"Trigger dropdown",defaultItems:p,selectedOption:d,menuTrigger:"focus",isDisabled:t||s.isLoading,icon:(a==null?void 0:a.appKey)==null?ut.default.createElement(rt.Rocket,null):ut.default.createElement(O,{appKey:a==null?void 0:a.appKey}),inputPlaceholder:"Select trigger",onSelectionChange:u=>i(f=>({...f,trigger:{...f.trigger,triggerKey:u==null?void 0:u.key,inputParams:{}}}))},u=>ut.default.createElement(rt.ComboBoxItem,{key:u._comboboxKey,textValue:u.name},ut.default.createElement(rt.Center,{className:"rollout-listbox__option-icon"},(a==null?void 0:a.appKey)==null?ut.default.createElement(rt.Rocket,null):ut.default.createElement(O,{appKey:a==null?void 0:a.appKey})),u.name)))}function lo(o){return ut.default.createElement(Wn,{isDisabled:o.disabled})}var Er=g(require("react")),$r=require("@rollouthq/api-client-react");function Rr(o){let{appKey:t,credentialId:r,setCredentialId:n,error:e,isDisabled:i}=o,a=(0,$r.useQuery)(["apps.authInfo",{appKey:t}]);return a.data==null?null:Er.default.createElement(kt,{appKey:t,authInfoQuery:a,credentialId:r,setCredentialId:n,error:e,isDisabled:i})}function re(){var m,y,x;let{client:o}=(0,Mr.useTRPCContext)(),{data:t,setData:r,renderFields:n,validation:e}=R(),{trigger:i}=t,a=Rt(i),s=(0,q.useCallback)(A=>{r(h=>({...h,trigger:{...h.trigger,inputParams:A}}))},[r]),l=(0,q.useCallback)(A=>r(h=>({...h,trigger:{...h.trigger,credentialId:A}})),[r]),p=(0,q.useMemo)(()=>[],[]);(0,Lr.default)(typeof(n==null?void 0:n.trigger)!="function"&&typeof(n==null?void 0:n.trigger)!="boolean");let d=k({defaultField:ao,renderer:(m=n==null?void 0:n.trigger)==null?void 0:m.appKey,ctx:{TriggerAppKeyField:ao}}),u=k({defaultField:lo,renderer:(y=n==null?void 0:n.trigger)==null?void 0:y.triggerKey,ctx:{TriggerKeyField:lo}}),f=a&&("inputParamsSchema"in a?Object.keys(a.inputParamsSchema.shape).length>0:a.inputParamDefs.length>0);return q.default.createElement("div",{className:"rollout-automation-form__trigger"},q.default.createElement("div",{className:"rollout-automation-form__label"},"Select trigger"),q.default.createElement("div",{className:"rollout-automation-form__helper-text"},"This is the event that will kick off your action"),d,q.default.createElement("div",{className:"rollout-automation-form__trigger-trigger"},u),(i==null?void 0:i.triggerKey)!=null&&q.default.createElement(Rr,{appKey:i.appKey,credentialId:i.credentialId,setCredentialId:l,error:e.success?void 0:e.error.issues.find(A=>A.path.join(".")==="trigger.credentialId")}),(i==null?void 0:i.credentialId)!=null&&f&&q.default.createElement("div",{className:"rollout-automation-form__trigger-inputs"},q.default.createElement("div",{className:"rollout-automation-form__trigger-inputs-wrapper"},q.default.createElement(Ot,{api:o,credentialId:i.credentialId,inputParams:i.inputParams,setInputParams:s,renderInputParams:(x=n==null?void 0:n.trigger)==null?void 0:x.inputParams,importedData:a,variables:p,getDynamicOptions:({inputKey:A})=>o.query("triggers.getTriggerInputOptions",{triggerKey:i.triggerKey,inputKey:A})}))))}var ne=g(require("react"));var Vr=require("@rollouthq/ui");function Zn(o){let{disabled:t=!1}=o,{data:r,setData:n,validation:e}=R(),{shouldShowErrors:i}=K(),a=Ct(e,s=>s.name)!=null;return ne.default.createElement(Vr.TextField,{"aria-label":"Automation Name Input",className:"rollout-automation-form__name",placeholder:"Give your automation a name",isDisabled:t,value:r.name??"",validationState:i&&a?"invalid":"valid",onChange:s=>n(l=>({...l,name:s}))})}function ie(o){return ne.default.createElement(Zn,{...o})}var ae=require("react"),X=require("zod"),Qt=X.z.object({name:X.z.string().min(1),trigger:X.z.object({appKey:X.z.string(),triggerKey:X.z.string(),credentialId:X.z.string(),inputParams:X.z.object({})}),action:X.z.object({appKey:X.z.string(),actionKey:X.z.string(),credentialId:X.z.string(),inputParams:X.z.object({})})});function jr(o){let{data:t,actionInputParamsSchema:r,triggerInputParamsSchema:n}=o,e=(0,ae.useMemo)(()=>Qt.extend({trigger:Qt.shape.trigger.extend({inputParams:n}),action:Qt.shape.action.extend({inputParams:r})}),[n,r]);return(0,ae.useMemo)(()=>e.safeParse(t),[t,e])}function Oo(o){var Wt,Zt,Yt,Ht,Xt;let{data:t,isSaving:r,onSave:n,onCancel:e,onUpdate:i,onDelete:a,mode:s,renderFields:l}=o,[p,d]=(0,Qr.useState)(!1),[u,f]=(0,vt.useToggle)(),{client:m}=(0,ko.useTRPCContext)(),x=(Yt=(0,ko.useQuery)(["apps.triggers",{appKey:(Wt=t.trigger)==null?void 0:Wt.appKey}],{enabled:((Zt=t.trigger)==null?void 0:Zt.appKey)!=null}).data)==null?void 0:Yt.find(V=>{var L;return V.key===((L=t.trigger)==null?void 0:L.triggerKey)}),A=(0,vt.useAsyncMemo)(async()=>{var V,L,c;return x==null?[]:x.payloadConfiguration.type==="static"?x.payloadConfiguration.staticSchema:await m.query("triggers.getPayloadSchema",{appKey:(V=t.trigger)==null?void 0:V.appKey,triggerKey:(L=t.trigger)==null?void 0:L.triggerKey,inputParams:(c=t.trigger)==null?void 0:c.inputParams})},[JSON.stringify(x==null?void 0:x.payloadConfiguration),JSON.stringify(t.trigger)]),h=(0,I.useMemo)(()=>(A.value??[]).map(V=>({id:V.key,label:V.label,type:"string"})),[A.value]),{allowedApps:B}=ze(),S=He({allowedApps:B}),D=Ze(t.action),N=jt({actionRef:t.action}),E=Rt(t.trigger),Q=(0,I.useMemo)(()=>E==null?Qt.shape.action.shape.inputParams:"inputParamsSchema"in E?E.inputParamsSchema:(0,le.inputDefToZodObject)(E.inputParamDefs),[E]),ot=(0,I.useMemo)(()=>N==null?Qt.shape.action.shape.inputParams:"inputParamsSchema"in N?N.inputParamsSchema:(0,le.inputDefToZodObject)(N.inputParamDefs),[N]),U=jr({data:t,triggerInputParamsSchema:Q,actionInputParamsSchema:ot}),C=(0,I.useCallback)(V=>i(L=>{var be,xe;let c=V(L),F=((be=L.trigger)==null?void 0:be.triggerKey)!==((xe=c.trigger)==null?void 0:xe.triggerKey),co=c.action==null?void 0:{...c.action,inputParams:F?{}:c.action.inputParams};return{...c,action:co}}),[i]),_=(0,I.useMemo)(()=>({data:t,apps:S,actions:D,validation:U,variables:h,setData:C,renderFields:l}),[t,S,D,U,h,C,l]),et=(0,I.useMemo)(()=>({shouldShowErrors:p,setShouldShowErrors:d}),[p,d]),dt=(0,I.useCallback)(V=>C(L=>({...L,trigger:{...L.trigger,credentialId:V}})),[C]),Uo=(0,I.useCallback)(V=>C(L=>({...L,action:{...L.action,credentialId:V}})),[C]);Gt({appKey:(Ht=t.trigger)==null?void 0:Ht.appKey,setCredentialId:dt}),Gt({appKey:(Xt=t.action)==null?void 0:Xt.appKey,setCredentialId:Uo});let uo=S.data==null,qo=(0,zr.useSpinDelay)(uo,{delay:500,minDuration:200});if(S.failureCount>0)return I.default.createElement("div",{className:"rollout-automations-list__error-msg"},"Woops! Something went wrong fetching automations.");if(uo||qo)return I.default.createElement("div",{className:"rollout__loading_spinner_container"},I.default.createElement(vt.Spinner,{className:"rollout__loading_spinner"}));let Wo=k({defaultField:ie,renderer:l==null?void 0:l.name,ctx:{NameField:ie}}),Zo=typeof(l==null?void 0:l.trigger)=="object"?I.default.createElement(re,null):k({defaultField:re,renderer:l==null?void 0:l.trigger,ctx:{TriggerAppKeyField:ao,TriggerKeyField:lo}}),mo=typeof(l==null?void 0:l.action)=="object"?I.default.createElement(ee,null):k({defaultField:ee,renderer:l==null?void 0:l.action,ctx:{ActionAppKeyField:oo,ActionKeyField:no,ActionCredentialIdField:ro,ActionInputFields:oe}});return I.default.createElement(Co,{value:et},I.default.createElement(lr,{value:_},I.default.createElement("div",{className:"rollout-automation-form"},I.default.createElement("div",{className:"rollout-automation-form__header"},Wo),I.default.createElement("div",{className:"rollout-automation-form__content"},Zo,mo),I.default.createElement("div",{className:"rollout-automation-form__buttons"},I.default.createElement("button",{type:"button","aria-label":"Save button",className:"rollout-button--primary rollout-automation-form__submit","data-loading":(0,vt.dataAttr)(r),onClick:()=>{d(!0),U.success?n(U.data):console.error(U.error)}},r?"Saving...":"Save"),e!=null&&I.default.createElement("button",{type:"button","aria-label":"Cancel button",className:"rollout-button--secondary rollout-automation-form__cancel",onClick:()=>e()},"Cancel"),s!=="create"&&I.default.createElement("div",{className:"rollout-automation-form__delete"},u&&I.default.createElement("div",{className:"rollout-automation-form-delete__confirm-dialog"},I.default.createElement("div",{className:"rollout-automation-form__delete-confirm-text"},"Are you sure you want to delete this automation?"),I.default.createElement("div",{className:"rollout-automation-form__delete-confirm-buttons"},I.default.createElement("button",{type:"button","aria-label":"Cancel deletion button",onClick:f,className:"rollout-button--secondary rollout-automation-form__delete-cancel"},"No, cancel"),I.default.createElement("button",{type:"button","aria-label":"Confirm deletion button",onClick:a,className:"rollout-button--danger rollout-automation-form__delete-confirm"},"Yes, delete"))),I.default.createElement("button",{type:"button","aria-label":"Delete button",className:"rollout-button--danger rollout-automations-form-delete__trigger",onClick:f},"Delete"))))))}function No(o){let{onAutomationCreated:t,onBeforeAutomationCreate:r,onCancel:n,prefilled:e,renderFields:i}=o,a=(0,Ur.useMutation)("automations.create"),[s,l]=(0,so.useState)(()=>{var u,f;let d={};return e==null||(e.name&&(d.name=e.name),((u=e.trigger)==null?void 0:u.appKey)!=null&&(d.trigger={...e.trigger,appKey:e.trigger.appKey,inputParams:e.trigger.inputParams??{}}),((f=e.action)==null?void 0:f.appKey)!=null&&(d.action={...e.action,appKey:e.action.appKey,inputParams:e.action.inputParams??{}})),d}),p=async d=>{let u=await(r==null?void 0:r({automationData:d}));if(u===!1)return;let f=u===!0||u===void 0?d:u.automationData,m=await a.mutateAsync(f);t({automation:m})};return so.default.createElement("div",{className:"rollout-automation-creator"},so.default.createElement(Oo,{mode:"create",data:s,renderFields:i,onUpdate:l,isSaving:a.isLoading,onSave:p,onCancel:n}))}var zt=g(require("react")),Bt=require("@rollouthq/api-client-react");function Bo(o){let{automationId:t,onAutomationDeleted:r,onAutomationUpdated:n,onCancel:e,renderFields:i}=o,{invalidateQueries:a}=(0,Bt.useTRPCContext)(),s=(0,Bt.useMutation)("automations.delete",{onSuccess:()=>a(["automations.list"])}),[l,p]=(0,zt.useState)({}),d=(0,Bt.useQuery)(["automations.get",{automationId:t}],{onSuccess(y){y!=null&&p({name:y.name,action:y.action,trigger:y.trigger})}}),u=(0,Bt.useMutation)("automations.update");if(d.isLoading)return null;if(d.data==null)return zt.default.createElement("div",{className:"rollout-automations-editor__not-found"},"Automation not found");let f=async y=>{let x=await u.mutateAsync({id:t,automationData:{name:y.name,action:y.action,trigger:y.trigger}});n==null||n(x)},m=()=>{s.mutate({id:d.data.id},{onSuccess:()=>{r==null||r()}})};return zt.default.createElement("div",{className:"rollout-automation-editor"},zt.default.createElement(Oo,{mode:"edit",data:l,renderFields:i,onUpdate:p,isSaving:u.isLoading,onSave:f,onDelete:m,onCancel:e}))}var mt=g(require("react"));var nt=g(require("react")),Ut=require("@rollouthq/api-client-react");var se=require("match-sorter"),v=g(require("react"));var W=require("@rollouthq/ui"),Eo=require("@rollouthq/ui");function qr(o){let{automations:t,isLoading:r=!1,isDeleting:n=!1,onEditAutomation:e,onDeleteAutomation:i}=o,[a,s]=(0,v.useState)(""),l=(0,se.matchSorter)(t,a,{keys:["name","action.app.name"],threshold:se.matchSorter.rankings.ACRONYM}),p=l.length===0;return v.default.createElement("div",{className:"rollout-automations-list__container"},v.default.createElement("div",{className:"rollout-automations-list__search-input__group"},v.default.createElement("div",{className:"rollout-automations-list__search-input__left-element"},v.default.createElement(W.Search,null)),v.default.createElement(W.TextField,{"aria-label":"Search automations text field",placeholder:"Search automations",value:a,onChange:s,className:"rollout-automations-list__search-input"})),r&&v.default.createElement("div",{className:"rollout__loading_spinner_container"},v.default.createElement(W.Spinner,{className:"rollout__loading_spinner"})),!r&&p&&v.default.createElement("div",{className:"rollout-automations-list__empty-msg"},"No automations found"),v.default.createElement("div",{className:"rollout-automations-list__list"},l.map(d=>v.default.createElement(Yn,{key:d.id,automation:d,onEdit:()=>e(d),onDelete:()=>i(d),isDeleting:n}))))}function Yn(o){let{automation:t,onEdit:r,onDelete:n,isDeleting:e}=o,[i,a]=(0,Eo.useToggle)(),[s,l]=(0,v.useState)(!1);(0,v.useEffect)(()=>{!e&&s&&l(!1)},[e]);let p=i&&v.default.createElement("div",{className:"rollout-automations-list-item__options__content",onMouseLeave:()=>{i&&a()}},v.default.createElement("span",null,"Really delete?"),v.default.createElement("button",{type:"button","aria-label":"Confirm deletion button",onClick:()=>{n(),l(!0)},className:"rollout-automations-list-item__options__delete-item-btn"},"Delete"),v.default.createElement("button",{type:"button","aria-label":"Cancel deletion button",onClick:a,className:"rollout-automations-list-item__options__cancel-item-btn"},"Cancel"));return v.default.createElement("div",{className:"rollout-automations-list__item-wrapper","data-deleting":(0,W.dataAttr)(s)},p,v.default.createElement("div",{className:"rollout-automations-list__item",role:"group","data-open":(0,W.dataAttr)(i),onClick:d=>{(0,W.isChildofInteractiveElement)(d.target)||r()}},v.default.createElement("div",{className:"rollout-automations-list-item__header"},v.default.createElement("div",{className:"rollout-automations-list-item__icons"},v.default.createElement(W.Center,{className:"rollout-automations-list-item__trigger"},v.default.createElement(O,{appKey:t.trigger.appKey})),v.default.createElement(W.Center,{className:"rollout-automations-list-item__action"},v.default.createElement(O,{appKey:t.action.appKey}))),v.default.createElement("div",{role:"button",className:"rollout-automations-list-item__options__trigger",onClick:a},v.default.createElement(Eo.Trash,null))),v.default.createElement("div",{className:"rollout-automations-list-item__name"},t.name)))}var Wr=require("@rollouthq/ui");function $o(o){let{onEditAutomation:t,onCreateAutomation:r,filter:n}=o,{invalidateQueries:e}=(0,Ut.useTRPCContext)(),[i,a]=(0,nt.useState)(()=>[]),s=(0,Ut.useQuery)(["automations.list"]);(0,nt.useEffect)(()=>{s.data!=null&&(n!=null?a(s.data.filter(p=>{try{return n(p)}catch(d){return console.error(d),!1}})):a(s.data))},[s.data,n]);let l=(0,Ut.useMutation)("automations.delete",{onSuccess:()=>e(["automations.list"])});return nt.default.createElement("div",null,nt.default.createElement("div",{className:"rollout-automations-list__header"},nt.default.createElement("span",{className:"rollout-automations-list__header-title"},"My automations"),nt.default.createElement("button",{type:"button","aria-label":"New automation button",className:"rollout-automations-list__new-btn",onClick:()=>r()},nt.default.createElement(Wr.Plus,null),"New")),nt.default.createElement(qr,{automations:i??[],isLoading:s.isFetching,isDeleting:l.isLoading,onDeleteAutomation:p=>l.mutate({id:p.id}),onEditAutomation:t}))}var Zr=require("@rollouthq/ui");function Yr(o){let{onAutomationCreated:t,onBeforeAutomationCreate:r,prefilled:n,filter:e,renderFields:i}=o,[a,s]=(0,mt.useState)({mode:"LIST"});return mt.default.createElement("div",{className:"rollout-automations-manager"},a.mode==="LIST"&&mt.default.createElement($o,{onEditAutomation:l=>s({mode:"EDIT",automationId:l.id}),onCreateAutomation:()=>s({mode:"CREATE"}),filter:e}),(a.mode==="CREATE"||a.mode==="EDIT")&&mt.default.createElement("div",{className:"rollout-automations-manager__navbar"},mt.default.createElement("button",{type:"button","aria-label":"Return to automations list button",className:"rollout-automations-manager__back-btn",onClick:()=>s({mode:"LIST"})},mt.default.createElement(Zr.ArrowBack,{className:"rollout-automation-form__header-back__arrow"}))),a.mode==="CREATE"&&mt.default.createElement(No,{onBeforeAutomationCreate:r,onAutomationCreated:l=>{t==null||t(l),s({mode:"LIST"})},prefilled:n,renderFields:i}),a.mode==="EDIT"&&mt.default.createElement(Bo,{automationId:a.automationId,onAutomationUpdated:()=>s({mode:"LIST"}),onAutomationDeleted:()=>s({mode:"LIST"}),renderFields:i}))}var b=g(require("react")),Xr=require("spin-delay"),G=require("@rollouthq/api-client-react"),ue=require("@rollouthq/common/");var bt=require("@rollouthq/ui");var pe=require("react"),J=require("zod"),qt=J.z.object({name:J.z.string().min(1),trigger:J.z.object({appKey:J.z.string(),triggerKey:J.z.string(),credentialId:J.z.string(),inputParams:J.z.object({})}),action:J.z.object({appKey:J.z.string(),actionKey:J.z.string(),credentialId:J.z.string(),inputParams:J.z.object({})})});function Hr(o){let{data:t={},actionInputParamsSchema:r,triggerInputParamsSchema:n}=o,e=(0,pe.useMemo)(()=>qt.extend({trigger:qt.shape.trigger.extend({inputParams:n}),action:qt.shape.action.extend({inputParams:r})}),[r,n]);return(0,pe.useMemo)(()=>e.safeParse(t),[t,e])}function Ro(o){var mo,Wt,Zt,Yt,Ht,Xt,V,L;let{blueprintId:t}=o,{client:r,invalidateQueries:n}=(0,G.useTRPCContext)(),[e,i]=(0,b.useState)(),a=(0,G.useLazyQuery)("triggers.getPayloadSchema"),s=(0,G.useLazyQuery)("apps.authInfo"),l=(0,G.useLazyQuery)("apps.triggers"),p=Rt(e==null?void 0:e.trigger);(0,b.useEffect)(()=>{let c=e==null?void 0:e.trigger;c!=null&&(s.fetch({appKey:c.appKey}),l.fetch({appKey:c.appKey}),c.triggerKey!=null&&c.appKey!=null&&a.fetch({appKey:c.appKey,triggerKey:c.triggerKey}))},[e==null?void 0:e.trigger]);let d=(0,G.useLazyQuery)("apps.authInfo");(0,b.useEffect)(()=>{var c;((c=e==null?void 0:e.action)==null?void 0:c.appKey)!=null&&d.fetch({appKey:e.action.appKey})},[(mo=e==null?void 0:e.action)==null?void 0:mo.appKey]);let u=(0,G.useQuery)(["blueprints.get",{blueprintId:t}],{onSuccess:c=>{e==null&&(c.automation!=null?i({name:c.automation.name,action:c.automation.action,trigger:c.automation.trigger}):i({name:c.name,action:c.action,trigger:c.trigger}))}}),f=(0,G.useMutation)("blueprints.createAutomation"),m=(0,G.useMutation)("blueprints.deactivateAutomation"),y=(0,b.useMemo)(()=>p==null?qt.shape.action.shape.inputParams:"inputParamsSchema"in p?p.inputParamsSchema:(0,ue.inputDefToZodObject)(p.inputParamDefs),[p]),x=jt({actionRef:e==null?void 0:e.action}),A=(0,b.useMemo)(()=>x==null?qt.shape.action.shape.inputParams:"inputParamsSchema"in x?x.inputParamsSchema:(0,ue.inputDefToZodObject)(x.inputParamDefs),[x]),h=Hr({data:e,triggerInputParamsSchema:y,actionInputParamsSchema:A}),B=(0,b.useCallback)(c=>i(F=>({...F,trigger:{...F==null?void 0:F.trigger,credentialId:c}})),[i]),S=(0,b.useCallback)(c=>i(F=>({...F,action:{...F==null?void 0:F.action,credentialId:c}})),[i]);Gt({appKey:(Wt=e==null?void 0:e.trigger)==null?void 0:Wt.appKey,setCredentialId:B});let D=(0,b.useCallback)(c=>{i(F=>({...F,trigger:{...F.trigger,inputParams:c}}))},[i]),E=(Ht=(0,G.useQuery)(["apps.triggers",{appKey:(Zt=e==null?void 0:e.trigger)==null?void 0:Zt.appKey}],{enabled:((Yt=e==null?void 0:e.trigger)==null?void 0:Yt.appKey)!=null}).data)==null?void 0:Ht.find(c=>{var F;return c.key===((F=e==null?void 0:e.trigger)==null?void 0:F.triggerKey)}),Q=(0,bt.useAsyncMemo)(async()=>{var c,F,co;return E==null?[]:E.payloadConfiguration.type==="static"?E.payloadConfiguration.staticSchema:await r.query("triggers.getPayloadSchema",{appKey:(c=e==null?void 0:e.trigger)==null?void 0:c.appKey,triggerKey:(F=e==null?void 0:e.trigger)==null?void 0:F.triggerKey,inputParams:(co=e==null?void 0:e.trigger)==null?void 0:co.inputParams})},[JSON.stringify(E==null?void 0:E.payloadConfiguration),JSON.stringify(e==null?void 0:e.trigger)]),ot=(0,b.useMemo)(()=>(Q.value??[]).map(c=>({id:c.key,label:c.label,type:"string"})),[Q.value]);function U(){return(e==null?void 0:e.action)==null||x==null?null:b.default.createElement("div",{className:"rollout-automation-form__action-inputs"},b.default.createElement("div",null,b.default.createElement("div",{className:"rollout-automation-form__label"},"Set up action"),b.default.createElement("div",{className:"rollout-automation-form__credential"},b.default.createElement(bt.FormControl,{label:"Account",isRequired:!0},b.default.createElement(kt,{error:h.success?void 0:h.error.issues.find(c=>c.path.join(".")==="action.credentialId"),credentialId:e.action.credentialId,setCredentialId:c=>{let F={...e.action,credentialId:c};i({...e,action:F})},authInfoQuery:d,appKey:e.action.appKey}))),b.default.createElement("div",{className:"rollout-automation-form__action-inputs-wrapper"},b.default.createElement(Ot,{isBlueprintActivation:!0,api:r,credentialId:e.action.credentialId,inputParams:e.action.inputParams,setInputParams:c=>i({...e,action:{...e.action,inputParams:c}}),renderInputParams:void 0,importedData:x,variables:ot,getDynamicOptions:()=>{throw new Error("Dynamic options not implemented in actions")}}))))}let C=((V=(Xt=u.data)==null?void 0:Xt.automation)==null?void 0:V.active)??!1,[_,et]=(0,b.useState)(!1),dt=(0,b.useMemo)(()=>({shouldShowErrors:_,setShouldShowErrors:et}),[_,et]),Uo=(0,b.useMemo)(()=>[],[]);async function uo(){if(et(!0),h.success){let c=h.data;await f.mutateAsync({blueprintId:t,trigger:{credentialId:c.trigger.credentialId,inputParams:c.trigger.inputParams},action:{credentialId:c.action.credentialId,inputParams:c.action.inputParams}}),n(["blueprints.getAutomation",{blueprintId:t}]),n(["blueprints.get",{blueprintId:t}]),n("blueprints.list")}else console.log(e),console.error(h.error)}async function qo(){await m.mutateAsync({blueprintId:t}),n(["blueprints.getAutomation",{blueprintId:t}]),n(["blueprints.get",{blueprintId:t}]),n("blueprints.list")}let ye=(0,Xr.useSpinDelay)(e==null,{delay:500,minDuration:200});if(e==null)return null;if(ye)return b.default.createElement("div",{className:"rollout__loading_spinner_container"},b.default.createElement(bt.Spinner,{className:"rollout__loading_spinner"}));let Wo=p&&("inputParamsSchema"in p?Object.keys(p.inputParamsSchema.shape).length>0:p.inputParamDefs.length>0),Zo=((L=e.trigger)==null?void 0:L.triggerKey)!=null&&b.default.createElement("div",{className:"rollout-blueprint-activator__trigger"},b.default.createElement("div",{className:"rollout-blueprint-activator__label"},"Set up trigger"),b.default.createElement("div",{className:"rollout-blueprint-activator__trigger__fields"},b.default.createElement(kt,{error:h.success?void 0:h.error.issues.find(c=>c.path.join(".")==="trigger.credentialId"),appKey:e.trigger.appKey,setCredentialId:c=>i({...e,trigger:{...e.trigger,credentialId:c}}),authInfoQuery:s,credentialId:e.trigger.credentialId}),e.trigger.credentialId!=null&&Wo&&b.default.createElement("div",{className:"rollout-automation-form__trigger-inputs-wrapper"},b.default.createElement(Ot,{api:r,credentialId:e.trigger.credentialId,inputParams:e.trigger.inputParams,setInputParams:D,renderInputParams:void 0,importedData:p,variables:Uo,getDynamicOptions:({inputKey:c})=>{var F;return r.query("triggers.getTriggerInputOptions",{triggerKey:(F=e.trigger)==null?void 0:F.triggerKey,inputKey:c})}}))));return b.default.createElement(Co,{value:dt},b.default.createElement("div",null,u.data!=null&&b.default.createElement("div",null,b.default.createElement("div",{className:"rollout-blueprint-activator__header"},b.default.createElement("div",{className:"rollout-automations-list-item__icons"},b.default.createElement(bt.Center,{className:"rollout-automations-list-item__trigger"},b.default.createElement(O,{appKey:u.data.trigger.appKey})),b.default.createElement(bt.Center,{className:"rollout-automations-list-item__action"},b.default.createElement(O,{appKey:u.data.action.appKey}))),b.default.createElement("div",{className:"rollout-blueprint-activator__name"},u.data.name)),Zo,U(),b.default.createElement("div",null,C?b.default.createElement("button",{type:"button","aria-label":"Deactivation button",disabled:f.isLoading,className:"rollout-blueprint-activator__deactivate-btn rollout-button--primary",onClick:qo},f.isLoading?"Deactivating...":"Deactivate"):b.default.createElement("button",{type:"button","aria-label":"Activation button",disabled:f.isLoading,className:"rollout-blueprint-activator__activate-btn rollout-button--primary",onClick:uo},f.isLoading?"Activating...":"Activate")))))}var me=require("match-sorter"),T=g(require("react")),Lo=require("@rollouthq/api-client-react");var tt=require("@rollouthq/ui");function Mo(o){let{blueprints:t,isLoading:r=!1,onOpenActivationForm:n}=o,[e,i]=(0,T.useState)(""),a=(0,me.matchSorter)(t,e,{keys:["name","action.app.name"],threshold:me.matchSorter.rankings.ACRONYM}),s=a.length===0;return T.default.createElement("div",{className:"rollout-automations-list__container"},T.default.createElement("div",{className:"rollout-automations-list__search-input__group"},T.default.createElement("div",{className:"rollout-automations-list__search-input__left-element"},T.default.createElement(tt.Search,null)),T.default.createElement(tt.TextField,{placeholder:"Search blueprints",value:e,onChange:i,className:"rollout-automations-list__search-input"})),r&&T.default.createElement("div",{className:"rollout__loading_spinner_container"},T.default.createElement(tt.Spinner,{className:"rollout__loading_spinner"})),!r&&s&&T.default.createElement("div",{className:"rollout-automations-list__empty-msg"},"No blueprints found"),T.default.createElement("div",{className:"rollout-automations-list__list"},a.map(l=>T.default.createElement(Hn,{key:l.id,blueprint:l,onOpenActivationForm:()=>n(l)}))))}function Hn(o){var a;let{blueprint:t,onOpenActivationForm:r}=o,{invalidateQueries:n}=(0,Lo.useTRPCContext)(),e=(0,Lo.useMutation)("blueprints.deactivateAutomation"),i=((a=t.automation)==null?void 0:a.active)??!1;return T.default.createElement("div",{className:"rollout-automations-list__item-wrapper"},T.default.createElement("div",{className:"rollout-automations-list__item",role:"group",onClick:s=>{(0,tt.isChildofInteractiveElement)(s.target)||r()}},T.default.createElement("div",{className:"rollout-automations-list-item__header"},T.default.createElement("div",{className:"rollout-automations-list-item__icons"},T.default.createElement(tt.Center,{className:"rollout-automations-list-item__trigger"},T.default.createElement(O,{appKey:t.trigger.appKey})),T.default.createElement(tt.Center,{className:"rollout-automations-list-item__action"},T.default.createElement(O,{appKey:t.action.appKey}))),T.default.createElement("div",{className:"rollout-automations-list-item__switch"},T.default.createElement(tt.Switch,{isSelected:i,onChange:async()=>{if(i){let s=t.id;await e.mutateAsync({blueprintId:s}),n(["blueprints.get",{blueprintId:s}]),n(["blueprints.getAutomation",{blueprintId:s}]),n(["blueprints.list"])}else r()}}))),T.default.createElement("div",{className:"rollout-automations-list-item__name"},t.name)))}var it=g(require("react"));var po=g(require("react")),Jr=require("@rollouthq/api-client-react");function Vo(o){let{onOpenActivationForm:t}=o,r=(0,Jr.useQuery)(["blueprints.list"]);return po.default.createElement("div",null,po.default.createElement("div",{className:"rollout-automations-list__header"},po.default.createElement("span",{className:"rollout-automations-list__header-title"},"My blueprints")),po.default.createElement(Mo,{blueprints:r.data??[],isLoading:r.isFetching,onOpenActivationForm:t}))}var Gr=require("@rollouthq/ui");function tn(){let[o,t]=(0,it.useState)({mode:"LIST"});return it.default.createElement("div",{className:"rollout-automations-manager"},o.mode==="LIST"&&it.default.createElement(Vo,{onOpenActivationForm:r=>{t({mode:"ACTIVATE",blueprintId:r.id})}}),o.mode==="ACTIVATE"&&it.default.createElement(it.default.Fragment,null,it.default.createElement("div",{className:"rollout-automations-manager__navbar"},it.default.createElement("button",{type:"button","aria-label":"Return to blueprints list button",className:"rollout-blueprints-manager__back-btn",onClick:()=>t({mode:"LIST"})},it.default.createElement(Gr.ArrowBack,{className:"rollout-automation-form__header-back__arrow"}))),it.default.createElement(Ro,{blueprintId:o.blueprintId})))}var Pt=g(require("react")),xt=require("@rollouthq/ui");function on(){return Pt.default.createElement(xt.st.div,{css:{textAlign:"center"}},Pt.default.createElement(xt.st.div,{css:{display:"flex",justifyContent:"center",alignItems:"center"}},Pt.default.createElement(xt.RolloutIcon,{width:"16px"}),Pt.default.createElement(xt.st.span,{css:{paddingLeft:"$2",fontWeight:700,color:"$neutral-2"}},"Powered by Rollout")),Pt.default.createElement(xt.st.div,{css:{marginTop:"$2",fontSize:"8px",color:"$grayMedium"}},"By automating, you agree to Rollout's"," ",Pt.default.createElement(xt.st.a,{href:"https://docs.rollouthq.com/security-and-legal/security",css:{color:"black",textDecoration:"underline"}},"Terms")," ","&"," ",Pt.default.createElement(xt.st.a,{href:"https://docs.rollouthq.com/security-and-legal/privacy-policy",css:{color:"black",textDecoration:"underline"}},"Privacy policy")))}var Z=g(require("react"));function de(o,t,r,n){Object.defineProperty(o,t,{get:r,set:n,enumerable:!0,configurable:!0})}var ce={};de(ce,"SSRProvider",()=>fe);de(ce,"useSSRSafeId",()=>Jn);de(ce,"useIsSSR",()=>Gn);var Qo={prefix:String(Math.round(Math.random()*1e10)),current:0},jo=Z.default.createContext(Qo);function fe(o){let t=(0,Z.useContext)(jo),r=(0,Z.useMemo)(()=>({prefix:t===Qo?"":`${t.prefix}-${++t.current}`,current:0}),[t]);return Z.default.createElement(jo.Provider,{value:r},o.children)}var Xn=Boolean(typeof window<"u"&&window.document&&window.document.createElement);function Jn(o){let t=(0,Z.useContext)(jo);return t===Qo&&!Xn&&console.warn("When server rendering, you must wrap your application in an <SSRProvider> to ensure consistent ids are generated between the client and server."),(0,Z.useMemo)(()=>o||`react-aria${t.prefix}-${++t.current}`,[o])}function Gn(){let t=(0,Z.useContext)(jo)!==Qo,[r,n]=(0,Z.useState)(t);return typeof window<"u"&&t&&(0,Z.useLayoutEffect)(()=>{n(!1)},[]),r}var St=require("@sentry/browser"),at=g(require("react")),ln=require("react-error-boundary"),sn=require("@rollouthq/api-client-react");var Ft=g(require("react")),en=require("@rollouthq/ui"),rn=require("@rollouthq/ui");function nn(){return Ft.default.createElement("div",{className:"rollout-error-fallback__container"},Ft.default.createElement("div",null,Ft.default.createElement(en.Gear,{style:{width:"40px",height:"40px"}}),Ft.default.createElement(rn.RedQuestion,{style:{position:"relative",right:"10px",bottom:"30px"}})),Ft.default.createElement("div",{className:"rollout-error-fallback__text-container"},Ft.default.createElement("div",{className:"rollout-error-fallback__message"},"An unexpected error occured"),Ft.default.createElement("div",{className:"rollout-error-fallback__additional-info"},"Please try again later")))}var an="https://app.rollouthq.com/api",ti="https://28e3dd4b02f14f2eb74768520edbc8a1@o345148.ingest.sentry.io/6463365";function pn(o){let{token:t,allowedApps:r,apiBaseUrl:n=an,children:e,env:i="production",onError:a}=o,[s]=(0,at.useState)(()=>new St.BrowserClient({dsn:ti,transport:St.makeFetchTransport,stackParser:St.defaultStackParser,integrations:St.defaultIntegrations})),l=(0,at.useCallback)((p,d)=>{a==null||a(p,d),i==="production"&&s.captureException(p,{data:{info:d}})},[i,s,a]);return at.default.createElement(ln.ErrorBoundary,{FallbackComponent:nn,onError:l},at.default.createElement(Le,{apiBaseUrl:n},at.default.createElement(Ue,{allowedApps:r},at.default.createElement(sn.RolloutAPIClientProvider,{token:t,apiBaseUrl:n??an},at.default.createElement(ir,null,at.default.createElement(fe,null,e))))))}var mn=require("@rollouthq/common");var un=require("@rollouthq/ui"),zo={border:"1px solid #D5DCE2",borderRadius:"8px",padding:"16px",marginTop:"24px",background:"white"},oi=(0,un.globalCss)({".rollout-automation-form__line-items-container":{border:"1px solid #DFE1E4",borderRadius:"8px"},".rollout-automation-form__line-items-header":{padding:"12px",display:"flex",gap:"12px",alignItems:"flex-start",flexDirection:"column",background:"linear-gradient(180deg, rgba(255, 255, 255, 0.03) 0%, rgba(0, 0, 0, 0.03) 100%), #FFFFFF"},".rollout-automation-form__line_items-description":{fontSize:"13px"},".rollout-automation-form__line-items-title":{fontSize:"13px",fontWeight:"600"},".rollout-automation-form__line-items-content":{padding:"16px",display:"flex",flexDirection:"column",gap:"16px"},".rollout-automations-list__container":{display:"flex",flexDirection:"column"},".rollout-automations-list__header":{display:"flex",paddingY:"16px",marginBottom:"16px",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #EFF1F4"},".rollout-automations-list__header-title":{fontWeight:"600"},".rollout-error-fallback__container":{boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"32px",gap:"16px",margin:"24px auto",width:"572px",height:"173px",border:"1px solid #D5DCE2",borderRadius:"8px"},".rollout-error-fallback__text-container":{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",width:"227px",height:"48px"},".rollout-error-fallback__message":{color:"#6C6F75",fontFamily:"Inter",fontStyle:"normal",fontWeight:"600",fontSize:"16px",lineHeight:"150%"},".rollout-error-fallback__additional-info":{color:"#6C6F75",fontFamily:"Inter",fontStyle:"normal",fontweight:"500",fontSize:"13px",lineHeight:"150%"},".rollout-combobox__input__spinner":{width:"1rem",height:"1rem"},".rollout-combobox__input":{width:"100%",paddingX:"$2",paddingY:"$2-5",background:"none",outline:"none",border:"none",cursor:"text",paddingRight:"40px",fontSize:"13px","&:focus":{borderColor:"$interactPrimary"},"[data-disabled]":{opacity:.4,cursor:"not-allowed"},".rollout-combobox__input__left-element[data-icon] ~ &":{paddingLeft:"40px"},"&:disabled":{cursor:"not-allowed"}},".rollout-select__tag":{margin:"2px",paddingX:"6px",paddingY:"1px",height:"fit-content",display:"flex",alignItems:"center",gap:"4px",background:"white",border:"1px solid #EFF1F4",borderRadius:"4px",fontWeight:"500",cursor:"pointer",whiteSpace:"nowrap"},".rollout-select__tag-icon":{color:"#91959C","&:hover":{color:"black"}},".rollout-select__input":{background:"none",outline:"none",border:"none",width:"100%","&:disabled":{cursor:"not-allowed"}},".rollout-select__input__group":{background:"#F8F9FB",height:"36px",paddingX:"8px",".rollout-select__input":{paddingLeft:"0"}},".rollout-form-control__input[data-error]":{".rollout-combobox__input__group, .rollout-select__input__group, .rollout__base-input":{borderColor:"$error"}},".rollout-combobox__input__group, .rollout-select__input__group":{position:"relative",overflow:"hidden",display:"flex",alignItems:"center",fontSize:"13px",outline:"none",overflowX:"hidden",borderWidth:"1px",borderRadius:"$md",borderStyle:"solid",borderColor:"$strokeMedium","&[data-focused]":{borderColor:"$interactPrimary"},"&[data-disabled]":{cursor:"not-allowed",color:"$grayMedium",backgroundColor:"$surfaceSecondary"}},".rollout-connect-combobox__label, .rollout-connect-select__label":{marginBottom:"$2",span:{color:"$primary"}},".rollout-combobox__input__left-element, .rollout-combobox__input__right-element":{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute","&:not([data-open])":{pointerEvents:"none"},"&[data-open]":{cursor:"pointer"},top:"50%",transform:"translateY(-50%)",zIndex:2,color:"#91959C",border:"none",background:"none"},".rollout-combobox__input__left-element":{size:"24px",left:"8px","&:not([data-icon])":{display:"none"},"[data-avatar][data-selected] &":{background:"transparent",border:"none",color:"white",fontSize:"$1"},borderWidth:"1px",borderColor:"#EFF1F4",borderStyle:"solid",borderRadius:"6px",background:"white"},".rollout-combobox__input__right-element, .rollout-select__input__right-element":{size:"16px",right:"8px"},".rollout-combobox__input__spinner, .rollout-select__input__spinner":{flexShrink:"0",size:"12px"},".rollout-combobox__content, .rollout-select__content":{maxHeight:"288px",overflowX:"hidden",overflowY:"auto",outline:"none",border:"solid 1px",borderColor:"#D5DCE2",borderRadius:"8px",".rollout-tab__list":{background:"#282A2F",padding:"10px 12px",fontSize:"13px",color:"white",fontWeight:"600",gap:"16px",border:"none"},".rollout-tabs__tab":{overflowX:"hidden !important",padding:"0",border:"none",color:"white",opacity:"0.4","&[data-selected]":{opacity:"1"}}},".rollout-select__multiple-alert":{display:"flex",alignItems:"center",gap:"8px",paddingX:"12px",paddingY:"8px",background:"#5386F6",color:"white",span:{fontSize:"13px",fontWeight:"500"}},".rollout-combobox__content ul":{margin:"0px",padding:"0px"},".rollout-select__content ul":{margin:"0px",padding:"0px"},".rollout-select__option-check__icon":{marginLeft:"auto"},".rollout-listbox":{width:"100%",margin:0,padding:0},".rollout-listbox__option, .rollout-select__option":{display:"flex",alignItems:"center",padding:"$2",fontSize:"$2",outline:"none",cursor:"pointer",borderBottom:"solid 1px",borderColor:"#F8F9FB","&[data-focused]":{background:"#F4F5F8"},"&[data-disabled]":{fontWeight:"500",color:"#91959C"},"&[data-selected]":{fontWeight:"500",color:"#5284F2",diaplay:"flex",alignItems:"center"}},".rollout-listbox__option-icon":{"[data-avatar] &":{background:"#C3C7CE;",color:"white",border:"none",borderRadius:"100%",padding:0,fontSize:"$1"},borderWidth:"1px",borderColor:"$strokeMedium",borderStyle:"solid",borderRadius:"$md",background:"white",size:"$6",padding:"$1",marginRight:"$1-5"},".rollout-automations-list__search-input":{paddingX:"40px",paddingY:"10px",borderRadius:"$md",outline:"none",borderWidth:"2px",borderColor:"#EFF1F4","&:focus":{borderColor:"$interactPrimary"},borderStyle:"solid",background:"#F8F9FB"},".rollout-automations-list__search-input__group":{position:"relative",display:"flex",marginBottom:"$4",color:"#91959C"},".rollout-automations-list__search-input__left-element":{position:"absolute",left:"0px",top:"0px",zIndex:2,display:"flex",size:"40px",fontSize:"$md",alignItems:"center",justifyContent:"center",pointerEvents:"none",svg:{size:"20px"}},".rollout-automations-list__not-found":{paddingInlineStart:"$4"},".rollout-form-control-find__container":{display:"flex",background:"#e0e1e4",width:"max-content",borderRadius:"6px"},".rollout-form-control-find__active":{color:"#5d88ef",fontSize:"0.8125rem",fontFamily:"inherit",fontWeight:"500",padding:"4px 36px",whiteSpace:"nowrap",background:"white",height:"32px",cursor:"pointer",borderRadius:"8px",border:"1px solid #e0e1e4"},".rollout-form-control-find__disabled":{color:"#6c6f75",fontFamily:"inherit",fontSize:"0.8125rem",fontWeight:"500",padding:"4px 36px",whiteSpace:"nowrap",background:"e0e0e5",height:"32px",cursor:"pointer",borderRadius:"8px"},".rollout-automations-list__new-btn":{display:"flex",alignItems:"center",gap:"8px",padding:"4px 12px",whiteSpace:"nowrap",backgroundColor:"#5386F7",color:"white",border:"none",borderRadius:"8px",height:"32px",cursor:"pointer"},".rollout-automations-list__empty-msg":{textAlign:"center",padding:"20px",border:"1px solid #eff1f4",borderRadius:"4px"},".rollout-automations-list__error-msg":{textAlign:"center",padding:"20px",border:"1px dashed #AA4849",borderRadius:"4px"},".rollout-automations-list__list":{display:"grid",gap:"16px",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))"},".rollout-automations-list__item-wrapper":{position:"relative",marginBottom:"8px",maxWidth:"343px",border:"1px solid #D5DCE2",borderRadius:"8px","&:hover":{border:"1px solid #ADB4BA"},"&[data-deleting]":{opacity:.4},"&[data-deleting]::after":{content:"''",position:"absolute",inset:0,userSelect:"none",cursor:"wait"}},".rollout-automations-list__item":{padding:"16px",cursor:"pointer"},".rollout-automations-list-item__header":{display:"flex",alignItems:"center",justifyContent:"space-between"},".rollout-automations-list-item__draft-badge":{marginLeft:"auto",marginRight:"10px",padding:"4px 8px",borderRadius:"40px",background:"$neutral-4",fontSize:"small",color:"white"},".rollout-automations-list-item__icons":{display:"inline-flex",".rollout-automations-list-item__trigger, .rollout-automations-list-item__action":{padding:"$1",borderStyle:"solid",borderWidth:"1px",borderColor:"$strokeMedium",borderRadius:"$md",fontSize:"24px"},":first-child":{borderStartEndRadius:"unset",borderEndEndRadius:"unset",marginRight:"-1px"},":last-child":{borderStartStartRadius:"unset",borderEndStartRadius:"unset"},size:"fit-content"},".rollout-automations-list-item__name":{marginTop:"12px",fontSize:"16px",fontWeight:"600",color:"#31373F",height:"72px"},".rollout-automations-list-item__options__trigger":{display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"4px",cursor:"pointer",color:"#91959C",transition:"all .2s ease",size:"32px",svg:{size:"16px"},"&:hover":{bg:"rgba(219, 97, 92, 0.1)",color:"#DB615C"},opacity:0,'[role="group"]:hover:not([data-open]) &':{opacity:1}},".rollout-automations-list-item__options__content":{position:"absolute",padding:"18px 16px",inset:"0",background:"white",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"12px",justifyContent:"center",alignItems:"center",span:{fontWeight:"600"}},".rollout-automations-list-item__options__delete-item-btn":{background:"#DB615C",color:"white",whiteSpace:"nowrap","&:hover":{background:"#C74D48"},cursor:"pointer"},".rollout-automations-list-item__options__cancel-item-btn":{border:"1px solid #282A2F",cursor:"pointer"},".rollout-automations-manager__navbar":{paddingY:"$3"},".rollout-automations-manager__back-btn":{border:"none",background:"none"},".rollout-automation-form__header-back__arrow":{cursor:"pointer"},".rollout-automations-list-item__options__content button":{fonSize:"13px",fontWeight:"500",borderRadius:"8px",height:"32px",width:"100%",cursor:"pointer",transition:"all .2s ease"},".rollout-automation-form__name":{height:"36px",fontWeight:500,fontSize:"13px",background:"none",border:"1px solid",borderColor:"$strokeDark",borderRadius:"8px",paddingX:"$4",paddingY:"$2-5",outline:"none","&[aria-invalid]::placeholder":{color:"$error"}},".rollout-automation-form__action-inputs-wrapper, .rollout-automation-form__trigger-inputs-wrapper":{display:"flex",flexDirection:"column",gap:"$3"},".rollout-automation-form__trigger":{...zo},".rollout-automation-form__trigger-inputs":{...zo},".rollout-automation-form__action":{...zo},".rollout-automation-form__action-inputs":{...zo},".rollout-automation-form__trigger-trigger":{marginBottom:"$3"},".rollout-automation-form__trigger .rollout-automation-form__trigger-app ":{marginBottom:"$3"},".rollout-automation-form__trigger .rollout-automation-form__credentials":{marginTop:"$3"},".rollout-automation-form__action .rollout-automation-form__action-app":{marginBottom:"$3"},".rollout-automation-form__action .rollout-automation-form__action-action":{marginBottom:"$3"},".rollout-automation-form__credential":{marginBottom:"$3"},".rollout-automation-form__label":{fontWeight:"600",marginBottom:"12px"},".rollout-automation-form__helper-text":{marginBottom:"12px"},".rollout-automation-form__content":{marginBottom:"16px"},".rollout-automation-form-oauth__error__message":{marginTop:"4px",fontSize:"$2",color:"$error"},".rollout-input":{height:"36px",paddingX:"$2",paddingY:"$2-5",border:"1px solid",borderColor:"$strokeMedium",borderRadius:"6px"},".rollout-button--primary, .rollout-button--secondary, .rollout-button--danger":{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",height:"32px",padding:"4px 12px",fontWeight:600,whiteSpace:"nowrap",textAlign:"center",border:"1px solid",borderRadius:"8px"},".rollout-button--primary":{backgroundColor:"#5386F7",borderColor:"#5386F7",color:"white"},".rollout-button--secondary":{backgroundColor:"$grayMedium",borderColor:"$grayMedium",color:"white"},".rollout-button--danger":{color:"white",backgroundColor:"$error",borderColor:"$error","&:hover":{backgroundColor:"#A92F2A",borderColor:"#A92F2A"}},".rollout-automation-form__buttons":{display:"flex",gap:"$3"},".rollout-automation-form__cancel":{marginLeft:"auto"},".rollout-automation-form__delete":{position:"relative",marginLeft:"auto",".rollout-automation-form__cancel ~ &":{marginLeft:"0"}},".rollout-automation-form-delete__confirm-dialog":{position:"absolute",bottom:"100%",right:"0",whiteSpace:"nowrap",background:"white",marginBottom:"12px",padding:"12px",border:"1px solid #F8F9FB",borderRadius:"8px",boxShadow:"0px 4px 16px rgba(0, 0, 0, 0.2)"},".rollout-automation-form__delete-confirm-text":{padding:"$3",fontSize:"$2",fontWeight:500},".rollout-automation-form__delete-confirm-buttons":{display:"flex",justifyContent:"space-between",gap:"$3",marginTop:"$4"},".rollout-automation-form__delete-cancel, .rollout-automation-form__delete-confirm":{width:"100%"},".rollout-automation-form__submit[disabled], .rollout-automation-form__submit[data-loading]":{opacity:.3},".rollout-form-control__label":{marginBottom:"8px",fontSize:"$2",fontWeight:500,display:"flex",alignItems:"center"},".rollout-form-control__lock-btn":{marginLeft:"auto",display:"flex",justifyContent:"center",alignItems:"center",border:"1px solid #EFF1F4",size:"20px",cursor:"pointer",borderRadius:"4px",boxShadow:"$md",color:"#91959C",transition:"all .2s ease","&[data-locked]":{color:"#9A58F6"},"&:hover":{background:"#F8F9FB"},svg:{height:"14px"}},".rollout-form-control__required-hint":{paddingLeft:"4px",color:"$primary"},".rollout-form-control__description":{marginBottom:"8px",fontSize:"13px"},".rollout-form-control__error":{marginTop:"4px",fontSize:"$2",color:"$error"},".rollout-automation-form__api-token-input":{height:"32px",marginTop:"$2",marginBottom:"$4",background:"#F8F9FB",border:"1px solid #EFF1F4",borderRadius:"4px",paddingX:"8px","&:focus":{background:"white"}},".rollout-automation-form__api-token-input-info":{fontSize:"0.75rem",marginBottom:"$1-5",color:"#6C6F75"},".rollout-automation-form__api-token-input-label":{fontSize:"$2",marginTop:"$1-5"},".rollout-automation-form__api-token-input-container":{marginTop:"$2"},".rollout-automation-form__api-token-connection-result":{fontSize:".85rem"},".rollout-automation-form__api-token-apitoken-button-container":{display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"$2-5"},".rollout-blueprint-activator__header":{display:"flex",alignItems:"center",borderBottom:"1px solid",borderBottomColor:"$strokeMedium",paddingY:"12px"},".rollout-blueprint-activator__name":{marginLeft:"16px"},".rollout-blueprint-activator__label":{padding:"12px",fontSize:"$3",fontWeight:"bold",borderBottom:"1px solid",borderBottomColor:"$strokeMedium"},".rollout-blueprint-activator__trigger":{marginTop:"12px",border:"1px solid",borderColor:"$strokeMedium",borderRadius:"8px","& .rollout-automation-form__credentials":{marginBottom:"$3"}},".rollout-blueprint-activator__trigger__fields":{padding:"12px"},".rollout-blueprint-activator__activate-btn, .rollout-blueprint-activator__deactivate-btn":{marginTop:"12px"},".rollout__loading_spinner_container":{padding:"1rem",display:"flex",justifyContent:"center"},".rollout__loading_spinner":{height:"1rem",width:"1rem"},".rollout__base-input":{background:"#F8F9FB",border:"1px solid #EFF1F4",borderRadius:"4px",paddingX:"8px","&:focus":{background:"white"}},"input.rollout__base-input, select.rollout__base-input":{height:"32px"},".rollout__terms-of-service-link, .rollout__privacy-policy-link":{color:"#31373F",textDecoration:"underline","&:hover":{color:"#1e2227"}},".ace_editor":{backgroundColor:"$surfaceSecondary"},".rollout-card":{display:"flex",flexDirection:"column",gap:"12px",marginTop:"12px",padding:"16px",border:"1px solid #d5dce2",borderRadius:"8px"}});0&&(module.exports={AutomationCreator,AutomationEditor,AutomationsManager,BlueprintActivator,BlueprintsList,BlueprintsManager,MyAutomations,MyBlueprints,PoweredByRollout,RolloutConnectProvider,components,curlyTemplate,defaultTheme});
//# sourceMappingURL=index.cjs.js.map