"use strict";var hn=Object.create;var Co=Object.defineProperty;var An=Object.getOwnPropertyDescriptor;var In=Object.getOwnPropertyNames;var vn=Object.getPrototypeOf,Pn=Object.prototype.hasOwnProperty;var oe=(o,t)=>{for(var r in t)Co(o,r,{get:t[r],enumerable:!0})},Pe=(o,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of In(t))!Pn.call(o,e)&&e!==r&&Co(o,e,{get:()=>t[e],enumerable:!(n=An(t,e))||n.enumerable});return o};var f=(o,t,r)=>(r=o!=null?hn(vn(o)):{},Pe(t||!o||!o.__esModule?Co(r,"default",{value:o,enumerable:!0}):r,o)),Fn=o=>Pe(Co({},"__esModule",{value:!0}),o);var di={};oe(di,{AutomationCreator:()=>Mo,AutomationEditor:()=>Vo,AutomationsManager:()=>tn,BlueprintActivator:()=>zo,BlueprintsList:()=>qo,BlueprintsManager:()=>an,MyAutomations:()=>Qo,MyBlueprints:()=>Wo,PoweredByRollout:()=>un,RolloutConnectProvider:()=>bn,TaskInitiator:()=>sn,components:()=>he,curlyTemplate:()=>xn.curlyTemplate,defaultTheme:()=>mi});module.exports=Fn(di);var he={};oe(he,{AutomationCreator:()=>Mo,AutomationEditor:()=>Vo,AutomationsManager:()=>tn,BlueprintActivator:()=>zo,BlueprintsList:()=>qo,BlueprintsManager:()=>an,MyAutomations:()=>Qo,MyBlueprints:()=>Wo,PoweredByRollout:()=>un,RolloutConnectProvider:()=>bn,TaskInitiator:()=>sn});var so=f(require("react")),Hr=require("@rollouthq/api-client-react");var I=f(require("react")),Zr=require("react"),Yr=require("spin-delay"),Lo=require("@rollouthq/api-client-react"),ce=require("@rollouthq/common");var Ko=f(require("react")),wo=require("react"),Jt=require("@rollouthq/common");var Kt={};oe(Kt,{BooleanInput:()=>jn,DropdownInput:()=>wn,FileBrowserInput:()=>zn,FindBy:()=>On,MultiSelectInput:()=>Ln,NoInputsComponent:()=>Qn,RichTextInput:()=>En});var V=f(require("react")),Po=require("@rollouthq/common");var ho=f(require("react"));var Fe=require("@rollouthq/ui"),[Se,N]=(0,Fe.createContext)({name:"AppComponentRenderer"});var ke=require("react"),Tt=require("ts-object-path"),Ke=require("@rollouthq/common");var De=require("ts-object-path"),$t=require("zod");function Te(o,t){let r=(0,De.getPath)(t);return ee(o,r)}function ee(o,t){let r=t.slice(1),n=o instanceof $t.ZodOptional?o.unwrap():o;if(n instanceof $t.ZodObject){let e=n.shape[t[0]];return t.length>1?ee(e,r):e}if(n instanceof $t.ZodRecord){let e=n.valueSchema;return t.length>1?ee(e,r):e}throw console.error("getByPath: unhandled prop type:",n),new Error("getByPath: unhandled prop type")}function R(o){let t=N(),{inputParams:r,setInputParams:n,importedData:e,credentialId:l,isBlueprintActivation:a}=t,i=(0,Tt.getPath)(o),s=(0,Tt.get)(r,o),u=(0,ke.useCallback)(T=>{let F=structuredClone(r);(0,Tt.set)(F,o,T),n(F)},[n,r]),m="inputParamsSchema"in e?e.inputParamsSchema:(0,Ke.inputDefToZodObject)(e.inputParamDefs),c=Te(m,o),d=c.isOptional(),p=c.description,g=(p==null?void 0:p.label)??Dn(i),_=(p==null?void 0:p.description)??"",A=(p==null?void 0:p.isCredentialDependent)??!1,h=m.safeParse(r),D=A&&l==null&&!a?void 0:Sn(h,o);return{value:s,setValue:u,isOptional:d,label:g,description:_,isCredentialDependent:A,error:D,path:i}}function Sn(o,t){let r=(0,Tt.getPath)(t);if(!o.success)return o.error.issues.find(n=>n.path.join(".")===r.join("."))}function Dn(o){return o.map(t=>Tn(t.toString())).join(" ")}function Tn(o){let t=o.replace(/([A-Z\d])/g,r=>` ${r.toLowerCase()}`);return`${t[0].toUpperCase()}${t.slice(1)}`}var kt=f(require("react")),we=require("@rollouthq/ui");function _o(o){let{label:t,description:r,error:n,isRequired:e,children:l}=o;return kt.default.createElement("div",{className:"rollout-form-control"},t&&kt.default.createElement("div",{className:"rollout-form-control__label"},t,e&&kt.default.createElement("span",{className:"rollout-form-control__required-hint"}," ","(required)")),r&&kt.default.createElement("div",{className:"rollout-form-control__description"},r),kt.default.createElement("div",{className:"rollout-form-control__input","data-error":(0,we.dataAttr)(!!n)},l),n&&kt.default.createElement("div",{className:"rollout-form-control__error"},n))}var Ao=require("@rollouthq/ui");function et(o){let{bind:t,children:r,description:n,error:e,isRequired:l=!1}=o,{credentialId:a,isBlueprintActivation:i=!1}=N(),s=R(t),u=s.isCredentialDependent&&a==null&&!i;if(i&&!s.isCredentialDependent)return null;function m(){return u?ho.default.createElement(Ao.Flex,{css:{alignItems:"center",padding:"8px",backgroundColor:"$surfaceSecondary",borderRadius:"4px",color:"$grayMedium",fontSize:"13px",fontWeight:500}},ho.default.createElement(Ao.UserForm,{css:{marginRight:"6px"}}),"Input provided by user when automation is activated"):r}let c=o.label??"";return ho.default.createElement(_o,{description:n,error:e,isRequired:l,label:c},m())}var Io=f(require("react"));var Oe=f(require("react"));function Be(o){return Oe.default.createElement("div",{className:"rollout-card"},o.children)}function O(o){let{defaultField:t,ctx:r,renderer:n}=o;return n==null||n===!0?Io.default.createElement(t,null):n===!1?null:n({...r,createElement:Io.createElement,Card:Be})}var Ne=require("@rollouthq/ui"),[vo,k]=(0,Ne.createContext)({name:"Form"});var Z=require("@rollouthq/ui"),[kn,Kn]=(0,Z.createContext)({name:"DropdownInput"});function wn(o){let r=R(o.bind).path.join("."),{renderInputParams:n}=N(),e=O({defaultField:Ee,renderer:n==null?void 0:n[r],ctx:{InputParamField:Ee}});return V.default.createElement(kn,{value:o},e)}function Ee(o){var C;let t=Kn(),{bind:r,dependencies:n,fetchOptions:e,allowOnlyVariables:l}=t,a=R(r),{value:i,setValue:s}=a,u=t.label??a.label,m=t.description??a.description,c=t.placeholder||"Select option",[d,p]=(0,V.useState)([]),[g,_]=(0,V.useState)(!1),{shouldShowErrors:A}=k(),{variables:h,disabled:D}=N(),T=t.isDisabled||D||n!=null&&n.every(Boolean)!==!0||o.disabled;(0,V.useEffect)(()=>{async function x(){_(!0);let ot=await e();p(ot),_(!1)}!l&&!T&&x()},[JSON.stringify(n),l,T]),(0,V.useEffect)(()=>{l&&i&&!(0,Po.isVariable)(i)&&s(void 0)},[l,i]);let F=h.map(x=>({id:`${Po.ROLLOUTHQ_VARIABLE_PREFIX}${x.id}`,name:`@${x.label}`})),M=[...F,...d],E=M.find(x=>x.id===i),$=V.default.createElement(Z.ComboBox,{"aria-label":"Variable dropdown",optionKey:"id",isDisabled:T,defaultItems:F,menuTrigger:"focus",selectedOption:E,isLoading:g,inputPlaceholder:c,onSelectionChange:x=>s(x==null?void 0:x.id)},V.default.createElement(Z.ComboBoxSection,{title:"Variables"},F.map(x=>V.default.createElement(Z.ComboBoxItem,{key:x.id},x.name)))),tt=V.default.createElement(Z.ComboBox,{"aria-label":"Variable dropdown",optionKey:"id",isDisabled:T,defaultItems:M,menuTrigger:"focus",selectedOption:E,key:i,isLoading:g,inputPlaceholder:c,onSelectionChange:x=>s(x==null?void 0:x.id)},V.default.createElement(Z.ComboBoxSection,{title:"Options"},d.map(x=>V.default.createElement(Z.ComboBoxItem,{key:x.id},x.name))),V.default.createElement(Z.ComboBoxSection,{title:"Variables"},F.map(x=>V.default.createElement(Z.ComboBoxItem,{key:x.id},x.name)))),lt=l?$:tt;return V.default.createElement(et,{bind:r,label:u,description:m,error:A?(C=a.error)==null?void 0:C.message:void 0,isRequired:!a.isOptional},lt)}var ct=f(require("react"));function On(o){var d;let{filterInput:t,filterValueInput:r,selectInput:n}=o,{bind:e}=o,l=R(e),{shouldShowErrors:a}=k(),{value:i,setValue:s,isOptional:u}=l,m=o.label??l.label,c=o.description??l.description;return(0,ct.useEffect)(()=>{i==null&&s("filter")},[i]),ct.default.createElement(ct.default.Fragment,null,ct.default.createElement(et,{bind:e,label:m,isRequired:!u,description:c,error:a?(d=l.error)==null?void 0:d.message:void 0},ct.default.createElement("div",{className:"rollout-form-control-find__container"},ct.default.createElement("button",{type:"button","aria-label":"Search from list button",className:i=="select"?"rollout-form-control-find__active":"rollout-form-control-find__disabled",onClick:()=>s("select")},"From list"),ct.default.createElement("button",{type:"button","aria-label":"Search by filter button",className:i=="filter"?"rollout-form-control-find__active":"rollout-form-control-find__disabled",onClick:()=>s("filter")},"From search"))),i=="filter"&&t,i=="filter"&&r,i=="select"&&n)}var ft=f(require("react")),Re=require("@rollouthq/common");var Fo=require("@rollouthq/ui"),[Bn,Nn]=(0,Fo.createContext)({name:"RichTextInput"});function En(o){let r=R(o.bind).path.join("."),{renderInputParams:n}=N(),e=O({defaultField:$e,renderer:n==null?void 0:n[r],ctx:{InputParamField:$e}});return ft.default.createElement(Bn,{value:o},e)}function $e(o){var _;let t=Nn(),{bind:r,inputProps:n,placeholder:e}=t,l=R(r),a=t.label??l.label,i=t.description??l.description,s=N(),{variables:u}=s,{shouldShowErrors:m}=k(),c=s.disabled||t.disabled||o.disabled,d=!l.isOptional||t.isRequired,p=(0,ft.useCallback)(A=>{l.setValue(A??void 0)},[l.setValue]),g=(0,ft.useMemo)(()=>l.value&&(0,Re.resolveMentions)(l.value,u),[l.value,u]);return ft.default.createElement(et,{bind:r,label:a,isRequired:d,description:i,error:m?(_=l.error)==null?void 0:_.message:void 0},ft.default.createElement("div",{className:"rollout-rich-text-input"},ft.default.createElement(Fo.RichEditor,{value:g??null,setValue:p,placeholder:e,formattingEnabled:!1,linksEnabled:!1,mentionVariables:u,isDisabled:c,...n})))}var gt=f(require("react"));var So=require("@rollouthq/ui"),[$n,Rn]=(0,So.createContext)({name:"MultiSelectInput"});function Ln(o){let r=R(o.bind).path.join("."),{renderInputParams:n}=N(),e=O({defaultField:Le,renderer:n==null?void 0:n[r],ctx:{InputParamField:Le}});return gt.default.createElement($n,{value:o},e)}function Le(o){var D;let t=Rn(),{bind:r,dependencies:n,fetchOptions:e,placeholder:l}=t,a=R(r),i=N(),{value:s,setValue:u}=a,m=t.label??a.label,c=t.description??a.description,d=i.disabled||o.disabled||!(n!=null&&n.every(Boolean)),[p,g]=(0,gt.useState)([]),[_,A]=(0,gt.useState)(!1),{shouldShowErrors:h}=k();return(0,gt.useEffect)(()=>{async function T(){if(A(!0),!d){let F=await e();g(F)}A(!1)}T()},[d]),gt.default.createElement(et,{bind:r,label:m,description:c,error:h?(D=a.error)==null?void 0:D.message:void 0},gt.default.createElement(So.MultiSelect,{label:m,isDisabled:d,items:p,isLoading:_,inputPlaceholder:l||"Select option",onSelectionChange:T=>{u(T.map(F=>F.id).join(", "))},value:s}))}var Do=f(require("react"));var Ve=require("@rollouthq/ui"),[Mn,Vn]=(0,Ve.createContext)({name:"BooleanInput"});function jn(o){let r=R(o.bind).path.join("."),{renderInputParams:n}=N(),e=O({defaultField:Me,renderer:n==null?void 0:n[r],ctx:{InputParamField:Me}});return Do.default.createElement(Mn,{value:o},e)}function Me(o){var d;let t=Vn(),{bind:r}=t,n=R(r),{shouldShowErrors:e}=k(),a=N().disabled||o.disabled,{value:i,setValue:s,isOptional:u}=n,m=t.label??n.label,c=t.description??n.description;return Do.default.createElement(et,{bind:r,label:m,isRequired:!u,description:c,error:e?(d=n.error)==null?void 0:d.message:void 0},Do.default.createElement("input",{type:"checkbox",checked:i,disabled:a,onChange:p=>s(p.target.checked)}))}var re=f(require("react")),Qn=()=>re.default.createElement(re.default.Fragment,null,"No inputs");var To=f(require("react"));var ko=require("@rollouthq/ui");function zn(o){var A;let{fetchOptions:t,dependencies:r,isDisabled:n,bind:e,selectionMode:l}=o,a=R(e),{value:i,setValue:s}=a,u=o.label??a.label,m=o.description??a.description,{shouldShowErrors:c}=k(),{variables:d,disabled:p}=N(),g=n||p||r!=null&&r.every(Boolean)!==!0,_=To.default.createElement(ko.Spinner,{className:"rollout-combobox__input__spinner"});return To.default.createElement(et,{bind:e,label:u,isRequired:!a.isOptional||o.isRequired,description:m,error:c?(A=a.error)==null?void 0:A.message:void 0},To.default.createElement(ko.FileBrowser,{selectionMode:l,fetchOptions:t,dependencies:r,disabled:g,value:i,setValue:s}))}var je=require("react"),Qe=f(require("react")),ze=require("@rollouthq/ui"),[Un,Rt]=(0,ze.createContext)({name:"RolloutApiBaseUrlContext"});function Ue(o){let{children:t,...r}=o,n=(0,je.useMemo)(()=>r,Object.values(r));return Qe.default.createElement(Un,{value:n},t)}var qe=typeof document>"u"?wo.useEffect:Ko.useLayoutEffect;function Lt(o){let{apiBaseUrl:t}=Rt(),[r,n]=(0,wo.useState)();return qe(()=>{Object.assign(window,{ROLLOUT_CONNECT_DEPS:{zod:{z:Jt.z},react:Ko.default,["@rollouthq/common"]:{z:Jt.z,isVariable:Jt.isVariable},["@rollouthq/connect-react/components/action-inputs"]:Kt}})},[]),qe(()=>{if(o==null)return n(void 0);if(!o.appKey||!o.triggerKey)return;let e=o.isTask?"task-triggers":"triggers",l=`${t}/connect-react/${o.appKey}/${e}/${o.triggerKey}.js`;new Function("path","return import(path)")(l).then(i=>{n(i)})},[JSON.stringify(o)]),r}var We=require("react"),Ze=f(require("react")),Ye=require("@rollouthq/ui"),[qn,He]=(0,Ye.createContext)({name:"RolloutAllowedAppsContextProvider"});function Xe(o){let{children:t,...r}=o,n=(0,We.useMemo)(()=>r,Object.values(r));return Ze.default.createElement(qn,{value:n},t)}var Je=require("react"),Ge=require("@rollouthq/api-client-react");function tr(o){let t=(0,Ge.useLazyQuery)("apps.actions");return(0,Je.useEffect)(()=>{(o==null?void 0:o.appKey)!=null&&t.fetch({appKey:o.appKey})},[o==null?void 0:o.appKey]),t}var or=require("@rollouthq/api-client-react");function er(o){let{allowedApps:t}=o;return(0,or.useQuery)(["apps.list"],{select:t!=null?r=>r.filter(n=>t.includes(n.key)):void 0})}var ir=f(require("assert")),ar=require("react"),ne=require("@rollouthq/api-client-react/");var rr=f(require("popup-centered")),wt=require("react"),nr=require("@rollouthq/api-client-react");function Oo(o){let[t,r]=(0,wt.useState)(null),[n,e]=(0,wt.useState)(),{client:l}=(0,nr.useTRPCContext)();(0,wt.useEffect)(()=>{function i(s){var m;let u=s.data._rollouthq;u!=null&&u.ok?(u==null?void 0:u.type)==="credential-added"&&u.appKey===n&&u.credentialId!=null&&((m=o.onCredentialAdded)==null||m.call(o,u.credentialId)):u!=null&&u.error&&r(u.error)}return window.addEventListener("message",i,!1),()=>{window.removeEventListener("message",i)}},[n]);let a=(0,wt.useCallback)(async i=>{e(i.appKey),r(null);try{let{url:s}=await l.query("oauth.getURL",{appKey:i.appKey,customParams:i.customParams});(0,rr.default)(s,"",{width:800,height:800})}catch{r("Woops! Something went wrong linking account.")}},[]);return{oauthPopupError:t,openOAuthPopup:a}}function Gt(o){let{appKey:t,setCredentialId:r}=o,{openOAuthPopup:n}=Oo({onCredentialAdded:s=>{r(s),a.refetch()}}),l=(0,ne.useQuery)(["apps.authInfo",{appKey:t}],{enabled:t!=null}).data,a=(0,ne.useQuery)(["apps.credentials",{appKey:t,authType:l==null?void 0:l.type}],{enabled:t!=null&&l!=null}),i=a.data;(0,ar.useEffect)(()=>{if(!(l==null||i==null)){if(l.type==="none"||l.type==="apiKey"&&l.singleCredentialOnly){let s=i.length>0;return(0,ir.default)(s,"No credentials found!"),r(i[0].id)}(l.type==="oauth1"||l.type==="oauth2")&&l.singleCredentialOnly&&(i.length===0?n({appKey:t}):r(i[0].id))}},[l,i])}var Pt=require("@rollouthq/ui");var Y=f(require("react"));var lr=f(require("react"));var sr=require("@rollouthq/ui");function B(o){let{apiBaseUrl:t}=Rt(),{appKey:r,css:n}=o,e=`${t}/connect-react/${r}/icon`;return lr.default.createElement(sr.st.img,{key:r,src:e,css:{width:"1em",...n}})}var to=f(require("react")),ur=require("@rollouthq/api-client-react"),pr=require("@rollouthq/ui/"),[Wn,Bo]=(0,pr.createContext)({name:"RolloutEndUserProvider"});function mr(o){var n;let r=(n=(0,ur.useQuery)(["end-users.getInfo"]).data)==null?void 0:n.appKey;return r==null?null:to.default.createElement(Zn,{appKey:r},o.children)}function Zn(o){let{appKey:t}=o,r=(0,to.useMemo)(()=>({appKey:t}),[t]);return to.default.createElement(Wn,{value:r},o.children)}var No=require("ts-object-path");function _t(o,t){if(o.success)return;let r=(0,No.createProxy)(),n=(0,No.getPath)(t(r));return o.error.issues.find(e=>e.path.join(".")===n.join("."))}var ht=require("@rollouthq/ui");var dr=require("@rollouthq/ui"),[cr,L]=(0,dr.createContext)({name:"AutomationForm"});function Yn(o){var c,d;let{appKey:t}=Bo(),{apps:r,data:n,setData:e,validation:l}=L(),{action:a}=n,i=_t(l,p=>p.action),s=(0,Y.useMemo)(()=>{var p;return((p=r.data)==null?void 0:p.filter(g=>g.hasActions))??[]},[r.data]),u=(c=r.data)==null?void 0:c.find(p=>p.key===(a==null?void 0:a.appKey)),{shouldShowErrors:m}=k();return Y.default.createElement("div",{className:"rollout-automation-form__action-app"},Y.default.createElement("div",{style:{display:"none"}},(d=r.data)==null?void 0:d.map(p=>Y.default.createElement(B,{key:p.key,appKey:p.key}))),Y.default.createElement(ht.FormControl,{error:m?i==null?void 0:i.message:void 0},Y.default.createElement(ht.ComboBox,{"aria-label":"Action dropdown",defaultItems:s,selectedOption:u,isDisabled:o.isDisabled,icon:u==null?void 0:Y.default.createElement(B,{appKey:u.key}),inputPlaceholder:"Select app",menuTrigger:"focus",onSelectionChange:p=>e(g=>{var F;if(p==null)return{...g,action:void 0};let _=p.key===t,A=((F=g.trigger)==null?void 0:F.appKey)===t,T=_&&A||!_&&!A;return{...g,action:{appKey:p.key,inputParams:{}},trigger:T?void 0:g.trigger}})},p=>Y.default.createElement(ht.ComboBoxItem,{key:p._comboboxKey,textValue:p.name},Y.default.createElement(ht.Center,{className:"rollout-listbox__option-icon"},Y.default.createElement(B,{appKey:p.key})),p.name))))}function oo(o){return Y.default.createElement(Yn,{isDisabled:o.disabled})}var eo=f(require("react")),hr=require("@rollouthq/api-client-react/");var _r=f(require("assert")),P=f(require("react")),Eo=require("@rollouthq/api-client-react");var j=f(require("react")),br=require("@rollouthq/api-client-react"),yr=require("@rollouthq/ui");var At=f(require("react")),fr=require("@rollouthq/ui"),gr=(0,At.forwardRef)((o,t)=>{let{isTestingConnection:r,value:n,onChange:e}=o,{infoHTML:l,label:a,placeholder:i}=o.definition;return At.default.createElement("div",null,At.default.createElement("label",{className:"rollout-automation-form__api-token-input-label"},a),l!=null&&At.default.createElement("div",{dangerouslySetInnerHTML:{__html:l},className:"rollout-automation-form__api-token-input-info"}),At.default.createElement("div",null,At.default.createElement(fr.TextField,{ref:t,className:"rollout-automation-form__api-token-input","aria-label":"Token input text field",isDisabled:r,placeholder:i,value:n,onChange:e})))});function xr(o){let{appKey:t,saveApiToken:r,authType:n,firstApiTokenInput:e,openOAuthPopup:l,closeModal:a,savingApiToken:i}=o,[s,u]=(0,j.useState)({}),[m,c]=(0,j.useState)(!1),[d,p]=(0,j.useState)(!1),[g,_]=(0,j.useState)(!1),A=(0,br.useMutation)("credentials.test-connection"),h=D();(0,j.useEffect)(()=>{m&&(c(!1),p(!1))},[s]);function D(){return"customParams"in n&&n.customParams!=null?n.customParams.every($=>(s==null?void 0:s[$.key])!=null):!0}function T(){_(!0),A.mutate({appKey:t,apiToken:s},{onSuccess:$=>{c(!0),p($),_(!1)}})}function F(){var $;if(n==null)return null;if("customParams"in n)return($=n.customParams)==null?void 0:$.map((tt,lt)=>j.default.createElement(gr,{key:lt,ref:lt===0?e:void 0,definition:tt,value:(s==null?void 0:s[tt.key])??"",onChange:C=>u({...s,[tt.key]:C}),isTestingConnection:g}))}let M=()=>{l({appKey:t,customParams:s}),_(!1),a()},E=()=>{d&&s!=null?r(s):T()};return j.default.createElement("div",{className:"rollout-automation-form__api-token-input-container"},F(),(n==null?void 0:n.type)==="apiKey"?j.default.createElement("div",{className:"rollout-automation-form__api-token-apitoken-button-container"},j.default.createElement("button",{type:"button","aria-label":"Save button",disabled:!h||g||i,className:`rollout-button--primary ${g?"rollout-automation-form__api-token-test-button":"rollout-automation-form__api-token-save-button"}`,onClick:E},(g||i)&&j.default.createElement(yr.Spinner,null),m&&d?"Save":g?"Testing Connection ...":"Test Connection"),m&&j.default.createElement("span",{className:"rollout-automation-form__api-token-connection-result"},d?"\u2705 Connection Success":"\u26A0\uFE0F Woops! Check your credentials")):j.default.createElement("button",{type:"button","aria-label":"Save button",disabled:!h||g||i,className:"rollout-button--primary",onClick:M},"Add account"))}var w=require("@rollouthq/ui"),Cr={id:"ADD_OPTION",label:"Add new account",avatar:void 0,icon:P.default.createElement(w.Plus,null)};function Hn(o){let{isDisabled:t,appKey:r,setCredentialId:n,credentialId:e,authInfoQuery:l,error:a}=o,{shouldShowErrors:i}=k(),[s,u]=(0,P.useState)(!1),[m,c]=(0,P.useState)(!1),d=(0,Eo.useMutation)("credentials.add-api-token"),p=(0,Eo.useQuery)(["apps.credentials",{appKey:r}]),g=(0,P.useRef)(null),_=(0,P.useRef)(null),[A,h]=(0,P.useState)(!1),{openOAuthPopup:D,oauthPopupError:T}=Oo({onCredentialAdded:C=>{n(C),p.refetch()}});(0,P.useEffect)(()=>{u(T!=null)},[T]);let F=(0,P.useMemo)(()=>[...p.data??[],Cr],[p.data]),M=F.find(C=>C.id===e),E=A?P.default.createElement(w.GreenPlus,null):M&&M.avatar!=null?P.default.createElement(w.Avatar,{src:M.avatar,name:M.label,alt:M.label}):P.default.createElement(w.Person,null);function $(C){C!=null&&(c(!0),d.mutate({appKey:r,credential:C},{onSuccess:x=>{var ot;h(!1),p.refetch(),(ot=_.current)==null||ot.blur(),n(x),c(!1)},onError:()=>c(!1)}))}let tt=F,lt=tt.find(C=>C.id===e);return P.default.createElement("div",{className:"rollout-automation-form__credentials","data-avatar":!0,"data-selected":(0,w.dataAttr)((M==null?void 0:M.avatar)!=null)},P.default.createElement(w.FormControl,{error:i?a==null?void 0:a.message:void 0},P.default.createElement(w.ComboBox,{"aria-label":"Account dropdown",customRef:_,defaultItems:tt,selectedOption:lt,menuTrigger:"focus",icon:E,isDisabled:t,isLoading:p.isFetching||l.isFetching,inputPlaceholder:A?"Connect new account":"Select account",onSelectionChange:C=>{if(C==null)return n(void 0);let x=l.data,ot=C===Cr;if((0,_r.default)(x!=null,"No app auth info"),ot){(x.type==="oauth1"||x.type==="oauth2")&&(x.customParams!=null?(h(!0),setTimeout(()=>{var dt;return(dt=g.current)==null?void 0:dt.focus()})):D({appKey:r})),x.type==="apiKey"&&(h(!0),setTimeout(()=>{var dt;return(dt=g.current)==null?void 0:dt.focus()})),u(!1);return}u(!1),h(!1),n(C.id)}},C=>(r==="gmail"||r==="googleCalendar"||r==="googleDocs"||r==="googleSheets")&&C.id==="ADD_OPTION"?P.default.createElement(w.ComboBoxItem,{key:C._comboboxKey,textValue:C.label},P.default.createElement(w.GoogleSignIn,null)):P.default.createElement(w.ComboBoxItem,{key:C._comboboxKey,textValue:C.label},P.default.createElement(w.Center,{className:"rollout-listbox__option-icon"},P.default.createElement(w.Avatar,{"aria-label":"Option icon",src:C.avatar,name:"icon"in C?null:C.label,alt:C.label,icon:"icon"in C?C.icon:void 0})),C.label))),s&&P.default.createElement("div",{className:"rollout-automation-form-oauth__error__message"},T??"Oops! Couldn't link that account."),A&&l.data!=null&&P.default.createElement(xr,{appKey:r,authType:l.data,saveApiToken:$,savingApiToken:m,credentialId:e,firstApiTokenInput:g,openOAuthPopup:D,closeModal:()=>h(!1)}))}function Ot(o){let{appKey:t,authInfoQuery:r,credentialId:n,error:e,setCredentialId:l,isDisabled:a}=o,i=r.data;return i==null||(i.type==="oauth1"||i.type==="oauth2"||i.type==="apiKey")&&i.singleCredentialOnly||i.type==="none"?null:P.default.createElement(Hn,{appKey:t,authInfoQuery:r,credentialId:n,setCredentialId:l,error:e,isDisabled:a})}function Xn(o){let{appKey:t,credentialId:r,setCredentialId:n,error:e,isDisabled:l}=o,a=(0,hr.useQuery)(["apps.authInfo",{appKey:t}]);return a.data==null?null:eo.default.createElement(Ot,{appKey:t,authInfoQuery:a,credentialId:r,setCredentialId:n,error:e,isDisabled:l})}function ro(o){let{data:t,setData:r,validation:n}=L(),{action:e}=t,l=(0,eo.useCallback)(a=>r(i=>({...i,action:{...i.action,credentialId:a}})),[]);return(e==null?void 0:e.actionKey)==null?null:eo.default.createElement(Xn,{appKey:e.appKey,credentialId:e.credentialId,setCredentialId:l,error:n.success?void 0:n.error.issues.find(a=>a.path.join(".")==="action.credentialId"),isDisabled:o.disabled})}var It=f(require("react"));var vt=require("@rollouthq/ui");function Jn(o){var d;let{data:t,setData:r,actions:n,validation:e}=L(),{shouldShowErrors:l,setShouldShowErrors:a}=k(),s=(()=>e.success?null:e.error.issues.find(p=>p.path.join(".")==="action.actionKey"))(),u=t.action!=null?It.default.createElement(B,{appKey:t.action.appKey}):void 0,m=n.data??[],c=(d=n.data)==null?void 0:d.find(p=>{var g;return p.key===((g=t.action)==null?void 0:g.actionKey)});return It.default.createElement("div",{className:"rollout-automation-form__action-action"},It.default.createElement(vt.FormControl,{error:l?s==null?void 0:s.message:void 0},It.default.createElement(vt.ComboBox,{"aria-label":"Action dropdown",defaultItems:m,selectedOption:c,isDisabled:o.isDisabled,icon:u,isLoading:n.isLoading,inputPlaceholder:"Select action",menuTrigger:"focus",onSelectionChange:p=>(a(!1),r(g=>({...g,action:{...g.action,actionKey:p==null?void 0:p.key,inputParams:{}}})))},p=>It.default.createElement(vt.ComboBoxItem,{key:p._comboboxKey,textValue:p.name},It.default.createElement(vt.Center,{className:"rollout-listbox__option-icon"},u),p.name))))}function no(o){return It.default.createElement(Jn,{isDisabled:o.disabled})}var Rr=f(require("assert")),Nt=f(require("react"));var bt=f(require("react")),Er=require("@rollouthq/api-client-react");var jt=f(require("react")),Or=require("ts-object-path"),Br=require("@rollouthq/api-client-react");var Vt=f(require("react")),kr=require("ts-assert-unreachable");var Ar=f(require("react")),Ir=require("@rollouthq/ui/");function vr(o){return Ar.default.createElement(Ir.TextField,{className:"rollout-input",value:o.value??"",onChange:o.setValue,isDisabled:o.isDisabled})}var ie=f(require("react")),Pr=require("@rollouthq/common"),Fr=require("@rollouthq/ui");function Sr(o){let t=o.value&&(0,Pr.resolveMentions)(o.value,o.variables);return ie.default.createElement("div",{className:"rollout-rich-text-input"},ie.default.createElement(Fr.RichEditor,{value:t??null,setValue:r=>o.setValue(r??void 0),formattingEnabled:!1,linksEnabled:!1,mentionVariables:o.variables,isDisabled:o.isDisabled}))}var Kr=require("@rollouthq/ui/");var ae=f(require("react")),Mt=require("@rollouthq/ui");function Dr(o){let{def:t,value:r,setValue:n,getDynamicOptions:e}=o,a=(0,Mt.useAsyncMemo)(async()=>{var s;return((s=t.dropdownConfiguration)==null?void 0:s.type)==="static"?t.dropdownConfiguration.staticOptions.map(u=>({key:u,label:u})):await e({inputKey:t.key})},[JSON.stringify(t.dropdownConfiguration)]).value??[],i=a.find(s=>s.key===r);return ae.default.createElement(Mt.ComboBox,{defaultItems:a,selectedOption:i,menuTrigger:"focus",icon:null,inputPlaceholder:"Select option",onSelectionChange:s=>{n(s==null?void 0:s.key)},isDisabled:o.isDisabled},s=>ae.default.createElement(Mt.ComboBoxItem,{key:s._comboboxKey,textValue:s.label},s.label))}var[Gn,ti]=(0,Kr.createContext)({name:"InputDefRenderer"});function wr(o){let{renderInputParams:t}=N(),r=O({defaultField:Tr,renderer:t==null?void 0:t[o.def.key],ctx:{InputParamField:Tr}});return Vt.default.createElement(Gn,{value:o},r)}function Tr(o){let t=ti(),{def:r,value:n,setValue:e,variables:l,getDynamicOptions:a}=t;function i(){if(r.type==="plainText")return Vt.default.createElement(vr,{def:r,value:n,setValue:e,isDisabled:o.disabled});if(r.type==="dropdown")return Vt.default.createElement(Dr,{def:r,value:n,setValue:e,getDynamicOptions:a,isDisabled:o.disabled});if(r.type==="string")return Vt.default.createElement(Sr,{def:r,value:n,setValue:e,variables:l,isDisabled:o.disabled});(0,kr.unreachableCase)(r)}return Vt.default.createElement(_o,{label:r.label,isRequired:!0,error:void 0},i())}var oi=(0,Or.createProxy)();function Bt(o){let{api:t,credentialId:r,inputParams:n,setInputParams:e,importedData:l,variables:a,getDynamicOptions:i}=o;return jt.default.createElement(Se,{value:o},"Component"in l?jt.default.createElement(l.Component,{b:oi,credentialId:r,inputParams:n,setInputParams:e,api:t,useQuery:Br.useQuery,inputComponents:Kt}):jt.default.createElement(jt.default.Fragment,null,l.inputParamDefs.map(s=>jt.default.createElement(wr,{key:s.key,def:s,value:n[s.key],setValue:u=>e({...n,[s.key]:u}),variables:a,getDynamicOptions:i}))))}var $o=f(require("react")),Ro=require("react"),io=require("@rollouthq/common");var Nr=typeof document>"u"?Ro.useEffect:$o.useLayoutEffect;function Qt(o){let{actionRef:t}=o,{apiBaseUrl:r}=Rt(),[n,e]=(0,Ro.useState)();return Nr(()=>{Object.assign(window,{ROLLOUT_CONNECT_DEPS:{zod:{z:io.z},react:$o.default,["@rollouthq/common"]:{z:io.z,isVariable:io.isVariable},["@rollouthq/connect-react/components/action-inputs"]:Kt}})},[]),Nr(()=>{if(t!=null){let{appKey:l,actionKey:a}=t;if(!l||!a)return;let i=`${r}/connect-react/${l}/actions/${a}.js`;new Function("path","return import(path)")(i).then(u=>e(u))}},[t==null?void 0:t.appKey,t==null?void 0:t.actionKey]),n}function $r(){return bt.default.createElement("div",{className:"rollout-automation-form__action-inputs"},bt.default.createElement("div",null,bt.default.createElement("div",{className:"rollout-automation-form__label"},"Set up action"),bt.default.createElement(le,null)))}function le(){let{client:o}=(0,Er.useTRPCContext)(),{data:t,setData:r,variables:n,renderFields:e}=L(),l=t.action,a=Qt({actionRef:t.action}),i=(0,bt.useCallback)(u=>{r(m=>({...m,action:{...m.action,inputParams:u}}))},[r]);if(a==null||l.credentialId==null)return null;let s=typeof(e==null?void 0:e.action)=="object"?e.action.inputParams:void 0;return bt.default.createElement("div",{className:"rollout-automation-form__action-inputs-wrapper"},bt.default.createElement(Bt,{api:o,credentialId:l.credentialId,inputParams:l.inputParams,setInputParams:i,renderInputParams:s,importedData:a,variables:n,getDynamicOptions:()=>{throw new Error("Dynamic options not implemented in actions")}}))}function se(){var a,i,s;let{data:o,renderFields:t}=L(),{action:r}=o;(0,Rr.default)(typeof(t==null?void 0:t.action)!="function"&&typeof(t==null?void 0:t.action)!="boolean");let n=O({defaultField:oo,renderer:(a=t==null?void 0:t.action)==null?void 0:a.appKey,ctx:{ActionAppKeyField:oo}}),e=O({defaultField:no,renderer:(i=t==null?void 0:t.action)==null?void 0:i.actionKey,ctx:{ActionKeyField:no}}),l=O({defaultField:ro,renderer:(s=t==null?void 0:t.action)==null?void 0:s.credentialId,ctx:{ActionCredentialIdField:ro}});return Nt.default.createElement(Nt.default.Fragment,null,Nt.default.createElement("div",{className:"rollout-automation-form__action"},Nt.default.createElement("div",{className:"rollout-automation-form__label"},"Select action"),Nt.default.createElement("div",{className:"rollout-automation-form__helper-text"},"This is what your automation will do when triggered"),n,e,l),(r==null?void 0:r.actionKey)!=null&&r.credentialId!=null&&Nt.default.createElement($r,null))}var zr=f(require("assert")),z=f(require("react")),Ur=require("@rollouthq/api-client-react");var st=f(require("react")),Lr=require("@rollouthq/api-client-react");var ut=require("@rollouthq/ui");function ei(o){let{appKey:t}=Bo(),{data:r,setData:n,validation:e,mode:l}=L(),{trigger:a}=r,i=(0,Lr.useQuery)([l==="task"?"triggers.taskApps":"triggers.apps"]),{shouldShowErrors:s}=k(),u=_t(e,d=>d.trigger),m=i.data??[],c=m==null?void 0:m.find(d=>d.key===(a==null?void 0:a.appKey));return st.default.createElement("div",{className:"rollout-automation-form__trigger-app"},st.default.createElement(ut.FormControl,{error:s?u==null?void 0:u.message:void 0},st.default.createElement(ut.ComboBox,{"aria-label":"Trigger app dropdown",defaultItems:m,selectedOption:c,menuTrigger:"focus",icon:a==null?st.default.createElement(ut.Rocket,null):st.default.createElement(B,{appKey:a.appKey}),isDisabled:o.isDisabled,inputPlaceholder:"Select app",onSelectionChange:d=>n(p=>{var T;if(d==null)return{...p,trigger:void 0};let g=d.key===t,_=((T=p.action)==null?void 0:T.appKey)===t,D=g&&_||!g&&!_;return{...p,trigger:{appKey:d.key,inputParams:{}},action:D?void 0:p.action}})},d=>st.default.createElement(ut.ComboBoxItem,{key:d._comboboxKey,textValue:d.name},st.default.createElement(ut.Center,{className:"rollout-listbox__option-icon"},st.default.createElement(B,{appKey:d.key})),d.name))))}function ao(o){return st.default.createElement(ei,{isDisabled:o.disabled})}var pt=f(require("react")),Mr=require("@rollouthq/api-client-react");var rt=require("@rollouthq/ui");function ri(o){let{isDisabled:t}=o,{shouldShowErrors:r}=k(),{validation:n,data:e,setData:l,mode:a}=L(),{trigger:i}=e,s=(0,Mr.useQuery)(["apps.triggers",{appKey:i==null?void 0:i.appKey,isTask:a==="task"}],{enabled:(i==null?void 0:i.appKey)!=null}),u=_t(n,d=>d.trigger.triggerKey),m=s.data??[],c=m.find(d=>d.key===(i==null?void 0:i.triggerKey));return pt.default.createElement(rt.FormControl,{error:r?u==null?void 0:u.message:void 0},pt.default.createElement(rt.ComboBox,{"aria-label":"Trigger dropdown",defaultItems:m,selectedOption:c,menuTrigger:"focus",isDisabled:t||s.isLoading,icon:(i==null?void 0:i.appKey)==null?pt.default.createElement(rt.Rocket,null):pt.default.createElement(B,{appKey:i==null?void 0:i.appKey}),inputPlaceholder:"Select trigger",onSelectionChange:d=>l(p=>({...p,trigger:{...p.trigger,triggerKey:d==null?void 0:d.key,inputParams:{}}}))},d=>pt.default.createElement(rt.ComboBoxItem,{key:d._comboboxKey,textValue:d.name},pt.default.createElement(rt.Center,{className:"rollout-listbox__option-icon"},(i==null?void 0:i.appKey)==null?pt.default.createElement(rt.Rocket,null):pt.default.createElement(B,{appKey:i==null?void 0:i.appKey})),d.name)))}function lo(o){return pt.default.createElement(ri,{isDisabled:o.disabled})}var Vr=f(require("react")),jr=require("@rollouthq/api-client-react");function Qr(o){let{appKey:t,credentialId:r,setCredentialId:n,error:e,isDisabled:l}=o,a=(0,jr.useQuery)(["apps.authInfo",{appKey:t}]);return a.data==null?null:Vr.default.createElement(Ot,{appKey:t,authInfoQuery:a,credentialId:r,setCredentialId:n,error:e,isDisabled:l})}function ue(){var g,_,A;let{client:o}=(0,Ur.useTRPCContext)(),{data:t,setData:r,renderFields:n,validation:e,mode:l}=L(),{trigger:a}=t,i=Lt({...a,isTask:l==="task"}),s=(0,z.useCallback)(h=>{r(D=>({...D,trigger:{...D.trigger,inputParams:h}}))},[r]),u=(0,z.useCallback)(h=>r(D=>({...D,trigger:{...D.trigger,credentialId:h}})),[r]),m=(0,z.useMemo)(()=>[],[]);(0,zr.default)(typeof(n==null?void 0:n.trigger)!="function"&&typeof(n==null?void 0:n.trigger)!="boolean");let c=O({defaultField:ao,renderer:(g=n==null?void 0:n.trigger)==null?void 0:g.appKey,ctx:{TriggerAppKeyField:ao}}),d=O({defaultField:lo,renderer:(_=n==null?void 0:n.trigger)==null?void 0:_.triggerKey,ctx:{TriggerKeyField:lo}}),p=i&&("inputParamsSchema"in i?Object.keys(i.inputParamsSchema.shape).length>0:i.inputParamDefs.length>0);return z.default.createElement("div",{className:"rollout-automation-form__trigger"},z.default.createElement("div",{className:"rollout-automation-form__label"},"Select trigger"),z.default.createElement("div",{className:"rollout-automation-form__helper-text"},"This is the event that will kick off your action"),c,z.default.createElement("div",{className:"rollout-automation-form__trigger-trigger"},d),(a==null?void 0:a.triggerKey)!=null&&z.default.createElement(Qr,{appKey:a.appKey,credentialId:a.credentialId,setCredentialId:u,error:e.success?void 0:e.error.issues.find(h=>h.path.join(".")==="trigger.credentialId")}),(a==null?void 0:a.credentialId)!=null&&p&&z.default.createElement("div",{className:"rollout-automation-form__trigger-inputs"},z.default.createElement("div",{className:"rollout-automation-form__trigger-inputs-wrapper"},z.default.createElement(Bt,{api:o,credentialId:a.credentialId,inputParams:a.inputParams,setInputParams:s,renderInputParams:(A=n==null?void 0:n.trigger)==null?void 0:A.inputParams,importedData:i,variables:m,getDynamicOptions:({inputKey:h})=>o.query("triggers.getTriggerInputOptions",{triggerKey:a.triggerKey,inputKey:h})}))))}var pe=f(require("react"));var qr=require("@rollouthq/ui");function ni(o){let{disabled:t=!1}=o,{data:r,setData:n,validation:e}=L(),{shouldShowErrors:l}=k(),a=_t(e,i=>i.name)!=null;return pe.default.createElement(qr.TextField,{"aria-label":"Automation Name Input",className:"rollout-automation-form__name",placeholder:"Give your automation a name",isDisabled:t,value:r.name??"",validationState:l&&a?"invalid":"valid",onChange:i=>n(s=>({...s,name:i}))})}function me(o){return pe.default.createElement(ni,{...o})}var de=require("react"),H=require("zod"),zt=H.z.object({name:H.z.string().min(1),trigger:H.z.object({appKey:H.z.string(),triggerKey:H.z.string(),credentialId:H.z.string(),inputParams:H.z.object({})}),action:H.z.object({appKey:H.z.string(),actionKey:H.z.string(),credentialId:H.z.string(),inputParams:H.z.object({})})});function Wr(o){let{data:t,actionInputParamsSchema:r,triggerInputParamsSchema:n}=o,e=(0,de.useMemo)(()=>zt.extend({trigger:zt.shape.trigger.extend({inputParams:n}),action:zt.shape.action.extend({inputParams:r})}),[n,r]);return(0,de.useMemo)(()=>e.safeParse(t),[t,e])}function Ut(o){var Yt,Ht,b,S,Xt;let{data:t,isSaving:r,onSave:n,onSubmit:e,onCancel:l,onUpdate:a,onDelete:i,mode:s,renderFields:u}=o,[m,c]=(0,Zr.useState)(!1),[d,p]=(0,Pt.useToggle)(),{client:g}=(0,Lo.useTRPCContext)(),A=(b=(0,Lo.useQuery)(["apps.triggers",{appKey:(Yt=t.trigger)==null?void 0:Yt.appKey,isTask:s==="task"}],{enabled:((Ht=t.trigger)==null?void 0:Ht.appKey)!=null}).data)==null?void 0:b.find(W=>{var Q;return W.key===((Q=t.trigger)==null?void 0:Q.triggerKey)}),h=(0,Pt.useAsyncMemo)(async()=>{var W,Q,Ct;return A==null?[]:A.payloadConfiguration.type==="static"?A.payloadConfiguration.staticSchema:await g.query("triggers.getPayloadSchema",{appKey:(W=t.trigger)==null?void 0:W.appKey,triggerKey:(Q=t.trigger)==null?void 0:Q.triggerKey,inputParams:(Ct=t.trigger)==null?void 0:Ct.inputParams})},[JSON.stringify(A==null?void 0:A.payloadConfiguration),JSON.stringify(t.trigger)]),D=(0,I.useMemo)(()=>(h.value??[]).map(W=>({id:W.key,label:W.label,type:"string"})),[h.value]),{allowedApps:T}=He(),F=er({allowedApps:T}),M=tr(t.action),E=Qt({actionRef:t.action}),$=Lt({...t.trigger,isTask:s==="task"}),tt=(0,I.useMemo)(()=>$==null?zt.shape.action.shape.inputParams:"inputParamsSchema"in $?$.inputParamsSchema:(0,ce.inputDefToZodObject)($.inputParamDefs),[$]),lt=(0,I.useMemo)(()=>E==null?zt.shape.action.shape.inputParams:"inputParamsSchema"in E?E.inputParamsSchema:(0,ce.inputDefToZodObject)(E.inputParamDefs),[E]),C=Wr({data:t,triggerInputParamsSchema:tt,actionInputParamsSchema:lt}),x=(0,I.useCallback)(W=>a(Q=>{var Ie,ve;let Ct=W(Q),Cn=((Ie=Q.trigger)==null?void 0:Ie.triggerKey)!==((ve=Ct.trigger)==null?void 0:ve.triggerKey),_n=Ct.action==null?void 0:{...Ct.action,inputParams:Cn?{}:Ct.action.inputParams};return{...Ct,action:_n}}),[a]),ot=(0,I.useMemo)(()=>({mode:s,data:t,apps:F,actions:M,validation:C,variables:D,setData:x,renderFields:u}),[s,t,F,M,C,D,x,u]),dt=(0,I.useMemo)(()=>({shouldShowErrors:m,setShouldShowErrors:c}),[m,c]),Xo=(0,I.useCallback)(W=>x(Q=>({...Q,trigger:{...Q.trigger,credentialId:W}})),[x]),Jo=(0,I.useCallback)(W=>x(Q=>({...Q,action:{...Q.action,credentialId:W}})),[x]);Gt({appKey:(S=t.trigger)==null?void 0:S.appKey,setCredentialId:Xo}),Gt({appKey:(Xt=t.action)==null?void 0:Xt.appKey,setCredentialId:Jo});let mo=F.data==null,Go=(0,Yr.useSpinDelay)(mo,{delay:500,minDuration:200});if(F.failureCount>0)return I.default.createElement("div",{className:"rollout-automations-list__error-msg"},"Woops! Something went wrong fetching automations.");if(mo||Go)return I.default.createElement("div",{className:"rollout__loading_spinner_container"},I.default.createElement(Pt.Spinner,{className:"rollout__loading_spinner"}));let te=O({defaultField:me,renderer:u==null?void 0:u.name,ctx:{NameField:me}}),co=typeof(u==null?void 0:u.trigger)=="object"?I.default.createElement(ue,null):O({defaultField:ue,renderer:u==null?void 0:u.trigger,ctx:{TriggerAppKeyField:ao,TriggerKeyField:lo}}),fo=typeof(u==null?void 0:u.action)=="object"?I.default.createElement(se,null):O({defaultField:se,renderer:u==null?void 0:u.action,ctx:{ActionAppKeyField:oo,ActionKeyField:no,ActionCredentialIdField:ro,ActionInputFields:le}}),go=I.default.createElement("button",{type:"button","aria-label":"Save button",className:"rollout-button--primary rollout-automation-form__submit","data-loading":(0,Pt.dataAttr)(r),onClick:()=>{c(!0),C.success?n(C.data):console.error(C.error)}},r?"Saving...":"Save"),bo=l!=null&&I.default.createElement("button",{type:"button","aria-label":"Cancel button",className:"rollout-button--secondary rollout-automation-form__cancel",onClick:()=>l()},"Cancel"),yo=s!=="create"&&I.default.createElement("div",{className:"rollout-automation-form__delete"},d&&I.default.createElement("div",{className:"rollout-automation-form-delete__confirm-dialog"},I.default.createElement("div",{className:"rollout-automation-form__delete-confirm-text"},"Are you sure you want to delete this automation?"),I.default.createElement("div",{className:"rollout-automation-form__delete-confirm-buttons"},I.default.createElement("button",{type:"button","aria-label":"Cancel deletion button",onClick:p,className:"rollout-button--secondary rollout-automation-form__delete-cancel"},"No, cancel"),I.default.createElement("button",{type:"button","aria-label":"Confirm deletion button",onClick:i,className:"rollout-button--danger rollout-automation-form__delete-confirm"},"Yes, delete"))),I.default.createElement("button",{type:"button","aria-label":"Delete button",className:"rollout-button--danger rollout-automations-form-delete__trigger",onClick:p},"Delete")),xo=e!=null&&I.default.createElement("button",{type:"button","aria-label":"Submit button",className:"rollout-button--primary rollout-automation-form__submit",onClick:()=>{c(!0),C.success?e(C.data):console.error(C.error)}},"Submit");return I.default.createElement(vo,{value:dt},I.default.createElement(cr,{value:ot},I.default.createElement("div",{className:"rollout-automation-form"},I.default.createElement("div",{className:"rollout-automation-form__header"},te),I.default.createElement("div",{className:"rollout-automation-form__content"},co,fo),I.default.createElement("div",{className:"rollout-automation-form__buttons"},s==="task"?xo:I.default.createElement(I.default.Fragment,null,go,bo,yo)))))}function Mo(o){let{onAutomationCreated:t,onBeforeAutomationCreate:r,onCancel:n,prefilled:e,renderFields:l}=o,a=(0,Hr.useMutation)("automations.create"),[i,s]=(0,so.useState)(()=>{var c,d;let m={};return e==null||(e.name&&(m.name=e.name),((c=e.trigger)==null?void 0:c.appKey)!=null&&(m.trigger={...e.trigger,appKey:e.trigger.appKey,inputParams:e.trigger.inputParams??{}}),((d=e.action)==null?void 0:d.appKey)!=null&&(m.action={...e.action,appKey:e.action.appKey,inputParams:e.action.inputParams??{}})),m}),u=async m=>{let c=await(r==null?void 0:r({automationData:m}));if(c===!1)return;let d=c===!0||c===void 0?m:c.automationData,p=await a.mutateAsync(d);t({automation:p})};return so.default.createElement("div",{className:"rollout-automation-creator"},so.default.createElement(Ut,{mode:"create",data:i,renderFields:l,onUpdate:s,isSaving:a.isLoading,onSave:u,onCancel:n}))}var qt=f(require("react")),Et=require("@rollouthq/api-client-react");function Vo(o){let{automationId:t,onAutomationDeleted:r,onAutomationUpdated:n,onCancel:e,renderFields:l}=o,{invalidateQueries:a}=(0,Et.useTRPCContext)(),i=(0,Et.useMutation)("automations.delete",{onSuccess:()=>a(["automations.list"])}),[s,u]=(0,qt.useState)({}),m=(0,Et.useQuery)(["automations.get",{automationId:t}],{onSuccess(g){g!=null&&u({name:g.name,action:g.action,trigger:g.trigger})}}),c=(0,Et.useMutation)("automations.update");if(m.isLoading)return null;if(m.data==null)return qt.default.createElement("div",{className:"rollout-automations-editor__not-found"},"Automation not found");let d=async g=>{let _=await c.mutateAsync({id:t,automationData:{name:g.name,action:g.action,trigger:g.trigger}});n==null||n(_)},p=()=>{i.mutate({id:m.data.id},{onSuccess:()=>{r==null||r()}})};return qt.default.createElement("div",{className:"rollout-automation-editor"},qt.default.createElement(Ut,{mode:"edit",data:s,renderFields:l,onUpdate:u,isSaving:c.isLoading,onSave:d,onDelete:p,onCancel:e}))}var mt=f(require("react"));var nt=f(require("react")),Wt=require("@rollouthq/api-client-react");var fe=require("match-sorter"),v=f(require("react"));var U=require("@rollouthq/ui"),jo=require("@rollouthq/ui");function Xr(o){let{automations:t,isLoading:r=!1,isDeleting:n=!1,onEditAutomation:e,onDeleteAutomation:l}=o,[a,i]=(0,v.useState)(""),s=(0,fe.matchSorter)(t,a,{keys:["name","action.app.name"],threshold:fe.matchSorter.rankings.ACRONYM}),u=s.length===0;return v.default.createElement("div",{className:"rollout-automations-list__container"},v.default.createElement("div",{className:"rollout-automations-list__search-input__group"},v.default.createElement("div",{className:"rollout-automations-list__search-input__left-element"},v.default.createElement(U.Search,null)),v.default.createElement(U.TextField,{"aria-label":"Search automations text field",placeholder:"Search automations",value:a,onChange:i,className:"rollout-automations-list__search-input"})),r&&v.default.createElement("div",{className:"rollout__loading_spinner_container"},v.default.createElement(U.Spinner,{className:"rollout__loading_spinner"})),!r&&u&&v.default.createElement("div",{className:"rollout-automations-list__empty-msg"},"No automations found"),v.default.createElement("div",{className:"rollout-automations-list__list"},s.map(m=>v.default.createElement(ii,{key:m.id,automation:m,onEdit:()=>e(m),onDelete:()=>l(m),isDeleting:n}))))}function ii(o){let{automation:t,onEdit:r,onDelete:n,isDeleting:e}=o,[l,a]=(0,jo.useToggle)(),[i,s]=(0,v.useState)(!1);(0,v.useEffect)(()=>{!e&&i&&s(!1)},[e]);let u=l&&v.default.createElement("div",{className:"rollout-automations-list-item__options__content",onMouseLeave:()=>{l&&a()}},v.default.createElement("span",null,"Really delete?"),v.default.createElement("button",{type:"button","aria-label":"Confirm deletion button",onClick:()=>{n(),s(!0)},className:"rollout-automations-list-item__options__delete-item-btn"},"Delete"),v.default.createElement("button",{type:"button","aria-label":"Cancel deletion button",onClick:a,className:"rollout-automations-list-item__options__cancel-item-btn"},"Cancel"));return v.default.createElement("div",{className:"rollout-automations-list__item-wrapper","data-deleting":(0,U.dataAttr)(i)},u,v.default.createElement("div",{className:"rollout-automations-list__item",role:"group","data-open":(0,U.dataAttr)(l),onClick:m=>{(0,U.isChildofInteractiveElement)(m.target)||r()}},v.default.createElement("div",{className:"rollout-automations-list-item__header"},v.default.createElement("div",{className:"rollout-automations-list-item__icons"},v.default.createElement(U.Center,{className:"rollout-automations-list-item__trigger"},v.default.createElement(B,{appKey:t.trigger.appKey})),v.default.createElement(U.Center,{className:"rollout-automations-list-item__action"},v.default.createElement(B,{appKey:t.action.appKey}))),v.default.createElement("div",{role:"button",className:"rollout-automations-list-item__options__trigger",onClick:a},v.default.createElement(jo.Trash,null))),v.default.createElement("div",{className:"rollout-automations-list-item__name"},t.name)))}var Jr=require("@rollouthq/ui");function Qo(o){let{onEditAutomation:t,onCreateAutomation:r,filter:n}=o,{invalidateQueries:e}=(0,Wt.useTRPCContext)(),[l,a]=(0,nt.useState)(()=>[]),i=(0,Wt.useQuery)(["automations.list"]);(0,nt.useEffect)(()=>{i.data!=null&&(n!=null?a(i.data.filter(u=>{try{return n(u)}catch(m){return console.error(m),!1}})):a(i.data))},[i.data,n]);let s=(0,Wt.useMutation)("automations.delete",{onSuccess:()=>e(["automations.list"])});return nt.default.createElement("div",null,nt.default.createElement("div",{className:"rollout-automations-list__header"},nt.default.createElement("span",{className:"rollout-automations-list__header-title"},"My automations"),nt.default.createElement("button",{type:"button","aria-label":"New automation button",className:"rollout-automations-list__new-btn",onClick:()=>r()},nt.default.createElement(Jr.Plus,null),"New")),nt.default.createElement(Xr,{automations:l??[],isLoading:i.isFetching,isDeleting:s.isLoading,onDeleteAutomation:u=>s.mutate({id:u.id}),onEditAutomation:t}))}var Gr=require("@rollouthq/ui");function tn(o){let{onAutomationCreated:t,onBeforeAutomationCreate:r,prefilled:n,filter:e,renderFields:l}=o,[a,i]=(0,mt.useState)({mode:"LIST"});return mt.default.createElement("div",{className:"rollout-automations-manager"},a.mode==="LIST"&&mt.default.createElement(Qo,{onEditAutomation:s=>i({mode:"EDIT",automationId:s.id}),onCreateAutomation:()=>i({mode:"CREATE"}),filter:e}),(a.mode==="CREATE"||a.mode==="EDIT")&&mt.default.createElement("div",{className:"rollout-automations-manager__navbar"},mt.default.createElement("button",{type:"button","aria-label":"Return to automations list button",className:"rollout-automations-manager__back-btn",onClick:()=>i({mode:"LIST"})},mt.default.createElement(Gr.ArrowBack,{className:"rollout-automation-form__header-back__arrow"}))),a.mode==="CREATE"&&mt.default.createElement(Mo,{onBeforeAutomationCreate:r,onAutomationCreated:s=>{t==null||t(s),i({mode:"LIST"})},prefilled:n,renderFields:l}),a.mode==="EDIT"&&mt.default.createElement(Vo,{automationId:a.automationId,onAutomationUpdated:()=>i({mode:"LIST"}),onAutomationDeleted:()=>i({mode:"LIST"}),renderFields:l}))}var y=f(require("react")),en=require("spin-delay"),J=require("@rollouthq/api-client-react"),be=require("@rollouthq/common/");var yt=require("@rollouthq/ui");var ge=require("react"),X=require("zod"),Zt=X.z.object({name:X.z.string().min(1),trigger:X.z.object({appKey:X.z.string(),triggerKey:X.z.string(),credentialId:X.z.string(),inputParams:X.z.object({})}),action:X.z.object({appKey:X.z.string(),actionKey:X.z.string(),credentialId:X.z.string(),inputParams:X.z.object({})})});function on(o){let{data:t={},actionInputParamsSchema:r,triggerInputParamsSchema:n}=o,e=(0,ge.useMemo)(()=>Zt.extend({trigger:Zt.shape.trigger.extend({inputParams:n}),action:Zt.shape.action.extend({inputParams:r})}),[r,n]);return(0,ge.useMemo)(()=>e.safeParse(t),[t,e])}function zo(o){var co,fo,go,bo,yo,xo,Yt,Ht;let{blueprintId:t}=o,{client:r,invalidateQueries:n}=(0,J.useTRPCContext)(),[e,l]=(0,y.useState)(),a=(0,J.useLazyQuery)("triggers.getPayloadSchema"),i=(0,J.useLazyQuery)("apps.authInfo"),s=(0,J.useLazyQuery)("apps.triggers"),u=Lt(e==null?void 0:e.trigger);(0,y.useEffect)(()=>{let b=e==null?void 0:e.trigger;b!=null&&(i.fetch({appKey:b.appKey}),s.fetch({appKey:b.appKey}),b.triggerKey!=null&&b.appKey!=null&&a.fetch({appKey:b.appKey,triggerKey:b.triggerKey}))},[e==null?void 0:e.trigger]);let m=(0,J.useLazyQuery)("apps.authInfo");(0,y.useEffect)(()=>{var b;((b=e==null?void 0:e.action)==null?void 0:b.appKey)!=null&&m.fetch({appKey:e.action.appKey})},[(co=e==null?void 0:e.action)==null?void 0:co.appKey]);let c=(0,J.useQuery)(["blueprints.get",{blueprintId:t}],{onSuccess:b=>{e==null&&(b.automation!=null?l({name:b.automation.name,action:b.automation.action,trigger:b.automation.trigger}):l({name:b.name,action:b.action,trigger:b.trigger}))}}),d=(0,J.useMutation)("blueprints.createAutomation"),p=(0,J.useMutation)("blueprints.deactivateAutomation"),g=(0,y.useMemo)(()=>u==null?Zt.shape.action.shape.inputParams:"inputParamsSchema"in u?u.inputParamsSchema:(0,be.inputDefToZodObject)(u.inputParamDefs),[u]),_=Qt({actionRef:e==null?void 0:e.action}),A=(0,y.useMemo)(()=>_==null?Zt.shape.action.shape.inputParams:"inputParamsSchema"in _?_.inputParamsSchema:(0,be.inputDefToZodObject)(_.inputParamDefs),[_]),h=on({data:e,triggerInputParamsSchema:g,actionInputParamsSchema:A}),D=(0,y.useCallback)(b=>l(S=>({...S,trigger:{...S==null?void 0:S.trigger,credentialId:b}})),[l]),T=(0,y.useCallback)(b=>l(S=>({...S,action:{...S==null?void 0:S.action,credentialId:b}})),[l]);Gt({appKey:(fo=e==null?void 0:e.trigger)==null?void 0:fo.appKey,setCredentialId:D});let F=(0,y.useCallback)(b=>{l(S=>({...S,trigger:{...S.trigger,inputParams:b}}))},[l]),E=(yo=(0,J.useQuery)(["apps.triggers",{appKey:(go=e==null?void 0:e.trigger)==null?void 0:go.appKey}],{enabled:((bo=e==null?void 0:e.trigger)==null?void 0:bo.appKey)!=null}).data)==null?void 0:yo.find(b=>{var S;return b.key===((S=e==null?void 0:e.trigger)==null?void 0:S.triggerKey)}),$=(0,yt.useAsyncMemo)(async()=>{var b,S,Xt;return E==null?[]:E.payloadConfiguration.type==="static"?E.payloadConfiguration.staticSchema:await r.query("triggers.getPayloadSchema",{appKey:(b=e==null?void 0:e.trigger)==null?void 0:b.appKey,triggerKey:(S=e==null?void 0:e.trigger)==null?void 0:S.triggerKey,inputParams:(Xt=e==null?void 0:e.trigger)==null?void 0:Xt.inputParams})},[JSON.stringify(E==null?void 0:E.payloadConfiguration),JSON.stringify(e==null?void 0:e.trigger)]),tt=(0,y.useMemo)(()=>($.value??[]).map(b=>({id:b.key,label:b.label,type:"string"})),[$.value]);function lt(){return(e==null?void 0:e.action)==null||_==null?null:y.default.createElement("div",{className:"rollout-automation-form__action-inputs"},y.default.createElement("div",null,y.default.createElement("div",{className:"rollout-automation-form__label"},"Set up action"),y.default.createElement("div",{className:"rollout-automation-form__credential"},y.default.createElement(yt.FormControl,{label:"Account",isRequired:!0},y.default.createElement(Ot,{error:h.success?void 0:h.error.issues.find(b=>b.path.join(".")==="action.credentialId"),credentialId:e.action.credentialId,setCredentialId:b=>{let S={...e.action,credentialId:b};l({...e,action:S})},authInfoQuery:m,appKey:e.action.appKey}))),y.default.createElement("div",{className:"rollout-automation-form__action-inputs-wrapper"},y.default.createElement(Bt,{isBlueprintActivation:!0,api:r,credentialId:e.action.credentialId,inputParams:e.action.inputParams,setInputParams:b=>l({...e,action:{...e.action,inputParams:b}}),renderInputParams:void 0,importedData:_,variables:tt,getDynamicOptions:()=>{throw new Error("Dynamic options not implemented in actions")}}))))}let C=((Yt=(xo=c.data)==null?void 0:xo.automation)==null?void 0:Yt.active)??!1,[x,ot]=(0,y.useState)(!1),dt=(0,y.useMemo)(()=>({shouldShowErrors:x,setShouldShowErrors:ot}),[x,ot]),Xo=(0,y.useMemo)(()=>[],[]);async function Jo(){if(ot(!0),h.success){let b=h.data;await d.mutateAsync({blueprintId:t,trigger:{credentialId:b.trigger.credentialId,inputParams:b.trigger.inputParams},action:{credentialId:b.action.credentialId,inputParams:b.action.inputParams}}),n(["blueprints.getAutomation",{blueprintId:t}]),n(["blueprints.get",{blueprintId:t}]),n("blueprints.list")}else console.log(e),console.error(h.error)}async function mo(){await p.mutateAsync({blueprintId:t}),n(["blueprints.getAutomation",{blueprintId:t}]),n(["blueprints.get",{blueprintId:t}]),n("blueprints.list")}let Go=(0,en.useSpinDelay)(e==null,{delay:500,minDuration:200});if(e==null)return null;if(Go)return y.default.createElement("div",{className:"rollout__loading_spinner_container"},y.default.createElement(yt.Spinner,{className:"rollout__loading_spinner"}));let Ae=u&&("inputParamsSchema"in u?Object.keys(u.inputParamsSchema.shape).length>0:u.inputParamDefs.length>0),te=((Ht=e.trigger)==null?void 0:Ht.triggerKey)!=null&&y.default.createElement("div",{className:"rollout-blueprint-activator__trigger"},y.default.createElement("div",{className:"rollout-blueprint-activator__label"},"Set up trigger"),y.default.createElement("div",{className:"rollout-blueprint-activator__trigger__fields"},y.default.createElement(Ot,{error:h.success?void 0:h.error.issues.find(b=>b.path.join(".")==="trigger.credentialId"),appKey:e.trigger.appKey,setCredentialId:b=>l({...e,trigger:{...e.trigger,credentialId:b}}),authInfoQuery:i,credentialId:e.trigger.credentialId}),e.trigger.credentialId!=null&&Ae&&y.default.createElement("div",{className:"rollout-automation-form__trigger-inputs-wrapper"},y.default.createElement(Bt,{api:r,credentialId:e.trigger.credentialId,inputParams:e.trigger.inputParams,setInputParams:F,renderInputParams:void 0,importedData:u,variables:Xo,getDynamicOptions:({inputKey:b})=>{var S;return r.query("triggers.getTriggerInputOptions",{triggerKey:(S=e.trigger)==null?void 0:S.triggerKey,inputKey:b})}}))));return y.default.createElement(vo,{value:dt},y.default.createElement("div",null,c.data!=null&&y.default.createElement("div",null,y.default.createElement("div",{className:"rollout-blueprint-activator__header"},y.default.createElement("div",{className:"rollout-automations-list-item__icons"},y.default.createElement(yt.Center,{className:"rollout-automations-list-item__trigger"},y.default.createElement(B,{appKey:c.data.trigger.appKey})),y.default.createElement(yt.Center,{className:"rollout-automations-list-item__action"},y.default.createElement(B,{appKey:c.data.action.appKey}))),y.default.createElement("div",{className:"rollout-blueprint-activator__name"},c.data.name)),te,lt(),y.default.createElement("div",null,C?y.default.createElement("button",{type:"button","aria-label":"Deactivation button",disabled:d.isLoading,className:"rollout-blueprint-activator__deactivate-btn rollout-button--primary",onClick:mo},d.isLoading?"Deactivating...":"Deactivate"):y.default.createElement("button",{type:"button","aria-label":"Activation button",disabled:d.isLoading,className:"rollout-blueprint-activator__activate-btn rollout-button--primary",onClick:Jo},d.isLoading?"Activating...":"Activate")))))}var ye=require("match-sorter"),K=f(require("react")),Uo=require("@rollouthq/api-client-react");var G=require("@rollouthq/ui");function qo(o){let{blueprints:t,isLoading:r=!1,onOpenActivationForm:n}=o,[e,l]=(0,K.useState)(""),a=(0,ye.matchSorter)(t,e,{keys:["name","action.app.name"],threshold:ye.matchSorter.rankings.ACRONYM}),i=a.length===0;return K.default.createElement("div",{className:"rollout-automations-list__container"},K.default.createElement("div",{className:"rollout-automations-list__search-input__group"},K.default.createElement("div",{className:"rollout-automations-list__search-input__left-element"},K.default.createElement(G.Search,null)),K.default.createElement(G.TextField,{placeholder:"Search blueprints",value:e,onChange:l,className:"rollout-automations-list__search-input"})),r&&K.default.createElement("div",{className:"rollout__loading_spinner_container"},K.default.createElement(G.Spinner,{className:"rollout__loading_spinner"})),!r&&i&&K.default.createElement("div",{className:"rollout-automations-list__empty-msg"},"No blueprints found"),K.default.createElement("div",{className:"rollout-automations-list__list"},a.map(s=>K.default.createElement(ai,{key:s.id,blueprint:s,onOpenActivationForm:()=>n(s)}))))}function ai(o){var a;let{blueprint:t,onOpenActivationForm:r}=o,{invalidateQueries:n}=(0,Uo.useTRPCContext)(),e=(0,Uo.useMutation)("blueprints.deactivateAutomation"),l=((a=t.automation)==null?void 0:a.active)??!1;return K.default.createElement("div",{className:"rollout-automations-list__item-wrapper"},K.default.createElement("div",{className:"rollout-automations-list__item",role:"group",onClick:i=>{(0,G.isChildofInteractiveElement)(i.target)||r()}},K.default.createElement("div",{className:"rollout-automations-list-item__header"},K.default.createElement("div",{className:"rollout-automations-list-item__icons"},K.default.createElement(G.Center,{className:"rollout-automations-list-item__trigger"},K.default.createElement(B,{appKey:t.trigger.appKey})),K.default.createElement(G.Center,{className:"rollout-automations-list-item__action"},K.default.createElement(B,{appKey:t.action.appKey}))),K.default.createElement("div",{className:"rollout-automations-list-item__switch"},K.default.createElement(G.Switch,{isSelected:l,onChange:async()=>{if(l){let i=t.id;await e.mutateAsync({blueprintId:i}),n(["blueprints.get",{blueprintId:i}]),n(["blueprints.getAutomation",{blueprintId:i}]),n(["blueprints.list"])}else r()}}))),K.default.createElement("div",{className:"rollout-automations-list-item__name"},t.name)))}var it=f(require("react"));var uo=f(require("react")),rn=require("@rollouthq/api-client-react");function Wo(o){let{onOpenActivationForm:t}=o,r=(0,rn.useQuery)(["blueprints.list"]);return uo.default.createElement("div",null,uo.default.createElement("div",{className:"rollout-automations-list__header"},uo.default.createElement("span",{className:"rollout-automations-list__header-title"},"My blueprints")),uo.default.createElement(qo,{blueprints:r.data??[],isLoading:r.isFetching,onOpenActivationForm:t}))}var nn=require("@rollouthq/ui");function an(){let[o,t]=(0,it.useState)({mode:"LIST"});return it.default.createElement("div",{className:"rollout-automations-manager"},o.mode==="LIST"&&it.default.createElement(Wo,{onOpenActivationForm:r=>{t({mode:"ACTIVATE",blueprintId:r.id})}}),o.mode==="ACTIVATE"&&it.default.createElement(it.default.Fragment,null,it.default.createElement("div",{className:"rollout-automations-manager__navbar"},it.default.createElement("button",{type:"button","aria-label":"Return to blueprints list button",className:"rollout-blueprints-manager__back-btn",onClick:()=>t({mode:"LIST"})},it.default.createElement(nn.ArrowBack,{className:"rollout-automation-form__header-back__arrow"}))),it.default.createElement(zo,{blueprintId:o.blueprintId})))}var po=f(require("react")),ln=require("@rollouthq/api-client-react");function sn(o){let{renderFields:t,prefilled:r,name:n}=o,e=(0,ln.useMutation)("tasks.execute"),[l,a]=(0,po.useState)(()=>{var s,u;let i={};return r==null||(n&&(i.name=n),((s=r.trigger)==null?void 0:s.appKey)!=null&&(i.trigger={...r.trigger,appKey:r.trigger.appKey,inputParams:r.trigger.inputParams??{}}),((u=r.action)==null?void 0:u.appKey)!=null&&(i.action={...r.action,appKey:r.action.appKey,inputParams:r.action.inputParams??{}})),i});return po.default.createElement("div",{className:"rollout-automation-creator"},po.default.createElement(Ut,{data:l,renderFields:t,onUpdate:a,onSubmit:async i=>{await e.mutateAsync(i)},mode:"task",onSave:()=>{},isSaving:e.isLoading}))}var Ft=f(require("react")),xt=require("@rollouthq/ui");function un(){return Ft.default.createElement(xt.st.div,{css:{textAlign:"center"}},Ft.default.createElement(xt.st.div,{css:{display:"flex",justifyContent:"center",alignItems:"center"}},Ft.default.createElement(xt.RolloutIcon,{width:"16px"}),Ft.default.createElement(xt.st.span,{css:{paddingLeft:"$2",fontWeight:700,color:"$neutral-2"}},"Powered by Rollout")),Ft.default.createElement(xt.st.div,{css:{marginTop:"$2",fontSize:"8px",color:"$grayMedium"}},"By automating, you agree to Rollout's"," ",Ft.default.createElement(xt.st.a,{href:"https://docs.rollouthq.com/security-and-legal/security",css:{color:"black",textDecoration:"underline"}},"Terms")," ","&"," ",Ft.default.createElement(xt.st.a,{href:"https://docs.rollouthq.com/security-and-legal/privacy-policy",css:{color:"black",textDecoration:"underline"}},"Privacy policy")))}var q=f(require("react"));function xe(o,t,r,n){Object.defineProperty(o,t,{get:r,set:n,enumerable:!0,configurable:!0})}var Ce={};xe(Ce,"SSRProvider",()=>_e);xe(Ce,"useSSRSafeId",()=>si);xe(Ce,"useIsSSR",()=>ui);var Yo={prefix:String(Math.round(Math.random()*1e10)),current:0},Zo=q.default.createContext(Yo);function _e(o){let t=(0,q.useContext)(Zo),r=(0,q.useMemo)(()=>({prefix:t===Yo?"":`${t.prefix}-${++t.current}`,current:0}),[t]);return q.default.createElement(Zo.Provider,{value:r},o.children)}var li=Boolean(typeof window<"u"&&window.document&&window.document.createElement);function si(o){let t=(0,q.useContext)(Zo);return t===Yo&&!li&&console.warn("When server rendering, you must wrap your application in an <SSRProvider> to ensure consistent ids are generated between the client and server."),(0,q.useMemo)(()=>o||`react-aria${t.prefix}-${++t.current}`,[o])}function ui(){let t=(0,q.useContext)(Zo)!==Yo,[r,n]=(0,q.useState)(t);return typeof window<"u"&&t&&(0,q.useLayoutEffect)(()=>{n(!1)},[]),r}var Dt=require("@sentry/browser"),at=f(require("react")),fn=require("react-error-boundary"),gn=require("@rollouthq/api-client-react");var St=f(require("react")),pn=require("@rollouthq/ui"),mn=require("@rollouthq/ui");function dn(){return St.default.createElement("div",{className:"rollout-error-fallback__container"},St.default.createElement("div",null,St.default.createElement(pn.Gear,{style:{width:"40px",height:"40px"}}),St.default.createElement(mn.RedQuestion,{style:{position:"relative",right:"10px",bottom:"30px"}})),St.default.createElement("div",{className:"rollout-error-fallback__text-container"},St.default.createElement("div",{className:"rollout-error-fallback__message"},"An unexpected error occured"),St.default.createElement("div",{className:"rollout-error-fallback__additional-info"},"Please try again later")))}var cn="https://app.rollouthq.com/api",pi="https://28e3dd4b02f14f2eb74768520edbc8a1@o345148.ingest.sentry.io/6463365";function bn(o){let{token:t,allowedApps:r,apiBaseUrl:n=cn,children:e,env:l="production",onError:a}=o,[i]=(0,at.useState)(()=>new Dt.BrowserClient({dsn:pi,transport:Dt.makeFetchTransport,stackParser:Dt.defaultStackParser,integrations:Dt.defaultIntegrations})),s=(0,at.useCallback)((u,m)=>{a==null||a(u,m),l==="production"&&i.captureException(u,{data:{info:m}})},[l,i,a]);return at.default.createElement(fn.ErrorBoundary,{FallbackComponent:dn,onError:s},at.default.createElement(Ue,{apiBaseUrl:n},at.default.createElement(Xe,{allowedApps:r},at.default.createElement(gn.RolloutAPIClientProvider,{token:t,apiBaseUrl:n??cn},at.default.createElement(mr,null,at.default.createElement(_e,null,e))))))}var xn=require("@rollouthq/common");var yn=require("@rollouthq/ui"),Ho={border:"1px solid #D5DCE2",borderRadius:"8px",padding:"16px",marginTop:"24px",background:"white"},mi=(0,yn.globalCss)({".rollout-automation-form__line-items-container":{border:"1px solid #DFE1E4",borderRadius:"8px"},".rollout-automation-form__line-items-header":{padding:"12px",display:"flex",gap:"12px",alignItems:"flex-start",flexDirection:"column",background:"linear-gradient(180deg, rgba(255, 255, 255, 0.03) 0%, rgba(0, 0, 0, 0.03) 100%), #FFFFFF"},".rollout-automation-form__line_items-description":{fontSize:"13px"},".rollout-automation-form__line-items-title":{fontSize:"13px",fontWeight:"600"},".rollout-automation-form__line-items-content":{padding:"16px",display:"flex",flexDirection:"column",gap:"16px"},".rollout-automations-list__container":{display:"flex",flexDirection:"column"},".rollout-automations-list__header":{display:"flex",paddingY:"16px",marginBottom:"16px",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid #EFF1F4"},".rollout-automations-list__header-title":{fontWeight:"600"},".rollout-error-fallback__container":{boxSizing:"border-box",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"32px",gap:"16px",margin:"24px auto",width:"572px",height:"173px",border:"1px solid #D5DCE2",borderRadius:"8px"},".rollout-error-fallback__text-container":{display:"flex",flexDirection:"column",alignItems:"center",gap:"4px",width:"227px",height:"48px"},".rollout-error-fallback__message":{color:"#6C6F75",fontFamily:"Inter",fontStyle:"normal",fontWeight:"600",fontSize:"16px",lineHeight:"150%"},".rollout-error-fallback__additional-info":{color:"#6C6F75",fontFamily:"Inter",fontStyle:"normal",fontweight:"500",fontSize:"13px",lineHeight:"150%"},".rollout-combobox__input__spinner":{width:"1rem",height:"1rem"},".rollout-combobox__input":{width:"100%",paddingX:"$2",paddingY:"$2-5",background:"none",outline:"none",border:"none",cursor:"text",paddingRight:"40px",fontSize:"13px","&:focus":{borderColor:"$interactPrimary"},"[data-disabled]":{opacity:.4,cursor:"not-allowed"},".rollout-combobox__input__left-element[data-icon] ~ &":{paddingLeft:"40px"},"&:disabled":{cursor:"not-allowed"}},".rollout-select__tag":{margin:"2px",paddingX:"6px",paddingY:"1px",height:"fit-content",display:"flex",alignItems:"center",gap:"4px",background:"white",border:"1px solid #EFF1F4",borderRadius:"4px",fontWeight:"500",cursor:"pointer",whiteSpace:"nowrap"},".rollout-select__tag-icon":{color:"#91959C","&:hover":{color:"black"}},".rollout-select__input":{background:"none",outline:"none",border:"none",width:"100%","&:disabled":{cursor:"not-allowed"}},".rollout-select__input__group":{background:"#F8F9FB",height:"36px",paddingX:"8px",".rollout-select__input":{paddingLeft:"0"}},".rollout-form-control__input[data-error]":{".rollout-combobox__input__group, .rollout-select__input__group, .rollout__base-input":{borderColor:"$error"}},".rollout-combobox__input__group, .rollout-select__input__group":{position:"relative",overflow:"hidden",display:"flex",alignItems:"center",fontSize:"13px",outline:"none",overflowX:"hidden",borderWidth:"1px",borderRadius:"$md",borderStyle:"solid",borderColor:"$strokeMedium","&[data-focused]":{borderColor:"$interactPrimary"},"&[data-disabled]":{cursor:"not-allowed",color:"$grayMedium",backgroundColor:"$surfaceSecondary"}},".rollout-connect-combobox__label, .rollout-connect-select__label":{marginBottom:"$2",span:{color:"$primary"}},".rollout-connect-filebrowser":{padding:"0",listStyle:"none",overflow:"auto",borderRadius:"4px"},".rollout-connect-filebrowser-back-button":{maxWidth:"100px"},".rollout-connect-filebrowser-selected-folder-display":{fontSize:"14px"},".rollout-connect-filebrowser li":{outline:"none",borderBottom:"solid 2px",borderColor:"#F8F9FB","&:hover":{background:"#F8F9FB"}},".rollout-connect-filebrowser__list-item-display":{display:"flex",flexDirection:"column",paddingLeft:"5px",fontSize:"14px"},".rollout-connect-filebrowser li[aria-selected=true]":{background:"#F4F5F8"},".rollout-connect-filebrowser [role=gridcell]":{display:"flex",alignItems:"center",gap:"4px"},".rollout-connect-filebrowser li button":{marginLeft:"auto"},".rollout-combobox__input__left-element, .rollout-combobox__input__right-element":{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute","&:not([data-open])":{pointerEvents:"none"},"&[data-open]":{cursor:"pointer"},top:"50%",transform:"translateY(-50%)",zIndex:2,color:"#91959C",border:"none",background:"none"},".rollout-combobox__input__left-element":{size:"24px",left:"8px","&:not([data-icon])":{display:"none"},"[data-avatar][data-selected] &":{background:"transparent",border:"none",color:"white",fontSize:"$1"},borderWidth:"1px",borderColor:"#EFF1F4",borderStyle:"solid",borderRadius:"6px",background:"white"},".rollout-combobox__input__right-element, .rollout-select__input__right-element":{size:"16px",right:"8px"},".rollout-combobox__input__spinner, .rollout-select__input__spinner":{flexShrink:"0",size:"12px"},".rollout-combobox__content, .rollout-select__content":{maxHeight:"288px",overflowX:"hidden",overflowY:"auto",outline:"none",border:"solid 1px",borderColor:"#D5DCE2",borderRadius:"8px",".rollout-tab__list":{background:"#282A2F",padding:"10px 12px",fontSize:"13px",color:"white",fontWeight:"600",gap:"16px",border:"none"},".rollout-tabs__tab":{overflowX:"hidden !important",padding:"0",border:"none",color:"white",opacity:"0.4","&[data-selected]":{opacity:"1"}}},".rollout-select__multiple-alert":{display:"flex",alignItems:"center",gap:"8px",paddingX:"12px",paddingY:"8px",background:"#5386F6",color:"white",span:{fontSize:"13px",fontWeight:"500"}},".rollout-combobox__content ul":{margin:"0px",padding:"0px"},".rollout-select__content ul":{margin:"0px",padding:"0px"},".rollout-select__option-check__icon":{marginLeft:"auto"},".rollout-listbox":{width:"100%",margin:0,padding:0},".rollout-listbox__option, .rollout-select__option":{display:"flex",alignItems:"center",padding:"$2",fontSize:"$2",outline:"none",cursor:"pointer",borderBottom:"solid 1px",borderColor:"#F8F9FB","&[data-focused]":{background:"#F4F5F8"},"&[data-disabled]":{fontWeight:"500",color:"#91959C"},"&[data-selected]":{fontWeight:"500",color:"#5284F2",diaplay:"flex",alignItems:"center"}},"rollout-listbox__option-with-button":{padding:"0"},".rollout-listbox__option-icon":{"[data-avatar] &":{background:"#C3C7CE;",color:"white",border:"none",borderRadius:"100%",padding:0,fontSize:"$1"},borderWidth:"1px",borderColor:"$strokeMedium",borderStyle:"solid",borderRadius:"$md",background:"white",size:"$6",padding:"$1",marginRight:"$1-5"},".rollout-automations-list__search-input":{paddingX:"40px",paddingY:"10px",borderRadius:"$md",outline:"none",borderWidth:"2px",borderColor:"#EFF1F4","&:focus":{borderColor:"$interactPrimary"},borderStyle:"solid",background:"#F8F9FB"},".rollout-automations-list__search-input__group":{position:"relative",display:"flex",marginBottom:"$4",color:"#91959C"},".rollout-automations-list__search-input__left-element":{position:"absolute",left:"0px",top:"0px",zIndex:2,display:"flex",size:"40px",fontSize:"$md",alignItems:"center",justifyContent:"center",pointerEvents:"none",svg:{size:"20px"}},".rollout-automations-list__not-found":{paddingInlineStart:"$4"},".rollout-form-control-find__container":{display:"flex",background:"#e0e1e4",width:"max-content",borderRadius:"6px"},".rollout-form-control-find__active":{color:"#5d88ef",fontSize:"0.8125rem",fontFamily:"inherit",fontWeight:"500",padding:"4px 36px",whiteSpace:"nowrap",background:"white",height:"32px",cursor:"pointer",borderRadius:"8px",border:"1px solid #e0e1e4"},".rollout-form-control-find__disabled":{color:"#6c6f75",fontFamily:"inherit",fontSize:"0.8125rem",fontWeight:"500",padding:"4px 36px",whiteSpace:"nowrap",background:"e0e0e5",height:"32px",cursor:"pointer",borderRadius:"8px"},".rollout-automations-list__new-btn":{display:"flex",alignItems:"center",gap:"8px",padding:"4px 12px",whiteSpace:"nowrap",backgroundColor:"#5386F7",color:"white",border:"none",borderRadius:"8px",height:"32px",cursor:"pointer"},".rollout-automations-list__empty-msg":{textAlign:"center",padding:"20px",border:"1px solid #eff1f4",borderRadius:"4px"},".rollout-automations-list__error-msg":{textAlign:"center",padding:"20px",border:"1px dashed #AA4849",borderRadius:"4px"},".rollout-automations-list__list":{display:"grid",gap:"16px",gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))"},".rollout-automations-list__item-wrapper":{position:"relative",marginBottom:"8px",maxWidth:"343px",border:"1px solid #D5DCE2",borderRadius:"8px","&:hover":{border:"1px solid #ADB4BA"},"&[data-deleting]":{opacity:.4},"&[data-deleting]::after":{content:"''",position:"absolute",inset:0,userSelect:"none",cursor:"wait"}},".rollout-automations-list__item":{padding:"16px",cursor:"pointer"},".rollout-automations-list-item__header":{display:"flex",alignItems:"center",justifyContent:"space-between"},".rollout-automations-list-item__draft-badge":{marginLeft:"auto",marginRight:"10px",padding:"4px 8px",borderRadius:"40px",background:"$neutral-4",fontSize:"small",color:"white"},".rollout-automations-list-item__icons":{display:"inline-flex",".rollout-automations-list-item__trigger, .rollout-automations-list-item__action":{padding:"$1",borderStyle:"solid",borderWidth:"1px",borderColor:"$strokeMedium",borderRadius:"$md",fontSize:"24px"},":first-child":{borderStartEndRadius:"unset",borderEndEndRadius:"unset",marginRight:"-1px"},":last-child":{borderStartStartRadius:"unset",borderEndStartRadius:"unset"},size:"fit-content"},".rollout-automations-list-item__name":{marginTop:"12px",fontSize:"16px",fontWeight:"600",color:"#31373F",height:"72px"},".rollout-automations-list-item__options__trigger":{display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"4px",cursor:"pointer",color:"#91959C",transition:"all .2s ease",size:"32px",svg:{size:"16px"},"&:hover":{bg:"rgba(219, 97, 92, 0.1)",color:"#DB615C"},opacity:0,'[role="group"]:hover:not([data-open]) &':{opacity:1}},".rollout-automations-list-item__options__content":{position:"absolute",padding:"18px 16px",inset:"0",background:"white",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"12px",justifyContent:"center",alignItems:"center",span:{fontWeight:"600"}},".rollout-automations-list-item__options__delete-item-btn":{background:"#DB615C",color:"white",whiteSpace:"nowrap","&:hover":{background:"#C74D48"},cursor:"pointer"},".rollout-automations-list-item__options__cancel-item-btn":{border:"1px solid #282A2F",cursor:"pointer"},".rollout-automations-manager__navbar":{paddingY:"$3"},".rollout-automations-manager__back-btn":{border:"none",background:"none"},".rollout-automation-form__header-back__arrow":{cursor:"pointer"},".rollout-automations-list-item__options__content button":{fonSize:"13px",fontWeight:"500",borderRadius:"8px",height:"32px",width:"100%",cursor:"pointer",transition:"all .2s ease"},".rollout-automation-form__name":{height:"36px",fontWeight:500,fontSize:"13px",background:"none",border:"1px solid",borderColor:"$strokeDark",borderRadius:"8px",paddingX:"$4",paddingY:"$2-5",outline:"none","&[aria-invalid]::placeholder":{color:"$error"}},".rollout-automation-form__action-inputs-wrapper, .rollout-automation-form__trigger-inputs-wrapper":{display:"flex",flexDirection:"column",gap:"$3"},".rollout-automation-form__trigger":{...Ho},".rollout-automation-form__trigger-inputs":{...Ho},".rollout-automation-form__action":{...Ho},".rollout-automation-form__action-inputs":{...Ho},".rollout-automation-form__trigger-trigger":{marginBottom:"$3"},".rollout-automation-form__trigger .rollout-automation-form__trigger-app ":{marginBottom:"$3"},".rollout-automation-form__trigger .rollout-automation-form__credentials":{marginTop:"$3"},".rollout-automation-form__action .rollout-automation-form__action-app":{marginBottom:"$3"},".rollout-automation-form__action .rollout-automation-form__action-action":{marginBottom:"$3"},".rollout-automation-form__credential":{marginBottom:"$3"},".rollout-automation-form__label":{fontWeight:"600",marginBottom:"12px"},".rollout-automation-form__helper-text":{marginBottom:"12px"},".rollout-automation-form__content":{marginBottom:"16px"},".rollout-automation-form-oauth__error__message":{marginTop:"4px",fontSize:"$2",color:"$error"},".rollout-input":{height:"36px",paddingX:"$2",paddingY:"$2-5",border:"1px solid",borderColor:"$strokeMedium",borderRadius:"6px"},".rollout-button--primary, .rollout-button--secondary, .rollout-button--danger":{display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",height:"32px",padding:"4px 12px",fontWeight:600,whiteSpace:"nowrap",textAlign:"center",border:"1px solid",borderRadius:"8px"},".rollout-button--primary":{backgroundColor:"#5386F7",borderColor:"#5386F7",color:"white"},".rollout-button--secondary":{backgroundColor:"$grayMedium",borderColor:"$grayMedium",color:"white"},".rollout-button--danger":{color:"white",backgroundColor:"$error",borderColor:"$error","&:hover":{backgroundColor:"#A92F2A",borderColor:"#A92F2A"}},".rollout-automation-form__buttons":{display:"flex",gap:"$3"},".rollout-automation-form__cancel":{marginLeft:"auto"},".rollout-automation-form__delete":{position:"relative",marginLeft:"auto",".rollout-automation-form__cancel ~ &":{marginLeft:"0"}},".rollout-automation-form-delete__confirm-dialog":{position:"absolute",bottom:"100%",right:"0",whiteSpace:"nowrap",background:"white",marginBottom:"12px",padding:"12px",border:"1px solid #F8F9FB",borderRadius:"8px",boxShadow:"0px 4px 16px rgba(0, 0, 0, 0.2)"},".rollout-automation-form__delete-confirm-text":{padding:"$3",fontSize:"$2",fontWeight:500},".rollout-automation-form__delete-confirm-buttons":{display:"flex",justifyContent:"space-between",gap:"$3",marginTop:"$4"},".rollout-automation-form__delete-cancel, .rollout-automation-form__delete-confirm":{width:"100%"},".rollout-automation-form__submit[disabled], .rollout-automation-form__submit[data-loading]":{opacity:.3},".rollout-form-control__label":{marginBottom:"8px",fontSize:"$2",fontWeight:500,display:"flex",alignItems:"center"},".rollout-form-control__lock-btn":{marginLeft:"auto",display:"flex",justifyContent:"center",alignItems:"center",border:"1px solid #EFF1F4",size:"20px",cursor:"pointer",borderRadius:"4px",boxShadow:"$md",color:"#91959C",transition:"all .2s ease","&[data-locked]":{color:"#9A58F6"},"&:hover":{background:"#F8F9FB"},svg:{height:"14px"}},".rollout-form-control__required-hint":{paddingLeft:"4px",color:"$primary"},".rollout-form-control__description":{marginBottom:"8px",fontSize:"13px"},".rollout-form-control__error":{marginTop:"4px",fontSize:"$2",color:"$error"},".rollout-automation-form__api-token-input":{height:"32px",marginTop:"$2",marginBottom:"$4",background:"#F8F9FB",border:"1px solid #EFF1F4",borderRadius:"4px",paddingX:"8px","&:focus":{background:"white"}},".rollout-automation-form__api-token-input-info":{fontSize:"0.75rem",marginBottom:"$1-5",color:"#6C6F75"},".rollout-automation-form__api-token-input-label":{fontSize:"$2",marginTop:"$1-5"},".rollout-automation-form__api-token-input-container":{marginTop:"$2"},".rollout-automation-form__api-token-connection-result":{fontSize:".85rem"},".rollout-automation-form__api-token-apitoken-button-container":{display:"flex",justifyContent:"flex-start",alignItems:"center",gap:"$2-5"},".rollout-blueprint-activator__header":{display:"flex",alignItems:"center",borderBottom:"1px solid",borderBottomColor:"$strokeMedium",paddingY:"12px"},".rollout-blueprint-activator__name":{marginLeft:"16px"},".rollout-blueprint-activator__label":{padding:"12px",fontSize:"$3",fontWeight:"bold",borderBottom:"1px solid",borderBottomColor:"$strokeMedium"},".rollout-blueprint-activator__trigger":{marginTop:"12px",border:"1px solid",borderColor:"$strokeMedium",borderRadius:"8px","& .rollout-automation-form__credentials":{marginBottom:"$3"}},".rollout-blueprint-activator__trigger__fields":{padding:"12px"},".rollout-blueprint-activator__activate-btn, .rollout-blueprint-activator__deactivate-btn":{marginTop:"12px"},".rollout__loading_spinner_container":{padding:"1rem",display:"flex",justifyContent:"center"},".rollout__loading_spinner":{height:"1rem",width:"1rem"},".rollout__base-input":{background:"#F8F9FB",border:"1px solid #EFF1F4",borderRadius:"4px",paddingX:"8px","&:focus":{background:"white"}},"input.rollout__base-input, select.rollout__base-input":{height:"32px"},".rollout__terms-of-service-link, .rollout__privacy-policy-link":{color:"#31373F",textDecoration:"underline","&:hover":{color:"#1e2227"}},".ace_editor":{backgroundColor:"$surfaceSecondary"},".rollout-card":{display:"flex",flexDirection:"column",gap:"12px",marginTop:"12px",padding:"16px",border:"1px solid #d5dce2",borderRadius:"8px"}});0&&(module.exports={AutomationCreator,AutomationEditor,AutomationsManager,BlueprintActivator,BlueprintsList,BlueprintsManager,MyAutomations,MyBlueprints,PoweredByRollout,RolloutConnectProvider,TaskInitiator,components,curlyTemplate,defaultTheme});
//# sourceMappingURL=index.cjs.js.map