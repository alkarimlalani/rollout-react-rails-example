"use strict";var m=Object.create;var c=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty;var A=(e,t)=>{for(var r in t)c(e,r,{get:t[r],enumerable:!0})},y=(e,t,r,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of k(t))!U.call(e,o)&&o!==r&&c(e,o,{get:()=>t[o],enumerable:!(u=g(t,o))||u.enumerable});return e};var d=(e,t,r)=>(r=e!=null?m(v(e)):{},y(t||!e||!e.__esModule?c(r,"default",{value:e,enumerable:!0}):r,e)),O=e=>y(c({},"__esModule",{value:!0}),e);var z={};A(z,{RolloutAPIClientProvider:()=>M,useLazyQuery:()=>w,useMutation:()=>E,useQuery:()=>h,useRolloutAPIClientContext:()=>I,useTRPCContext:()=>q});module.exports=O(z);var Q=d(require("assert")),R=require("@trpc/client"),T=require("@trpc/react"),n=d(require("react")),s=require("react-query"),i=(0,T.createReactQueryHooks)(),h=i.useQuery,E=i.useMutation,q=i.useContext;function w(e){let{client:t}=i.useContext(),[r,u]=(0,n.useState)(),[o,l]=(0,n.useState)(!1);return{...(0,s.useQuery)([e,r],()=>((0,Q.default)(r!=null),t.query(e,r)),{enabled:o}),fetch:p=>{u(p),l(!0)},input:r}}function M(e){let{token:t,apiBaseUrl:r,children:u}=e,o=(0,n.useRef)(void 0),l=(0,n.useCallback)(async()=>typeof t=="string"?t:(o.current==null&&(o.current=await t()),o.current),[t]),[a]=(0,n.useState)(()=>new s.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry(x,f){if(f instanceof R.TRPCClientError){if(f.data.code==="NOT_FOUND")return!1;if(f.data.code==="UNAUTHORIZED")return o.current=void 0,!0}return!0}}}})),[C]=(0,n.useState)(()=>i.createClient({url:`${r}/trpc`,async headers(){return{authorization:`Bearer ${await l()}`}}})),p=(0,n.useMemo)(()=>({getToken:l,apiBaseUrl:r}),[r]);return n.default.createElement(P.Provider,{value:p},n.default.createElement(i.Provider,{client:C,queryClient:a},n.default.createElement(s.QueryClientProvider,{client:a},u)))}var P=(0,n.createContext)(void 0);function I(){var t;let e=(0,n.useContext)(P);if(!e){let r=new Error("No RolloutAPIClientContext provided");throw r.name="ContextError",(t=Error.captureStackTrace)==null||t.call(Error,r,I),r}return e}0&&(module.exports={RolloutAPIClientProvider,useLazyQuery,useMutation,useQuery,useRolloutAPIClientContext,useTRPCContext});
//# sourceMappingURL=index.cjs.js.map