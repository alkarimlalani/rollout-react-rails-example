"use strict";var wr=Object.create;var ct=Object.defineProperty;var br=Object.getOwnPropertyDescriptor;var kr=Object.getOwnPropertyNames;var Cr=Object.getPrototypeOf,Or=Object.prototype.hasOwnProperty;var Mr=(r,t)=>{for(var e in t)ct(r,e,{get:t[e],enumerable:!0})},ae=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of kr(t))!Or.call(r,i)&&i!==e&&ct(r,i,{get:()=>t[i],enumerable:!(n=br(t,i))||n.enumerable});return r};var C=(r,t,e)=>(e=r!=null?wr(Cr(r)):{},ae(t||!r||!r.__esModule?ct(e,"default",{value:r,enumerable:!0}):e,r)),Tr=r=>ae(ct({},"__esModule",{value:!0}),r);var kn={};Mr(kn,{AnyBlockDocument:()=>Dt,CURLY_BRACKETS_SYMBOL:()=>Jt,CurlyBrackets:()=>Bt,EnterHandler:()=>Er,EscHandler:()=>Nr,FORMATTING_EXTENSIONS:()=>Pt,Link:()=>It,MENTION_SYMBOL:()=>zt,Mention:()=>At,ROLLOUTHQ_VARIABLE_PREFIX:()=>hr,SCHEMA_EXTENSIONS:()=>dt,ShiftEnterHandler:()=>Fr,SingleParagraphDocument:()=>Jr,appendText:()=>cn,capitalize:()=>gn,createDocument:()=>ut,createDocumentWithMention:()=>un,createMention:()=>Ct,createParagraph:()=>Ot,curlyBracketsConfig:()=>ue,curlyTemplate:()=>yn,flatMapMentions:()=>nt,getCurlyBracketsSuggestions:()=>Ar,getSuggestions:()=>Ir,getTextSeralizersFromSchema:()=>ur,inputDefToZodObject:()=>yr,isVariable:()=>xn,isZRichEditorContent:()=>wn,mentionConfig:()=>pe,passesValidation:()=>lr,plainToRichText:()=>re,prependText:()=>hn,resolveMentions:()=>ln,richTextToPlain:()=>dn,schema:()=>J,toHTML:()=>vn,toTextNode:()=>Mt,unresolveMentions:()=>mn,unwrapOptional:()=>gr,z:()=>bn,zRichEditorContent:()=>it,zodGuard:()=>Sn});module.exports=Tr(kn);var se=require("@tiptap/core"),Er=se.Extension.create({name:"EnterHandler",addKeyboardShortcuts(){return{Enter:r=>this.options.handler(r)??!1}}});var fe=require("@tiptap/core"),Nr=fe.Extension.create({name:"EscHandler",addKeyboardShortcuts(){return{Escape:r=>this.options.handler(r)??!1}}});var Rt=C(require("@tiptap/extension-link")),It=Rt.default.extend({addOptions(){return{...Rt.default.options,openOnClick:!1}}});var ht=require("@tiptap/core"),zt="@",pe={name:"mention",priority:110,group:"inline",inline:!0,selectable:!1,atom:!0,addCommands(){return{insertMentionSymbol:()=>({chain:r})=>r().insertContent(zt).focus().run()}},addStorage(){var r;return{variables:((r=this.options)==null?void 0:r.variables)??null,setVariables(t){this.variables=t},menuContainer:null}},addAttributes(){return{variable:{default:null,parseHTML:r=>({id:r.getAttribute("data-variable-id"),label:r.getAttribute("data-variable-label"),type:r.getAttribute("data-variable-type")}),renderHTML:r=>r.variable?{"data-variable-id":r.variable.id,"data-variable-label":r.variable.label,"data-variable-type":r.variable.type}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:r,HTMLAttributes:t}){var e;return["span",(0,ht.mergeAttributes)({"data-type":this.name},t),`${(e=r.attrs.variable)==null?void 0:e.label}`]},renderText({node:r}){let t=r.attrs.variable;return`${t.label??t.id}`},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:r,state:t})=>{let e=!1,{selection:n}=t,{empty:i,anchor:o}=n;return i?(t.doc.nodesBetween(o-1,o,(a,s)=>{if(a.type.name===this.name)return e=!0,r.insertText(zt,s,s+a.nodeSize),!1}),e):!1})}}},At=ht.Node.create(pe);var Ft=require("match-sorter");function Rr(r,t){return(0,Ft.matchSorter)(r,t,{keys:[e=>e.label],threshold:Ft.matchSorter.rankings.ACRONYM})}function Ir(r,t){let e=r.storage.mention,{variables:n}=e;return n?Rr(n,t):[]}var lt=require("@tiptap/core"),Jt="{{",ue={name:"curly-brackets",priority:110,group:"inline",inline:!0,selectable:!1,atom:!0,addCommands(){return{insertCurlyBracketsSymbol:()=>({chain:r})=>r().insertContent(Jt).focus().run()}},addStorage(){var r;return{variables:((r=this.options)==null?void 0:r.variables)??null,setVariables(t){this.variables=t},menuContainer:null}},addAttributes(){return{variable:{default:null,parseHTML:r=>({id:r.getAttribute("data-variable-id"),label:r.getAttribute("data-variable-label")}),renderHTML:r=>r.variable?{"data-variable-id":r.variable.id,"data-variable-label":r.variable.label}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:r,HTMLAttributes:t}){var e;return["span",(0,lt.mergeAttributes)({"data-type":this.name},t),`${(e=r.attrs.variable)==null?void 0:e.label}`]},renderText({node:r}){let t=r.attrs.variable;return`${t.label??t.id}`},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:r,state:t})=>{let e=!1,{selection:n}=t,{empty:i,anchor:o}=n;return i?(t.doc.nodesBetween(o-1,o,(a,s)=>{if(a.type.name===this.name)return e=!0,r.insertText(Jt,s,s+a.nodeSize),!1}),e):!1})}}},Bt=lt.Node.create(ue);var _t=require("match-sorter");function zr(r,t){return(0,_t.matchSorter)(r,t,{keys:[e=>e.label],threshold:_t.matchSorter.rankings.ACRONYM})}function Ar(r,t){let e=r.storage["curly-brackets"],{variables:n}=e;return n?zr(n,t):[]}var ce=require("@tiptap/core"),Fr=ce.Extension.create({name:"ShiftEnterHandler",addKeyboardShortcuts(){return{"Shift-Enter":r=>this.options.handler(r)??!1}}});var he=C(require("@tiptap/extension-blockquote")),le=C(require("@tiptap/extension-bold")),de=C(require("@tiptap/extension-bullet-list")),ve=C(require("@tiptap/extension-code")),me=C(require("@tiptap/extension-code-block")),ye=C(require("@tiptap/extension-gapcursor")),ge=C(require("@tiptap/extension-hard-break")),xe=C(require("@tiptap/extension-heading")),Se=C(require("@tiptap/extension-horizontal-rule")),we=C(require("@tiptap/extension-italic")),be=C(require("@tiptap/extension-list-item")),ke=C(require("@tiptap/extension-ordered-list")),Ce=C(require("@tiptap/extension-strike")),Oe=C(require("@tiptap/extension-underline")),Pt=[he.default,le.default,de.default,ve.default,me.default,ye.default,ge.default,xe.default,Se.default,we.default,be.default,ke.default,Ce.default,Oe.default];var Me=require("@tiptap/core"),Dt=Me.Node.create({name:"doc",topNode:!0,content:"block+"});var Te=require("@tiptap/core"),Jr=Te.Node.create({name:"doc",topNode:!0,content:"paragraph"});var Ee=require("@tiptap/core"),Ne=C(require("@tiptap/extension-paragraph")),Re=C(require("@tiptap/extension-text"));var dt=[Dt,It,At,Ne.default,Re.default,Bt,...Pt],J=(0,Ee.getSchema)(dt);function M(r){this.content=r}M.prototype={constructor:M,find:function(r){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===r)return t;return-1},get:function(r){var t=this.find(r);return t==-1?void 0:this.content[t+1]},update:function(r,t,e){var n=e&&e!=r?this.remove(e):this,i=n.find(r),o=n.content.slice();return i==-1?o.push(e||r,t):(o[i+1]=t,e&&(o[i]=e)),new M(o)},remove:function(r){var t=this.find(r);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new M(e)},addToStart:function(r,t){return new M([r,t].concat(this.remove(r).content))},addToEnd:function(r,t){var e=this.remove(r).content.slice();return e.push(r,t),new M(e)},addBefore:function(r,t,e){var n=this.remove(t),i=n.content.slice(),o=n.find(r);return i.splice(o==-1?i.length:o,0,t,e),new M(i)},forEach:function(r){for(var t=0;t<this.content.length;t+=2)r(this.content[t],this.content[t+1])},prepend:function(r){return r=M.from(r),r.size?new M(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=M.from(r),r.size?new M(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var t=this;r=M.from(r);for(var e=0;e<r.content.length;e+=2)t=t.remove(r.content[e]);return t},get size(){return this.content.length>>1}};M.from=function(r){if(r instanceof M)return r;var t=[];if(r)for(var e in r)t.push(e,r[e]);return new M(t)};var Br=M,Lt=Br;function Je(r,t,e){for(var n=0;;n++){if(n==r.childCount||n==t.childCount)return r.childCount==t.childCount?null:e;var i=r.child(n),o=t.child(n);if(i==o){e+=i.nodeSize;continue}if(!i.sameMarkup(o))return e;if(i.isText&&i.text!=o.text){for(var a=0;i.text[a]==o.text[a];a++)e++;return e}if(i.content.size||o.content.size){var s=Je(i.content,o.content,e+1);if(s!=null)return s}e+=i.nodeSize}}function Be(r,t,e,n){for(var i=r.childCount,o=t.childCount;;){if(i==0||o==0)return i==o?null:{a:e,b:n};var a=r.child(--i),s=t.child(--o),f=a.nodeSize;if(a==s){e-=f,n-=f;continue}if(!a.sameMarkup(s))return{a:e,b:n};if(a.isText&&a.text!=s.text){for(var p=0,u=Math.min(a.text.length,s.text.length);p<u&&a.text[a.text.length-p-1]==s.text[s.text.length-p-1];)p++,e--,n--;return{a:e,b:n}}if(a.content.size||s.content.size){var h=Be(a.content,s.content,e-1,n-1);if(h)return h}e-=f,n-=f}}var c=function(t,e){if(this.content=t,this.size=e||0,e==null)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize},St={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};c.prototype.nodesBetween=function(t,e,n,i,o){i===void 0&&(i=0);for(var a=0,s=0;s<e;a++){var f=this.content[a],p=s+f.nodeSize;if(p>t&&n(f,i+s,o,a)!==!1&&f.content.size){var u=s+1;f.nodesBetween(Math.max(0,t-u),Math.min(f.content.size,e-u),n,i+u)}s=p}};c.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)};c.prototype.textBetween=function(t,e,n,i){var o="",a=!0;return this.nodesBetween(t,e,function(s,f){s.isText?(o+=s.text.slice(Math.max(t,f)-f,e-f),a=!n):s.isLeaf&&i?(o+=typeof i=="function"?i(s):i,a=!n):!a&&s.isBlock&&(o+=n,a=!0)},0),o};c.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,n=t.firstChild,i=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(n)&&(i[i.length-1]=e.withText(e.text+n.text),o=1);o<t.content.length;o++)i.push(t.content[o]);return new c(i,this.size+t.size)};c.prototype.cut=function(t,e){if(e==null&&(e=this.size),t==0&&e==this.size)return this;var n=[],i=0;if(e>t)for(var o=0,a=0;a<e;o++){var s=this.content[o],f=a+s.nodeSize;f>t&&((a<t||f>e)&&(s.isText?s=s.cut(Math.max(0,t-a),Math.min(s.text.length,e-a)):s=s.cut(Math.max(0,t-a-1),Math.min(s.content.size,e-a-1))),n.push(s),i+=s.nodeSize),a=f}return new c(n,i)};c.prototype.cutByIndex=function(t,e){return t==e?c.empty:t==0&&e==this.content.length?this:new c(this.content.slice(t,e))};c.prototype.replaceChild=function(t,e){var n=this.content[t];if(n==e)return this;var i=this.content.slice(),o=this.size+e.nodeSize-n.nodeSize;return i[t]=e,new c(i,o)};c.prototype.addToStart=function(t){return new c([t].concat(this.content),this.size+t.nodeSize)};c.prototype.addToEnd=function(t){return new c(this.content.concat(t),this.size+t.nodeSize)};c.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0};St.firstChild.get=function(){return this.content.length?this.content[0]:null};St.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};St.childCount.get=function(){return this.content.length};c.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e};c.prototype.maybeChild=function(t){return this.content[t]};c.prototype.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var i=this.content[e];t(i,n,e),n+=i.nodeSize}};c.prototype.findDiffStart=function(t,e){return e===void 0&&(e=0),Je(this,t,e)};c.prototype.findDiffEnd=function(t,e,n){return e===void 0&&(e=this.size),n===void 0&&(n=t.size),Be(this,t,e,n)};c.prototype.findIndex=function(t,e){if(e===void 0&&(e=-1),t==0)return vt(0,t);if(t==this.size)return vt(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var n=0,i=0;;n++){var o=this.child(n),a=i+o.nodeSize;if(a>=t)return a==t||e>0?vt(n+1,a):vt(n,i);i=a}};c.prototype.toString=function(){return"<"+this.toStringInner()+">"};c.prototype.toStringInner=function(){return this.content.join(", ")};c.prototype.toJSON=function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null};c.fromJSON=function(t,e){if(!e)return c.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new c(e.map(t.nodeFromJSON))};c.fromArray=function(t){if(!t.length)return c.empty;for(var e,n=0,i=0;i<t.length;i++){var o=t[i];n+=o.nodeSize,i&&o.isText&&t[i-1].sameMarkup(o)?(e||(e=t.slice(0,i)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new c(e||t,n)};c.from=function(t){if(!t)return c.empty;if(t instanceof c)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new c([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(c.prototype,St);var qt={index:0,offset:0};function vt(r,t){return qt.index=r,qt.offset=t,qt}c.empty=new c([],0);function mt(r,t){if(r===t)return!0;if(!(r&&typeof r=="object")||!(t&&typeof t=="object"))return!1;var e=Array.isArray(r);if(Array.isArray(t)!=e)return!1;if(e){if(r.length!=t.length)return!1;for(var n=0;n<r.length;n++)if(!mt(r[n],t[n]))return!1}else{for(var i in r)if(!(i in t)||!mt(r[i],t[i]))return!1;for(var o in t)if(!(o in r))return!1}return!0}var y=function(t,e){this.type=t,this.attrs=e};y.prototype.addToSet=function(t){for(var e,n=!1,i=0;i<t.length;i++){var o=t[i];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,i));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,i)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e};y.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t};y.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1};y.prototype.eq=function(t){return this==t||this.type==t.type&&mt(this.attrs,t.attrs)};y.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t};y.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");return n.create(e.attrs)};y.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0};y.setFrom=function(t){if(!t||t.length==0)return y.none;if(t instanceof y)return[t];var e=t.slice();return e.sort(function(n,i){return n.type.rank-i.type.rank}),e};y.none=[];function D(r){var t=Error.call(this,r);return t.__proto__=D.prototype,t}D.prototype=Object.create(Error.prototype);D.prototype.constructor=D;D.prototype.name="ReplaceError";var d=function(t,e,n){this.content=t,this.openStart=e,this.openEnd=n},_e={size:{configurable:!0}};_e.size.get=function(){return this.content.size-this.openStart-this.openEnd};d.prototype.insertAt=function(t,e){var n=De(this.content,t+this.openStart,e,null);return n&&new d(n,this.openStart,this.openEnd)};d.prototype.removeBetween=function(t,e){return new d(Pe(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)};d.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd};d.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};d.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t};d.fromJSON=function(t,e){if(!e)return d.empty;var n=e.openStart||0,i=e.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new d(c.fromJSON(t,e.content),n,i)};d.maxOpen=function(t,e){e===void 0&&(e=!0);for(var n=0,i=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)n++;for(var a=t.lastChild;a&&!a.isLeaf&&(e||!a.type.spec.isolating);a=a.lastChild)i++;return new d(t,n,i)};Object.defineProperties(d.prototype,_e);function Pe(r,t,e){var n=r.findIndex(t),i=n.index,o=n.offset,a=r.maybeChild(i),s=r.findIndex(e),f=s.index,p=s.offset;if(o==t||a.isText){if(p!=e&&!r.child(f).isText)throw new RangeError("Removing non-flat range");return r.cut(0,t).append(r.cut(e))}if(i!=f)throw new RangeError("Removing non-flat range");return r.replaceChild(i,a.copy(Pe(a.content,t-o-1,e-o-1)))}function De(r,t,e,n){var i=r.findIndex(t),o=i.index,a=i.offset,s=r.maybeChild(o);if(a==t||s.isText)return n&&!n.canReplace(o,o,e)?null:r.cut(0,t).append(e).append(r.cut(t));var f=De(s.content,t-a-1,e);return f&&r.replaceChild(o,s.copy(f))}d.empty=new d(c.empty,0,0);function _r(r,t,e){if(e.openStart>r.depth)throw new D("Inserted content deeper than insertion position");if(r.depth-e.openStart!=t.depth-e.openEnd)throw new D("Inconsistent open depths");return Le(r,t,e,0)}function Le(r,t,e,n){var i=r.index(n),o=r.node(n);if(i==t.index(n)&&n<r.depth-e.openStart){var a=Le(r,t,e,n+1);return o.copy(o.content.replaceChild(i,a))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&r.depth==n&&t.depth==n){var s=r.parent,f=s.content;return j(s,f.cut(0,r.parentOffset).append(e.content).append(f.cut(t.parentOffset)))}else{var p=Pr(e,r),u=p.start,h=p.end;return j(o,We(r,u,h,t,n))}else return j(o,yt(r,t,n))}function qe(r,t){if(!t.type.compatibleContent(r.type))throw new D("Cannot join "+t.type.name+" onto "+r.type.name)}function Vt(r,t,e){var n=r.node(e);return qe(n,t.node(e)),n}function Z(r,t){var e=t.length-1;e>=0&&r.isText&&r.sameMarkup(t[e])?t[e]=r.withText(t[e].text+r.text):t.push(r)}function ot(r,t,e,n){var i=(t||r).node(e),o=0,a=t?t.index(e):i.childCount;r&&(o=r.index(e),r.depth>e?o++:r.textOffset&&(Z(r.nodeAfter,n),o++));for(var s=o;s<a;s++)Z(i.child(s),n);t&&t.depth==e&&t.textOffset&&Z(t.nodeBefore,n)}function j(r,t){if(!r.type.validContent(t))throw new D("Invalid content for node "+r.type.name);return r.copy(t)}function We(r,t,e,n,i){var o=r.depth>i&&Vt(r,t,i+1),a=n.depth>i&&Vt(e,n,i+1),s=[];return ot(null,r,i,s),o&&a&&t.index(i)==e.index(i)?(qe(o,a),Z(j(o,We(r,t,e,n,i+1)),s)):(o&&Z(j(o,yt(r,t,i+1)),s),ot(t,e,i,s),a&&Z(j(a,yt(e,n,i+1)),s)),ot(n,null,i,s),new c(s)}function yt(r,t,e){var n=[];if(ot(null,r,e,n),r.depth>e){var i=Vt(r,t,e+1);Z(j(i,yt(r,t,e+1)),n)}return ot(t,null,e,n),new c(n)}function Pr(r,t){for(var e=t.depth-r.openStart,n=t.node(e),i=n.copy(r.content),o=e-1;o>=0;o--)i=t.node(o).copy(c.from(i));return{start:i.resolveNoCache(r.openStart+e),end:i.resolveNoCache(i.content.size-r.openEnd-e)}}var w=function(t,e,n){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=n},Q={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};w.prototype.resolveDepth=function(t){return t==null?this.depth:t<0?this.depth+t:t};Q.parent.get=function(){return this.node(this.depth)};Q.doc.get=function(){return this.node(0)};w.prototype.node=function(t){return this.path[this.resolveDepth(t)*3]};w.prototype.index=function(t){return this.path[this.resolveDepth(t)*3+1]};w.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)};w.prototype.start=function(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1};w.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size};w.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]};w.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize};Q.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};Q.nodeAfter.get=function(){var r=this.parent,t=this.index(this.depth);if(t==r.childCount)return null;var e=this.pos-this.path[this.path.length-1],n=r.child(t);return e?r.child(t).cut(e):n};Q.nodeBefore.get=function(){var r=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(r).cut(0,t):r==0?null:this.parent.child(r-1)};w.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var n=this.path[e*3],i=e==0?0:this.path[e*3-1]+1,o=0;o<t;o++)i+=n.child(o).nodeSize;return i};w.prototype.marks=function(){var t=this.parent,e=this.index();if(t.content.size==0)return y.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),i=t.maybeChild(e);if(!n){var o=n;n=i,i=o}for(var a=n.marks,s=0;s<a.length;s++)a[s].type.spec.inclusive===!1&&(!i||!a[s].isInSet(i.marks))&&(a=a[s--].removeFromSet(a));return a};w.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,i=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)n[o].type.spec.inclusive===!1&&(!i||!n[o].isInSet(i.marks))&&(n=n[o--].removeFromSet(n));return n};w.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0};w.prototype.blockRange=function(t,e){if(t===void 0&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new He(this,t,n)};w.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset};w.prototype.max=function(t){return t.pos>this.pos?t:this};w.prototype.min=function(t){return t.pos<this.pos?t:this};w.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset};w.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var n=[],i=0,o=e,a=t;;){var s=a.content.findIndex(o),f=s.index,p=s.offset,u=o-p;if(n.push(a,f,i+p),!u||(a=a.child(f),a.isText))break;o=u-1,i+=p+1}return new w(e,n,o)};w.resolveCached=function(t,e){for(var n=0;n<Wt.length;n++){var i=Wt[n];if(i.pos==e&&i.doc==t)return i}var o=Wt[Ht]=w.resolve(t,e);return Ht=(Ht+1)%Dr,o};Object.defineProperties(w.prototype,Q);var Wt=[],Ht=0,Dr=12,He=function(t,e,n){this.$from=t,this.$to=e,this.depth=n},K={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};K.start.get=function(){return this.$from.before(this.depth+1)};K.end.get=function(){return this.$to.after(this.depth+1)};K.parent.get=function(){return this.$from.node(this.depth)};K.startIndex.get=function(){return this.$from.index(this.depth)};K.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(He.prototype,K);var Lr=Object.create(null),m=function(t,e,n,i){this.type=t,this.attrs=e,this.content=n||c.empty,this.marks=i||y.none},A={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};A.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};A.childCount.get=function(){return this.content.childCount};m.prototype.child=function(t){return this.content.child(t)};m.prototype.maybeChild=function(t){return this.content.maybeChild(t)};m.prototype.forEach=function(t){this.content.forEach(t)};m.prototype.nodesBetween=function(t,e,n,i){i===void 0&&(i=0),this.content.nodesBetween(t,e,n,i,this)};m.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)};A.textContent.get=function(){return this.textBetween(0,this.content.size,"")};m.prototype.textBetween=function(t,e,n,i){return this.content.textBetween(t,e,n,i)};A.firstChild.get=function(){return this.content.firstChild};A.lastChild.get=function(){return this.content.lastChild};m.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)};m.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)};m.prototype.hasMarkup=function(t,e,n){return this.type==t&&mt(this.attrs,e||t.defaultAttrs||Lr)&&y.sameSet(this.marks,n||y.none)};m.prototype.copy=function(t){return t===void 0&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)};m.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)};m.prototype.cut=function(t,e){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))};m.prototype.slice=function(t,e,n){if(e===void 0&&(e=this.content.size),n===void 0&&(n=!1),t==e)return d.empty;var i=this.resolve(t),o=this.resolve(e),a=n?0:i.sharedDepth(e),s=i.start(a),f=i.node(a),p=f.content.cut(i.pos-s,o.pos-s);return new d(p,i.depth-a,o.depth-a)};m.prototype.replace=function(t,e,n){return _r(this.resolve(t),this.resolve(e),n)};m.prototype.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),i=n.index,o=n.offset;if(e=e.maybeChild(i),!e)return null;if(o==t||e.isText)return e;t-=o+1}};m.prototype.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,i=e.offset;return{node:this.content.maybeChild(n),index:n,offset:i}};m.prototype.childBefore=function(t){if(t==0)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,i=e.offset;if(i<t)return{node:this.content.child(n),index:n,offset:i};var o=this.content.child(n-1);return{node:o,index:n-1,offset:i-o.nodeSize}};m.prototype.resolve=function(t){return w.resolveCached(this,t)};m.prototype.resolveNoCache=function(t){return w.resolve(this,t)};m.prototype.rangeHasMark=function(t,e,n){var i=!1;return e>t&&this.nodesBetween(t,e,function(o){return n.isInSet(o.marks)&&(i=!0),!i}),i};A.isBlock.get=function(){return this.type.isBlock};A.isTextblock.get=function(){return this.type.isTextblock};A.inlineContent.get=function(){return this.type.inlineContent};A.isInline.get=function(){return this.type.isInline};A.isText.get=function(){return this.type.isText};A.isLeaf.get=function(){return this.type.isLeaf};A.isAtom.get=function(){return this.type.isAtom};m.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Ve(this.marks,t)};m.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e};m.prototype.canReplace=function(t,e,n,i,o){n===void 0&&(n=c.empty),i===void 0&&(i=0),o===void 0&&(o=n.childCount);var a=this.contentMatchAt(t).matchFragment(n,i,o),s=a&&a.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var f=i;f<o;f++)if(!this.type.allowsMarks(n.child(f).marks))return!1;return!0};m.prototype.canReplaceWith=function(t,e,n,i){if(i&&!this.type.allowsMarks(i))return!1;var o=this.contentMatchAt(t).matchType(n),a=o&&o.matchFragment(this.content,e);return a?a.validEnd:!1};m.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)};m.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=y.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!y.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(n){return n.type.name}));this.content.forEach(function(n){return n.check()})};m.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(n){return n.toJSON()})),t};m.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var i=c.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,i,n)};Object.defineProperties(m.prototype,A);var qr=function(r){function t(n,i,o,a){if(r.call(this,n,i,null,a),!o)throw new RangeError("Empty text nodes are not allowed");this.text=o}r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t;var e={textContent:{configurable:!0},nodeSize:{configurable:!0}};return t.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Ve(this.marks,JSON.stringify(this.text))},e.textContent.get=function(){return this.text},t.prototype.textBetween=function(i,o){return this.text.slice(i,o)},e.nodeSize.get=function(){return this.text.length},t.prototype.mark=function(i){return i==this.marks?this:new t(this.type,this.attrs,this.text,i)},t.prototype.withText=function(i){return i==this.text?this:new t(this.type,this.attrs,i,this.marks)},t.prototype.cut=function(i,o){return i===void 0&&(i=0),o===void 0&&(o=this.text.length),i==0&&o==this.text.length?this:this.withText(this.text.slice(i,o))},t.prototype.eq=function(i){return this.sameMarkup(i)&&this.text==i.text},t.prototype.toJSON=function(){var i=r.prototype.toJSON.call(this);return i.text=this.text,i},Object.defineProperties(t.prototype,e),t}(m);function Ve(r,t){for(var e=r.length-1;e>=0;e--)t=r[e].type.name+"("+t+")";return t}var T=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},wt={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};T.parse=function(t,e){var n=new bt(t,e);if(n.next==null)return T.empty;var i=je(n);n.next&&n.err("Unexpected trailing text");var o=Gr(Ur(i));return Xr(o,n),o};T.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null};T.prototype.matchFragment=function(t,e,n){e===void 0&&(e=0),n===void 0&&(n=t.childCount);for(var i=this,o=e;i&&o<n;o++)i=i.matchType(t.child(o).type);return i};wt.inlineContent.get=function(){var r=this.next[0];return r?r.isInline:!1};wt.defaultType.get=function(){for(var r=0;r<this.next.length;r+=2){var t=this.next[r];if(!(t.isText||t.hasRequiredAttrs()))return t}};T.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var n=0;n<t.next.length;n+=2)if(this.next[e]==t.next[n])return!0;return!1};T.prototype.fillBefore=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=0);var i=[this];function o(a,s){var f=a.matchFragment(t,n);if(f&&(!e||f.validEnd))return c.from(s.map(function(v){return v.createAndFill()}));for(var p=0;p<a.next.length;p+=2){var u=a.next[p],h=a.next[p+1];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(h)==-1){i.push(h);var l=o(h,s.concat(u));if(l)return l}}}return o(this,[])};T.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n};T.prototype.computeWrapping=function(t){for(var e=Object.create(null),n=[{match:this,type:null,via:null}];n.length;){var i=n.shift(),o=i.match;if(o.matchType(t)){for(var a=[],s=i;s.type;s=s.via)a.push(s.type);return a.reverse()}for(var f=0;f<o.next.length;f+=2){var p=o.next[f];!p.isLeaf&&!p.hasRequiredAttrs()&&!(p.name in e)&&(!i.type||o.next[f+1].validEnd)&&(n.push({match:p.contentMatch,type:p,via:i}),e[p.name]=!0)}}};wt.edgeCount.get=function(){return this.next.length>>1};T.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}};T.prototype.toString=function(){var t=[];function e(n){t.push(n);for(var i=1;i<n.next.length;i+=2)t.indexOf(n.next[i])==-1&&e(n.next[i])}return e(this),t.map(function(n,i){for(var o=i+(n.validEnd?"*":" ")+" ",a=0;a<n.next.length;a+=2)o+=(a?", ":"")+n.next[a].name+"->"+t.indexOf(n.next[a+1]);return o}).join(`
`)};Object.defineProperties(T.prototype,wt);T.empty=new T(!0);var bt=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},Ze={next:{configurable:!0}};Ze.next.get=function(){return this.tokens[this.pos]};bt.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)};bt.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")};Object.defineProperties(bt.prototype,Ze);function je(r){var t=[];do t.push(Wr(r));while(r.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function Wr(r){var t=[];do t.push(Hr(r));while(r.next&&r.next!=")"&&r.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function Hr(r){for(var t=jr(r);;)if(r.eat("+"))t={type:"plus",expr:t};else if(r.eat("*"))t={type:"star",expr:t};else if(r.eat("?"))t={type:"opt",expr:t};else if(r.eat("{"))t=Vr(r,t);else break;return t}function Ie(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");var t=Number(r.next);return r.pos++,t}function Vr(r,t){var e=Ie(r),n=e;return r.eat(",")&&(r.next!="}"?n=Ie(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:e,max:n,expr:t}}function Zr(r,t){var e=r.nodeTypes,n=e[t];if(n)return[n];var i=[];for(var o in e){var a=e[o];a.groups.indexOf(t)>-1&&i.push(a)}return i.length==0&&r.err("No node type or group '"+t+"' found"),i}function jr(r){if(r.eat("(")){var t=je(r);return r.eat(")")||r.err("Missing closing paren"),t}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{var e=Zr(r,r.next).map(function(n){return r.inline==null?r.inline=n.isInline:r.inline!=n.isInline&&r.err("Mixing inline and block content"),{type:"name",value:n}});return r.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Ur(r){var t=[[]];return i(o(r,0),e()),t;function e(){return t.push([])-1}function n(a,s,f){var p={term:f,to:s};return t[a].push(p),p}function i(a,s){a.forEach(function(f){return f.to=s})}function o(a,s){if(a.type=="choice")return a.exprs.reduce(function(P,L){return P.concat(o(L,s))},[]);if(a.type=="seq")for(var f=0;;f++){var p=o(a.exprs[f],s);if(f==a.exprs.length-1)return p;i(p,s=e())}else if(a.type=="star"){var u=e();return n(s,u),i(o(a.expr,u),u),[n(u)]}else if(a.type=="plus"){var h=e();return i(o(a.expr,s),h),i(o(a.expr,h),h),[n(h)]}else{if(a.type=="opt")return[n(s)].concat(o(a.expr,s));if(a.type=="range"){for(var l=s,v=0;v<a.min;v++){var g=e();i(o(a.expr,l),g),l=g}if(a.max==-1)i(o(a.expr,l),l);else for(var x=a.min;x<a.max;x++){var k=e();n(l,k),i(o(a.expr,l),k),l=k}return[n(l)]}else if(a.type=="name")return[n(s,null,a.value)]}}}function Ue(r,t){return t-r}function ze(r,t){var e=[];return n(t),e.sort(Ue);function n(i){var o=r[i];if(o.length==1&&!o[0].term)return n(o[0].to);e.push(i);for(var a=0;a<o.length;a++){var s=o[a],f=s.term,p=s.to;!f&&e.indexOf(p)==-1&&n(p)}}}function Gr(r){var t=Object.create(null);return e(ze(r,0));function e(n){var i=[];n.forEach(function(f){r[f].forEach(function(p){var u=p.term,h=p.to;if(!!u){var l=i.indexOf(u),v=l>-1&&i[l+1];ze(r,h).forEach(function(g){v||i.push(u,v=[]),v.indexOf(g)==-1&&v.push(g)})}})});for(var o=t[n.join(",")]=new T(n.indexOf(r.length-1)>-1),a=0;a<i.length;a+=2){var s=i[a+1].sort(Ue);o.next.push(i[a],t[s.join(",")]||e(s))}return o}}function Xr(r,t){for(var e=0,n=[r];e<n.length;e++){for(var i=n[e],o=!i.validEnd,a=[],s=0;s<i.next.length;s+=2){var f=i.next[s],p=i.next[s+1];a.push(f.name),o&&!(f.isText||f.hasRequiredAttrs())&&(o=!1),n.indexOf(p)==-1&&n.push(p)}o&&t.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Ge(r){var t=Object.create(null);for(var e in r){var n=r[e];if(!n.hasDefault)return null;t[e]=n.default}return t}function Xe(r,t){var e=Object.create(null);for(var n in r){var i=t&&t[n];if(i===void 0){var o=r[n];if(o.hasDefault)i=o.default;else throw new RangeError("No value supplied for attribute "+n)}e[n]=i}return e}function Ye(r){var t=Object.create(null);if(r)for(var e in r)t[e]=new Qe(r[e]);return t}var N=function(t,e,n){this.name=t,this.schema=e,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=Ye(n.attrs),this.defaultAttrs=Ge(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||t=="text"),this.isText=t=="text"},$={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};$.isInline.get=function(){return!this.isBlock};$.isTextblock.get=function(){return this.isBlock&&this.inlineContent};$.isLeaf.get=function(){return this.contentMatch==T.empty};$.isAtom.get=function(){return this.isLeaf||this.spec.atom};$.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")};N.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1};N.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)};N.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:Xe(this.attrs,t)};N.prototype.create=function(t,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new m(this,this.computeAttrs(t),c.from(e),y.setFrom(n))};N.prototype.createChecked=function(t,e,n){if(e=c.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new m(this,this.computeAttrs(t),e,y.setFrom(n))};N.prototype.createAndFill=function(t,e,n){if(t=this.computeAttrs(t),e=c.from(e),e.size){var i=this.contentMatch.fillBefore(e);if(!i)return null;e=i.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(c.empty,!0);return o?new m(this,t,e.append(o),y.setFrom(n)):null};N.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0};N.prototype.allowsMarkType=function(t){return this.markSet==null||this.markSet.indexOf(t)>-1};N.prototype.allowsMarks=function(t){if(this.markSet==null)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0};N.prototype.allowedMarks=function(t){if(this.markSet==null)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:y.empty:t};N.compile=function(t,e){var n=Object.create(null);t.forEach(function(a,s){return n[a]=new N(a,e,s)});var i=e.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var o in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n};Object.defineProperties(N.prototype,$);var Qe=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},Ke={isRequired:{configurable:!0}};Ke.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(Qe.prototype,Ke);var W=function(t,e,n,i){this.name=t,this.schema=n,this.spec=i,this.attrs=Ye(i.attrs),this.rank=e,this.excluded=null;var o=Ge(this.attrs);this.instance=o&&new y(this,o)};W.prototype.create=function(t){return!t&&this.instance?this.instance:new y(this,Xe(this.attrs,t))};W.compile=function(t,e){var n=Object.create(null),i=0;return t.forEach(function(o,a){return n[o]=new W(o,i++,e,a)}),n};W.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t};W.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]};W.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var tt=function(t){this.spec={};for(var e in t)this.spec[e]=t[e];this.spec.nodes=Lt.from(t.nodes),this.spec.marks=Lt.from(t.marks),this.nodes=N.compile(this.spec.nodes,this),this.marks=W.compile(this.spec.marks,this);var n=Object.create(null);for(var i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");var o=this.nodes[i],a=o.spec.content||"",s=o.spec.marks;o.contentMatch=n[a]||(n[a]=T.parse(a,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet=s=="_"?null:s?Ae(this,s.split(" ")):s==""||!o.inlineContent?[]:null}for(var f in this.marks){var p=this.marks[f],u=p.spec.excludes;p.excluded=u==null?[p]:u==""?[]:Ae(this,u.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};tt.prototype.node=function(t,e,n,i){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof N){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,n,i)};tt.prototype.text=function(t,e){var n=this.nodes.text;return new qr(n,n.defaultAttrs,t,y.setFrom(e))};tt.prototype.mark=function(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)};tt.prototype.nodeFromJSON=function(t){return m.fromJSON(this,t)};tt.prototype.markFromJSON=function(t){return y.fromJSON(this,t)};tt.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};function Ae(r,t){for(var e=[],n=0;n<t.length;n++){var i=t[n],o=r.marks[i],a=o;if(o)e.push(o);else for(var s in r.marks){var f=r.marks[s];(i=="_"||f.spec.group&&f.spec.group.split(" ").indexOf(i)>-1)&&e.push(a=f)}if(!a)throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}return e}var H=function(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach(function(i){i.tag?n.tags.push(i):i.style&&n.styles.push(i)}),this.normalizeLists=!this.tags.some(function(i){if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;var o=t.nodes[i.node];return o.contentMatch.matchType(o)})};H.prototype.parse=function(t,e){e===void 0&&(e={});var n=new S(this,e,!1);return n.addAll(t,null,e.from,e.to),n.finish()};H.prototype.parseSlice=function(t,e){e===void 0&&(e={});var n=new S(this,e,!0);return n.addAll(t,null,e.from,e.to),d.maxOpen(n.finish())};H.prototype.matchTag=function(t,e,n){for(var i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){var o=this.tags[i];if(Kr(t,o.tag)&&(o.namespace===void 0||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){var a=o.getAttrs(t);if(a===!1)continue;o.attrs=a}return o}}};H.prototype.matchStyle=function(t,e,n,i){for(var o=i?this.styles.indexOf(i)+1:0;o<this.styles.length;o++){var a=this.styles[o];if(!(a.style.indexOf(t)!=0||a.context&&!n.matchesContext(a.context)||a.style.length>t.length&&(a.style.charCodeAt(t.length)!=61||a.style.slice(t.length+1)!=e))){if(a.getAttrs){var s=a.getAttrs(e);if(s===!1)continue;a.attrs=s}return a}}};H.schemaRules=function(t){var e=[];function n(f){for(var p=f.priority==null?50:f.priority,u=0;u<e.length;u++){var h=e[u],l=h.priority==null?50:h.priority;if(l<p)break}e.splice(u,0,f)}var i=function(f){var p=t.marks[f].spec.parseDOM;p&&p.forEach(function(u){n(u=Fe(u)),u.mark=f})};for(var o in t.marks)i(o);var a=function(f){var p=t.nodes[s].spec.parseDOM;p&&p.forEach(function(u){n(u=Fe(u)),u.node=s})};for(var s in t.nodes)a();return e};H.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new H(t,H.schemaRules(t)))};var Zt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Yr={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},$e={ol:!0,ul:!0},gt=1,xt=2,at=4;function tr(r,t,e){return t!=null?(t?gt:0)|(t==="full"?xt:0):r&&r.whitespace=="pre"?gt|xt:e&~at}var q=function(t,e,n,i,o,a,s){this.type=t,this.attrs=e,this.solid=o,this.match=a||(s&at?null:t.contentMatch),this.options=s,this.content=[],this.marks=n,this.activeMarks=y.none,this.pendingMarks=i,this.stashMarks=[]};q.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(c.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{var n=this.type.contentMatch,i;return(i=n.findWrapping(t.type))?(this.match=n,i):null}}return this.match.findWrapping(t.type)};q.prototype.finish=function(t){if(!(this.options&gt)){var e=this.content[this.content.length-1],n;e&&e.isText&&(n=/[ \t\r\n\u000c]+$/.exec(e.text))&&(e.text.length==n[0].length?this.content.pop():this.content[this.content.length-1]=e.withText(e.text.slice(0,e.text.length-n[0].length)))}var i=c.from(this.content);return!t&&this.match&&(i=i.append(this.match.fillBefore(c.empty,!0))),this.type?this.type.create(this.attrs,i,this.marks):i};q.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]};q.prototype.applyPending=function(t){for(var e=0,n=this.pendingMarks;e<n.length;e++){var i=n[e];(this.type?this.type.allowsMarkType(i.type):tn(i.type,t))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}};q.prototype.inlineContext=function(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Zt.hasOwnProperty(t.parentNode.nodeName.toLowerCase())};var S=function(t,e,n){this.parser=t,this.options=e,this.isOpen=n;var i=e.topNode,o,a=tr(null,e.preserveWhitespace,0)|(n?at:0);i?o=new q(i.type,i.attrs,y.none,y.none,!0,e.topMatch||i.type.contentMatch,a):n?o=new q(null,null,y.none,y.none,!0,null,a):o=new q(t.schema.topNodeType,null,y.none,y.none,!0,null,a),this.nodes=[o],this.open=0,this.find=e.findPositions,this.needsBlock=!1},jt={top:{configurable:!0},currentPos:{configurable:!0}};jt.top.get=function(){return this.nodes[this.open]};S.prototype.addDOM=function(t){if(t.nodeType==3)this.addTextNode(t);else if(t.nodeType==1){var e=t.getAttribute("style"),n=e?this.readStyles($r(e)):null,i=this.top;if(n!=null)for(var o=0;o<n.length;o++)this.addPendingMark(n[o]);if(this.addElement(t),n!=null)for(var a=0;a<n.length;a++)this.removePendingMark(n[a],i)}};S.prototype.addTextNode=function(t){var e=t.nodeValue,n=this.top;if(n.options&xt||n.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&gt)n.options&xt?e=e.replace(/\r\n?/g,`
`):e=e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var i=n.content[n.content.length-1],o=t.previousSibling;(!i||o&&o.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)};S.prototype.addElement=function(t,e){var n=t.nodeName.toLowerCase(),i;$e.hasOwnProperty(n)&&this.parser.normalizeLists&&Qr(t);var o=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,e));if(o?o.ignore:Yr.hasOwnProperty(n))this.findInside(t),this.ignoreFallback(t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(t=o.skip);var a,s=this.top,f=this.needsBlock;if(Zt.hasOwnProperty(n))a=!0,s.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t),a&&this.sync(s),this.needsBlock=f}else this.addElementByRule(t,o,o.consuming===!1?i:null)};S.prototype.leafFallback=function(t){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`))};S.prototype.ignoreFallback=function(t){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};S.prototype.readStyles=function(t){var e=y.none;t:for(var n=0;n<t.length;n+=2)for(var i=null;;){var o=this.parser.matchStyle(t[n],t[n+1],this,i);if(!o)continue t;if(o.ignore)return null;if(e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),o.consuming===!1)i=o;else break}return e};S.prototype.addElementByRule=function(t,e,n){var i=this,o,a,s,f;e.node?(a=this.parser.schema.nodes[e.node],a.isLeaf?this.insertNode(a.create(e.attrs))||this.leafFallback(t):o=this.enter(a,e.attrs,e.preserveWhitespace)):(s=this.parser.schema.marks[e.mark],f=s.create(e.attrs),this.addPendingMark(f));var p=this.top;if(a&&a.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(function(h){return i.insertNode(h)});else{var u=e.contentElement;typeof u=="string"?u=t.querySelector(u):typeof u=="function"&&(u=u(t)),u||(u=t),this.findAround(t,u,!0),this.addAll(u,o)}o&&(this.sync(p),this.open--),f&&this.removePendingMark(f,p)};S.prototype.addAll=function(t,e,n,i){for(var o=n||0,a=n?t.childNodes[n]:t.firstChild,s=i==null?null:t.childNodes[i];a!=s;a=a.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(a),e&&Zt.hasOwnProperty(a.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)};S.prototype.findPlace=function(t){for(var e,n,i=this.open;i>=0;i--){var o=this.nodes[i],a=o.findWrapping(t);if(a&&(!e||e.length>a.length)&&(e=a,n=o,!a.length)||o.solid)break}if(!e)return!1;this.sync(n);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0};S.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type),n.match&&(n.match=n.match.matchType(t.type));for(var i=n.activeMarks,o=0;o<t.marks.length;o++)(!n.type||n.type.allowsMarkType(t.marks[o].type))&&(i=t.marks[o].addToSet(i));return n.content.push(t.mark(i)),!0}return!1};S.prototype.enter=function(t,e,n){var i=this.findPlace(t.create(e));return i&&this.enterInner(t,e,!0,n),i};S.prototype.enterInner=function(t,e,n,i){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var a=tr(t,i,o.options);o.options&at&&o.content.length==0&&(a|=at),this.nodes.push(new q(t,e,o.activeMarks,o.pendingMarks,n,null,a)),this.open++};S.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}};S.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};S.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t){this.open=e;return}};jt.currentPos.get=function(){this.closeExtra();for(var r=0,t=this.open;t>=0;t--){for(var e=this.nodes[t].content,n=e.length-1;n>=0;n--)r+=e[n].nodeSize;t&&r++}return r};S.prototype.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)};S.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)};S.prototype.findAround=function(t,e,n){if(t!=e&&this.find){for(var i=0;i<this.find.length;i++)if(this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)){var o=e.compareDocumentPosition(this.find[i].node);o&(n?2:4)&&(this.find[i].pos=this.currentPos)}}};S.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))};S.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),i=this.options.context,o=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),a=-(i?i.depth+1:0)+(o?0:1),s=function(f,p){for(;f>=0;f--){var u=n[f];if(u==""){if(f==n.length-1||f==0)continue;for(;p>=a;p--)if(s(f-1,p))return!0;return!1}else{var h=p>0||p==0&&o?e.nodes[p].type:i&&p>=a?i.node(p-a).type:null;if(!h||h.name!=u&&h.groups.indexOf(u)==-1)return!1;p--}}return!0};return s(n.length-1,this.open)};S.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var i in this.parser.schema.nodes){var o=this.parser.schema.nodes[i];if(o.isTextblock&&o.defaultAttrs)return o}};S.prototype.addPendingMark=function(t){var e=en(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)};S.prototype.removePendingMark=function(t,e){for(var n=this.open;n>=0;n--){var i=this.nodes[n],o=i.pendingMarks.lastIndexOf(t);if(o>-1)i.pendingMarks=t.removeFromSet(i.pendingMarks);else{i.activeMarks=t.removeFromSet(i.activeMarks);var a=i.popFromStashMark(t);a&&i.type&&i.type.allowsMarkType(a.type)&&(i.activeMarks=a.addToSet(i.activeMarks))}if(i==e)break}};Object.defineProperties(S.prototype,jt);function Qr(r){for(var t=r.firstChild,e=null;t;t=t.nextSibling){var n=t.nodeType==1?t.nodeName.toLowerCase():null;n&&$e.hasOwnProperty(n)&&e?(e.appendChild(t),t=e):n=="li"?e=t:n&&(e=null)}}function Kr(r,t){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,t)}function $r(r){for(var t=/\s*([\w-]+)\s*:\s*([^;]+)/g,e,n=[];e=t.exec(r);)n.push(e[1],e[2].trim());return n}function Fe(r){var t={};for(var e in r)t[e]=r[e];return t}function tn(r,t){var e=t.schema.nodes,n=function(a){var s=e[a];if(!!s.allowsMarkType(r)){var f=[],p=function(u){f.push(u);for(var h=0;h<u.edgeCount;h++){var l=u.edge(h),v=l.type,g=l.next;if(v==t||f.indexOf(g)<0&&p(g))return!0}};if(p(s.contentMatch))return{v:!0}}};for(var i in e){var o=n(i);if(o)return o.v}}function en(r,t){for(var e=0;e<t.length;e++)if(r.eq(t[e]))return t[e]}var B=function(t,e){this.nodes=t||{},this.marks=e||{}};B.prototype.serializeFragment=function(t,e,n){var i=this;e===void 0&&(e={}),n||(n=Ut(e).createDocumentFragment());var o=n,a=null;return t.forEach(function(s){if(a||s.marks.length){a||(a=[]);for(var f=0,p=0;f<a.length&&p<s.marks.length;){var u=s.marks[p];if(!i.marks[u.type.name]){p++;continue}if(!u.eq(a[f])||u.type.spec.spanning===!1)break;f+=2,p++}for(;f<a.length;)o=a.pop(),a.pop();for(;p<s.marks.length;){var h=s.marks[p++],l=i.serializeMark(h,s.isInline,e);l&&(a.push(h,o),o.appendChild(l.dom),o=l.contentDOM||l.dom)}}o.appendChild(i.serializeNodeInner(s,e))}),n};B.prototype.serializeNodeInner=function(t,e){e===void 0&&(e={});var n=B.renderSpec(Ut(e),this.nodes[t.type.name](t)),i=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return i};B.prototype.serializeNode=function(t,e){e===void 0&&(e={});for(var n=this.serializeNodeInner(t,e),i=t.marks.length-1;i>=0;i--){var o=this.serializeMark(t.marks[i],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n};B.prototype.serializeMark=function(t,e,n){n===void 0&&(n={});var i=this.marks[t.type.name];return i&&B.renderSpec(Ut(n),i(t,e))};B.renderSpec=function(t,e,n){if(n===void 0&&(n=null),typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;var i=e[0],o=i.indexOf(" ");o>0&&(n=i.slice(0,o),i=i.slice(o+1));var a=null,s=n?t.createElementNS(n,i):t.createElement(i),f=e[1],p=1;if(f&&typeof f=="object"&&f.nodeType==null&&!Array.isArray(f)){p=2;for(var u in f)if(f[u]!=null){var h=u.indexOf(" ");h>0?s.setAttributeNS(u.slice(0,h),u.slice(h+1),f[u]):s.setAttribute(u,f[u])}}for(var l=p;l<e.length;l++){var v=e[l];if(v===0){if(l<e.length-1||l>p)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}else{var g=B.renderSpec(t,v,n),x=g.dom,k=g.contentDOM;if(s.appendChild(x),k){if(a)throw new RangeError("Multiple content holes");a=k}}}return{dom:s,contentDOM:a}};B.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new B(this.nodesFromSchema(t),this.marksFromSchema(t)))};B.nodesFromSchema=function(t){var e=er(t.nodes);return e.text||(e.text=function(n){return n.text}),e};B.marksFromSchema=function(t){return er(t.marks)};function er(r){var t={};for(var e in r){var n=r[e].spec.toDOM;n&&(t[e]=n)}return t}function Ut(r){return r.document||window.document}var rr=65535,nr=Math.pow(2,16);function rn(r,t){return r+t*nr}function ir(r){return r&rr}function nn(r){return(r-(r&rr))/nr}var Gt=function(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=null),this.pos=t,this.deleted=e,this.recover=n},O=function r(t,e){if(e===void 0&&(e=!1),!t.length&&r.empty)return r.empty;this.ranges=t,this.inverted=e};O.prototype.recover=function(t){var e=0,n=ir(t);if(!this.inverted)for(var i=0;i<n;i++)e+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[n*3]+e+nn(t)};O.prototype.mapResult=function(t,e){return e===void 0&&(e=1),this._map(t,e,!1)};O.prototype.map=function(t,e){return e===void 0&&(e=1),this._map(t,e,!0)};O.prototype._map=function(t,e,n){for(var i=0,o=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var f=this.ranges[s]-(this.inverted?i:0);if(f>t)break;var p=this.ranges[s+o],u=this.ranges[s+a],h=f+p;if(t<=h){var l=p?t==f?-1:t==h?1:e:e,v=f+i+(l<0?0:u);if(n)return v;var g=t==(e<0?f:h)?null:rn(s/3,t-f);return new Gt(v,e<0?t!=f:t!=h,g)}i+=u-p}return n?t+i:new Gt(t+i)};O.prototype.touches=function(t,e){for(var n=0,i=ir(e),o=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var f=this.ranges[s]-(this.inverted?n:0);if(f>t)break;var p=this.ranges[s+o],u=f+p;if(t<=u&&s==i*3)return!0;n+=this.ranges[s+a]-p}return!1};O.prototype.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,i=0,o=0;i<this.ranges.length;i+=3){var a=this.ranges[i],s=a-(this.inverted?o:0),f=a+(this.inverted?0:o),p=this.ranges[i+e],u=this.ranges[i+n];t(s,s+p,f,f+u),o+=u-p}};O.prototype.invert=function(){return new O(this.ranges,!this.inverted)};O.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};O.offset=function(t){return t==0?O.empty:new O(t<0?[0,-t,0]:[0,0,t])};O.empty=new O([]);var I=function(t,e,n,i){this.maps=t||[],this.from=n||0,this.to=i??this.maps.length,this.mirror=e};I.prototype.slice=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=this.maps.length),new I(this.maps,this.mirror,t,e)};I.prototype.copy=function(){return new I(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};I.prototype.appendMap=function(t,e){this.to=this.maps.push(t),e!=null&&this.setMirror(this.maps.length-1,e)};I.prototype.appendMapping=function(t){for(var e=0,n=this.maps.length;e<t.maps.length;e++){var i=t.getMirror(e);this.appendMap(t.maps[e],i!=null&&i<e?n+i:null)}};I.prototype.getMirror=function(t){if(this.mirror){for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}};I.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)};I.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){var i=t.getMirror(e);this.appendMap(t.maps[e].invert(),i!=null&&i>e?n-i-1:null)}};I.prototype.invert=function(){var t=new I;return t.appendMappingInverted(this),t};I.prototype.map=function(t,e){if(e===void 0&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t};I.prototype.mapResult=function(t,e){return e===void 0&&(e=1),this._map(t,e,!1)};I.prototype._map=function(t,e,n){for(var i=!1,o=this.from;o<this.to;o++){var a=this.maps[o],s=a.mapResult(t,e);if(s.recover!=null){var f=this.getMirror(o);if(f!=null&&f>o&&f<this.to){o=f,t=this.maps[f].recover(s.recover);continue}}s.deleted&&(i=!0),t=s.pos}return n?t:new Gt(t,i)};function et(r){var t=Error.call(this,r);return t.__proto__=et.prototype,t}et.prototype=Object.create(Error.prototype);et.prototype.constructor=et;et.prototype.name="TransformError";var b=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new I},Kt={before:{configurable:!0},docChanged:{configurable:!0}};Kt.before.get=function(){return this.docs.length?this.docs[0]:this.doc};b.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new et(e.failed);return this};b.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e};Kt.docChanged.get=function(){return this.steps.length>0};b.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e};Object.defineProperties(b.prototype,Kt);function kt(){throw new Error("Override me")}var Xt=Object.create(null),E=function(){};E.prototype.apply=function(t){return kt()};E.prototype.getMap=function(){return O.empty};E.prototype.invert=function(t){return kt()};E.prototype.map=function(t){return kt()};E.prototype.merge=function(t){return null};E.prototype.toJSON=function(){return kt()};E.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=Xt[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)};E.jsonID=function(t,e){if(t in Xt)throw new RangeError("Duplicate use of step JSON ID "+t);return Xt[t]=e,e.prototype.jsonID=t,e};var R=function(t,e){this.doc=t,this.failed=e};R.ok=function(t){return new R(t,null)};R.fail=function(t){return new R(null,t)};R.fromReplace=function(t,e,n,i){try{return R.ok(t.replace(e,n,i))}catch(o){if(o instanceof D)return R.fail(o.message);throw o}};var U=function(r){function t(e,n,i,o){r.call(this),this.from=e,this.to=n,this.slice=i,this.structure=!!o}return r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t,t.prototype.apply=function(n){return this.structure&&Yt(n,this.from,this.to)?R.fail("Structure replace would overwrite content"):R.fromReplace(n,this.from,this.to,this.slice)},t.prototype.getMap=function(){return new O([this.from,this.to-this.from,this.slice.size])},t.prototype.invert=function(n){return new t(this.from,this.from+this.slice.size,n.slice(this.from,this.to))},t.prototype.map=function(n){var i=n.mapResult(this.from,1),o=n.mapResult(this.to,-1);return i.deleted&&o.deleted?null:new t(i.pos,Math.max(i.pos,o.pos),this.slice)},t.prototype.merge=function(n){if(!(n instanceof t)||n.structure||this.structure)return null;if(this.from+this.slice.size==n.from&&!this.slice.openEnd&&!n.slice.openStart){var i=this.slice.size+n.slice.size==0?d.empty:new d(this.slice.content.append(n.slice.content),this.slice.openStart,n.slice.openEnd);return new t(this.from,this.to+(n.to-n.from),i,this.structure)}else if(n.to==this.from&&!this.slice.openStart&&!n.slice.openEnd){var o=this.slice.size+n.slice.size==0?d.empty:new d(n.slice.content.append(this.slice.content),n.slice.openStart,this.slice.openEnd);return new t(n.from,this.to,o,this.structure)}else return null},t.prototype.toJSON=function(){var n={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(n.slice=this.slice.toJSON()),this.structure&&(n.structure=!0),n},t.fromJSON=function(n,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new t(i.from,i.to,d.fromJSON(n,i.slice),!!i.structure)},t}(E);E.jsonID("replace",U);var rt=function(r){function t(e,n,i,o,a,s,f){r.call(this),this.from=e,this.to=n,this.gapFrom=i,this.gapTo=o,this.slice=a,this.insert=s,this.structure=!!f}return r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t,t.prototype.apply=function(n){if(this.structure&&(Yt(n,this.from,this.gapFrom)||Yt(n,this.gapTo,this.to)))return R.fail("Structure gap-replace would overwrite content");var i=n.slice(this.gapFrom,this.gapTo);if(i.openStart||i.openEnd)return R.fail("Gap is not a flat range");var o=this.slice.insertAt(this.insert,i.content);return o?R.fromReplace(n,this.from,this.to,o):R.fail("Content does not fit in gap")},t.prototype.getMap=function(){return new O([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},t.prototype.invert=function(n){var i=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+i,this.from+this.insert,this.from+this.insert+i,n.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},t.prototype.map=function(n){var i=n.mapResult(this.from,1),o=n.mapResult(this.to,-1),a=n.map(this.gapFrom,-1),s=n.map(this.gapTo,1);return i.deleted&&o.deleted||a<i.pos||s>o.pos?null:new t(i.pos,o.pos,a,s,this.slice,this.insert,this.structure)},t.prototype.toJSON=function(){var n={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(n.slice=this.slice.toJSON()),this.structure&&(n.structure=!0),n},t.fromJSON=function(n,i){if(typeof i.from!="number"||typeof i.to!="number"||typeof i.gapFrom!="number"||typeof i.gapTo!="number"||typeof i.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new t(i.from,i.to,i.gapFrom,i.gapTo,d.fromJSON(n,i.slice),i.insert,!!i.structure)},t}(E);E.jsonID("replaceAround",rt);function Yt(r,t,e){for(var n=r.resolve(t),i=e-t,o=n.depth;i>0&&o>0&&n.indexAfter(o)==n.node(o).childCount;)o--,i--;if(i>0)for(var a=n.node(o).maybeChild(n.indexAfter(o));i>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,i--}return!1}b.prototype.lift=function(r,t){for(var e=r.$from,n=r.$to,i=r.depth,o=e.before(i+1),a=n.after(i+1),s=o,f=a,p=c.empty,u=0,h=i,l=!1;h>t;h--)l||e.index(h)>0?(l=!0,p=c.from(e.node(h).copy(p)),u++):s--;for(var v=c.empty,g=0,x=i,k=!1;x>t;x--)k||n.after(x+1)<n.end(x)?(k=!0,v=c.from(n.node(x).copy(v)),g++):f++;return this.step(new rt(s,f,o,a,new d(p.append(v),u,g),p.size-u,!0))};b.prototype.wrap=function(r,t){for(var e=c.empty,n=t.length-1;n>=0;n--){if(e.size){var i=t[n].type.contentMatch.matchFragment(e);if(!i||!i.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}e=c.from(t[n].type.create(t[n].attrs,e))}var o=r.start,a=r.end;return this.step(new rt(o,a,o,a,new d(e,0,0),t.length,!0))};b.prototype.setBlockType=function(r,t,e,n){var i=this;if(t===void 0&&(t=r),!e.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var o=this.steps.length;return this.doc.nodesBetween(r,t,function(a,s){if(a.isTextblock&&!a.hasMarkup(e,n)&&on(i.doc,i.mapping.slice(o).map(s),e)){i.clearIncompatible(i.mapping.slice(o).map(s,1),e);var f=i.mapping.slice(o),p=f.map(s,1),u=f.map(s+a.nodeSize,1);return i.step(new rt(p,u,p+1,u-1,new d(c.from(e.create(n,null,a.marks)),0,0),1,!0)),!1}}),this};function on(r,t,e){var n=r.resolve(t),i=n.index();return n.parent.canReplaceWith(i,i+1,e)}b.prototype.setNodeMarkup=function(r,t,e,n){var i=this.doc.nodeAt(r);if(!i)throw new RangeError("No node at given position");t||(t=i.type);var o=t.create(e,null,n||i.marks);if(i.isLeaf)return this.replaceWith(r,r+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);return this.step(new rt(r,r+i.nodeSize,r+1,r+i.nodeSize-1,new d(c.from(o),0,0),1,!0))};b.prototype.split=function(r,t,e){t===void 0&&(t=1);for(var n=this.doc.resolve(r),i=c.empty,o=c.empty,a=n.depth,s=n.depth-t,f=t-1;a>s;a--,f--){i=c.from(n.node(a).copy(i));var p=e&&e[f];o=c.from(p?p.type.create(p.attrs,o):n.node(a).copy(o))}return this.step(new U(r,r,new d(i.append(o),t,t),!0))};b.prototype.join=function(r,t){t===void 0&&(t=1);var e=new U(r-t,r+t,d.empty,!0);return this.step(e)};function an(r,t,e){var n=r.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),e))return t;if(n.parentOffset==0)for(var i=n.depth-1;i>=0;i--){var o=n.index(i);if(n.node(i).canReplaceWith(o,o,e))return n.before(i+1);if(o>0)return null}if(n.parentOffset==n.parent.content.size)for(var a=n.depth-1;a>=0;a--){var s=n.indexAfter(a);if(n.node(a).canReplaceWith(s,s,e))return n.after(a+1);if(s<n.node(a).childCount)return null}}function $t(r,t,e){for(var n=[],i=0;i<r.childCount;i++){var o=r.child(i);o.content.size&&(o=o.copy($t(o.content,t,o))),o.isInline&&(o=t(o,e,i)),n.push(o)}return c.fromArray(n)}var te=function(r){function t(e,n,i){r.call(this),this.from=e,this.to=n,this.mark=i}return r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t,t.prototype.apply=function(n){var i=this,o=n.slice(this.from,this.to),a=n.resolve(this.from),s=a.node(a.sharedDepth(this.to)),f=new d($t(o.content,function(p,u){return!p.isAtom||!u.type.allowsMarkType(i.mark.type)?p:p.mark(i.mark.addToSet(p.marks))},s),o.openStart,o.openEnd);return R.fromReplace(n,this.from,this.to,f)},t.prototype.invert=function(){return new ft(this.from,this.to,this.mark)},t.prototype.map=function(n){var i=n.mapResult(this.from,1),o=n.mapResult(this.to,-1);return i.deleted&&o.deleted||i.pos>=o.pos?null:new t(i.pos,o.pos,this.mark)},t.prototype.merge=function(n){if(n instanceof t&&n.mark.eq(this.mark)&&this.from<=n.to&&this.to>=n.from)return new t(Math.min(this.from,n.from),Math.max(this.to,n.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(n,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new t(i.from,i.to,n.markFromJSON(i.mark))},t}(E);E.jsonID("addMark",te);var ft=function(r){function t(e,n,i){r.call(this),this.from=e,this.to=n,this.mark=i}return r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t,t.prototype.apply=function(n){var i=this,o=n.slice(this.from,this.to),a=new d($t(o.content,function(s){return s.mark(i.mark.removeFromSet(s.marks))}),o.openStart,o.openEnd);return R.fromReplace(n,this.from,this.to,a)},t.prototype.invert=function(){return new te(this.from,this.to,this.mark)},t.prototype.map=function(n){var i=n.mapResult(this.from,1),o=n.mapResult(this.to,-1);return i.deleted&&o.deleted||i.pos>=o.pos?null:new t(i.pos,o.pos,this.mark)},t.prototype.merge=function(n){if(n instanceof t&&n.mark.eq(this.mark)&&this.from<=n.to&&this.to>=n.from)return new t(Math.min(this.from,n.from),Math.max(this.to,n.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(n,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new t(i.from,i.to,n.markFromJSON(i.mark))},t}(E);E.jsonID("removeMark",ft);b.prototype.addMark=function(r,t,e){var n=this,i=[],o=[],a=null,s=null;return this.doc.nodesBetween(r,t,function(f,p,u){if(!!f.isInline){var h=f.marks;if(!e.isInSet(h)&&u.type.allowsMarkType(e.type)){for(var l=Math.max(p,r),v=Math.min(p+f.nodeSize,t),g=e.addToSet(h),x=0;x<h.length;x++)h[x].isInSet(g)||(a&&a.to==l&&a.mark.eq(h[x])?a.to=v:i.push(a=new ft(l,v,h[x])));s&&s.to==l?s.to=v:o.push(s=new te(l,v,e))}}}),i.forEach(function(f){return n.step(f)}),o.forEach(function(f){return n.step(f)}),this};b.prototype.removeMark=function(r,t,e){var n=this;e===void 0&&(e=null);var i=[],o=0;return this.doc.nodesBetween(r,t,function(a,s){if(!!a.isInline){o++;var f=null;if(e instanceof W)for(var p=a.marks,u;u=e.isInSet(p);)(f||(f=[])).push(u),p=u.removeFromSet(p);else e?e.isInSet(a.marks)&&(f=[e]):f=a.marks;if(f&&f.length)for(var h=Math.min(s+a.nodeSize,t),l=0;l<f.length;l++){for(var v=f[l],g=void 0,x=0;x<i.length;x++){var k=i[x];k.step==o-1&&v.eq(i[x].style)&&(g=k)}g?(g.to=h,g.step=o):i.push({style:v,from:Math.max(s,r),to:h,step:o})}}}),i.forEach(function(a){return n.step(new ft(a.from,a.to,a.style))}),this};b.prototype.clearIncompatible=function(r,t,e){e===void 0&&(e=t.contentMatch);for(var n=this.doc.nodeAt(r),i=[],o=r+1,a=0;a<n.childCount;a++){var s=n.child(a),f=o+s.nodeSize,p=e.matchType(s.type,s.attrs);if(!p)i.push(new U(o,f,d.empty));else{e=p;for(var u=0;u<s.marks.length;u++)t.allowsMarkType(s.marks[u].type)||this.step(new ft(o,f,s.marks[u]))}o=f}if(!e.validEnd){var h=e.fillBefore(c.empty,!0);this.replace(o,o,new d(h,0,0))}for(var l=i.length-1;l>=0;l--)this.step(i[l]);return this};function sn(r,t,e,n){if(e===void 0&&(e=t),n===void 0&&(n=d.empty),t==e&&!n.size)return null;var i=r.resolve(t),o=r.resolve(e);return or(i,o,n)?new U(t,e,n):new _(i,o,n).fit()}b.prototype.replace=function(r,t,e){t===void 0&&(t=r),e===void 0&&(e=d.empty);var n=sn(this.doc,r,t,e);return n&&this.step(n),this};b.prototype.replaceWith=function(r,t,e){return this.replace(r,t,new d(c.from(e),0,0))};b.prototype.delete=function(r,t){return this.replace(r,t,d.empty)};b.prototype.insert=function(r,t){return this.replaceWith(r,r,t)};function or(r,t,e){return!e.openStart&&!e.openEnd&&r.start()==t.start()&&r.parent.canReplace(r.index(),t.index(),e.content)}var _=function(t,e,n){this.$to=e,this.$from=t,this.unplaced=n,this.frontier=[];for(var i=0;i<=t.depth;i++){var o=t.node(i);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(i))})}this.placed=c.empty;for(var a=t.depth;a>0;a--)this.placed=c.from(t.node(a).copy(this.placed))},ar={depth:{configurable:!0}};ar.depth.get=function(){return this.frontier.length-1};_.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,i=this.$from,o=this.close(e<0?this.$to:i.doc.resolve(e));if(!o)return null;for(var a=this.placed,s=i.depth,f=o.depth;s&&f&&a.childCount==1;)a=a.firstChild.content,s--,f--;var p=new d(a,s,f);if(e>-1)return new rt(i.pos,e,this.$to.pos,this.$to.end(),p,n);if(p.size||i.pos!=this.$to.pos)return new U(i.pos,o.pos,p)};_.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--){var n=void 0,i=void 0;e?(i=ee(this.unplaced.content,e-1).firstChild,n=i.content):n=this.unplaced.content;for(var o=n.firstChild,a=this.depth;a>=0;a--){var s=this.frontier[a],f=s.type,p=s.match,u=void 0,h=void 0;if(t==1&&(o?p.matchType(o.type)||(h=p.fillBefore(c.from(o),!1)):f.compatibleContent(i.type)))return{sliceDepth:e,frontierDepth:a,parent:i,inject:h};if(t==2&&o&&(u=p.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:a,parent:i,wrap:u};if(i&&p.matchType(i.type))break}}};_.prototype.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,i=t.openEnd,o=ee(e,n);return!o.childCount||o.firstChild.isLeaf?!1:(this.unplaced=new d(e,n+1,Math.max(i,o.size+n>=e.size-i?n+1:0)),!0)};_.prototype.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,i=t.openEnd,o=ee(e,n);if(o.childCount<=1&&n>0){var a=e.size-n<=n+o.size;this.unplaced=new d(st(e,n-1,1),n-1,a?n-1:i)}else this.unplaced=new d(st(e,n,1),n,i)};_.prototype.placeNodes=function(t){for(var e=t.sliceDepth,n=t.frontierDepth,i=t.parent,o=t.inject,a=t.wrap;this.depth>n;)this.closeFrontierNode();if(a)for(var s=0;s<a.length;s++)this.openFrontierNode(a[s]);var f=this.unplaced,p=i?i.content:f.content,u=f.openStart-e,h=0,l=[],v=this.frontier[n],g=v.match,x=v.type;if(o){for(var k=0;k<o.childCount;k++)l.push(o.child(k));g=g.matchFragment(o)}for(var P=p.size+e-(f.content.size-f.openEnd);h<p.childCount;){var L=p.child(h),G=g.matchType(L.type);if(!G)break;h++,(h>1||u==0||L.content.size)&&(g=G,l.push(sr(L.mark(x.allowedMarks(L.marks)),h==1?u:0,h==p.childCount?P:-1)))}var V=h==p.childCount;V||(P=-1),this.placed=pt(this.placed,n,c.from(l)),this.frontier[n].match=g,V&&P<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var X=0,Y=p;X<P;X++){var F=Y.lastChild;this.frontier.push({type:F.type,match:F.contentMatchAt(F.childCount)}),Y=F.content}this.unplaced=V?e==0?d.empty:new d(st(f.content,e-1,1),e-1,P<0?f.openEnd:e-1):new d(st(f.content,e,h),f.openStart,f.openEnd)};_.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock)return-1;var t=this.frontier[this.depth],e;if(!t.type.isTextblock||!Qt(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;for(var n=this.$to,i=n.depth,o=this.$to.after(i);i>1&&o==this.$to.end(--i);)++o;return o};_.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],i=n.match,o=n.type,a=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=Qt(t,e,o,i,a);if(!!s){for(var f=e-1;f>=0;f--){var p=this.frontier[f],u=p.match,h=p.type,l=Qt(t,f,h,u,!0);if(!l||l.childCount)continue t}return{depth:e,fit:s,move:a?t.doc.resolve(t.after(e+1)):t}}}};_.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=pt(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var i=t.node(n),o=i.type.contentMatch.fillBefore(i.content,!0,t.index(n));this.openFrontierNode(i.type,i.attrs,o)}return t};_.prototype.openFrontierNode=function(t,e,n){var i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=pt(this.placed,this.depth,c.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})};_.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),e=t.match.fillBefore(c.empty,!0);e.childCount&&(this.placed=pt(this.placed,this.frontier.length,e))};Object.defineProperties(_.prototype,ar);function st(r,t,e){return t==0?r.cutByIndex(e):r.replaceChild(0,r.firstChild.copy(st(r.firstChild.content,t-1,e)))}function pt(r,t,e){return t==0?r.append(e):r.replaceChild(r.childCount-1,r.lastChild.copy(pt(r.lastChild.content,t-1,e)))}function ee(r,t){for(var e=0;e<t;e++)r=r.firstChild.content;return r}function sr(r,t,e){if(t<=0)return r;var n=r.content;return t>1&&(n=n.replaceChild(0,sr(n.firstChild,t-1,n.childCount==1?e-1:0))),t>0&&(n=r.type.contentMatch.fillBefore(n).append(n),e<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(c.empty,!0)))),r.copy(n)}function Qt(r,t,e,n,i){var o=r.node(t),a=i?r.indexAfter(t):r.index(t);if(a==o.childCount&&!e.compatibleContent(o.type))return null;var s=n.fillBefore(o.content,!0,a);return s&&!fn(e,o.content,a)?s:null}function fn(r,t,e){for(var n=e;n<t.childCount;n++)if(!r.allowsMarks(t.child(n).marks))return!0;return!1}function pn(r){return r.spec.defining||r.spec.definingForContent}b.prototype.replaceRange=function(r,t,e){if(!e.size)return this.deleteRange(r,t);var n=this.doc.resolve(r),i=this.doc.resolve(t);if(or(n,i,e))return this.step(new U(r,t,e));var o=pr(n,this.doc.resolve(t));o[o.length-1]==0&&o.pop();var a=-(n.depth+1);o.unshift(a);for(var s=n.depth,f=n.pos-1;s>0;s--,f--){var p=n.node(s).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(s)>-1?a=s:n.before(s)==f&&o.splice(1,0,-s)}for(var u=o.indexOf(a),h=[],l=e.openStart,v=e.content,g=0;;g++){var x=v.firstChild;if(h.push(x),g==e.openStart)break;v=x.content}for(var k=l-1;k>=0;k--){var P=h[k].type,L=pn(P);if(L&&n.node(u).type!=P)l=k;else if(L||!P.isTextblock)break}for(var G=e.openStart;G>=0;G--){var V=(G+l+1)%(e.openStart+1),X=h[V];if(!!X)for(var Y=0;Y<o.length;Y++){var F=o[(Y+u)%o.length],ie=!0;F<0&&(ie=!1,F=-F);var xr=n.node(F-1),oe=n.index(F-1);if(xr.canReplaceWith(oe,oe,X.type,X.marks))return this.replace(n.before(F),ie?i.after(F):t,new d(fr(e.content,0,e.openStart,V),V,e.openEnd))}}for(var Sr=this.steps.length,Et=o.length-1;Et>=0&&(this.replace(r,t,e),!(this.steps.length>Sr));Et--){var Nt=o[Et];Nt<0||(r=n.before(Nt),t=i.after(Nt))}return this};function fr(r,t,e,n,i){if(t<e){var o=r.firstChild;r=r.replaceChild(0,o.copy(fr(o.content,t+1,e,n,o)))}if(t>n){var a=i.contentMatchAt(0),s=a.fillBefore(r).append(r);r=s.append(a.matchFragment(s).fillBefore(c.empty,!0))}return r}b.prototype.replaceRangeWith=function(r,t,e){if(!e.isInline&&r==t&&this.doc.resolve(r).parent.content.size){var n=an(this.doc,r,e.type);n!=null&&(r=t=n)}return this.replaceRange(r,t,new d(c.from(e),0,0))};b.prototype.deleteRange=function(r,t){for(var e=this.doc.resolve(r),n=this.doc.resolve(t),i=pr(e,n),o=0;o<i.length;o++){var a=i[o],s=o==i.length-1;if(s&&a==0||e.node(a).type.contentMatch.validEnd)return this.delete(e.start(a),n.end(a));if(a>0&&(s||e.node(a-1).canReplace(e.index(a-1),n.indexAfter(a-1))))return this.delete(e.before(a),n.after(a))}for(var f=1;f<=e.depth&&f<=n.depth;f++)if(r-e.start(f)==e.depth-f&&t>e.end(f)&&n.end(f)-t!=n.depth-f)return this.delete(e.before(f),t);return this.delete(r,t)};function pr(r,t){for(var e=[],n=Math.min(r.depth,t.depth),i=n;i>=0;i--){var o=r.start(i);if(o<r.pos-(r.depth-i)||t.end(i)>t.pos+(t.depth-i)||r.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(o==t.start(i)||i==r.depth&&i==t.depth&&r.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==o-1)&&e.push(i)}return e}function ut(r){return{type:"doc",content:r}}function Ct(r){return{type:"mention",attrs:{variable:{id:r}}}}function Ot(r){return{type:"paragraph",content:r}}function un(r){return ut([Ot([Ct(r)])])}function re(r){let t=r===""?void 0:[Mt(r)];return ut([{type:"paragraph",...t?{content:t}:void 0}])}function Mt(r){return{type:"text",text:r}}function cn(r,t){if(r==null)return re(t);let e=J.nodeFromJSON(r),n=J.text(t),i=e.firstChild;return new b(i).insert(i.content.size,n).doc.toJSON()}function nt(r,t){return r.type==="mention"?t(r):r.content!=null?{...r,content:r.content.flatMap(e=>nt(e,t))}:r}function hn(r,t){let e=J.nodeFromJSON(r),n=J.text(t),i=e.firstChild;return new b(i).insert(0,n).doc.toJSON()}function ln(r,t){return r==null?null:nt(r,e=>{let n=e.attrs.variable.id,i=t.find(o=>o.id===n);return[{...e,attrs:{variable:i}}]})}var ne=require("@tiptap/core");function dn(r,t=!1){let e=`

`,n=J.nodeFromJSON(r),i=ur(J);return t?(0,ne.getText)(n,{blockSeparator:e,textSerializers:i}):(0,ne.getText)(n,{blockSeparator:e,textSerializers:{...i,mention:o=>o.node.attrs.value==null?"":i.mention(o)}})}function ur(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}var cr=require("@tiptap/html");function vn(r){return(0,cr.generateHTML)(r,dt)}function mn(r){return r==null?null:nt(r,t=>[{...t,attrs:{variable:{id:t.attrs.variable.id}}}])}function yn(r){let t=r.split(/({{\w+}})/g).filter(e=>e!=="").map(e=>/^{{\w+}}$/.test(e)?Ct(e.slice(2,-2)):Mt(e));return ut([Ot(t)])}function gn(r){return`${r.slice(0,1).toUpperCase()}${r.slice(1)}`}var hr="ROLLOUTHQ_VARIABLE_";function xn(r){return r!=null&&r.startsWith(hr)}function Sn(r){return t=>lr(r,t)}function lr(r,t){return r.safeParse(t).success}var z=require("zod");var dr=require("zod");var it=dr.z.object({}).passthrough().refine(r=>{try{return J.nodeFromJSON(r),!0}catch{return!1}},{message:"Object is not valid RichEditorContent"}).transform(r=>r),vr=Symbol("IS_Z_RICH_EDITOR_CONTENT");Object.assign(it._def,{[vr]:!0});function wn(r){return vr in r._def}var mr=require("ts-assert-unreachable"),Tt=require("zod");function yr(r){return Tt.z.object(Object.fromEntries(r.map(t=>{if(t.type==="plainText")return[t.key,Tt.z.string()];if(t.type==="dropdown")return[t.key,Tt.z.string()];if(t.type==="string")return[t.key,it];(0,mr.unreachableCase)(t.type)})))}var bn={literal:z.literal,boolean:z.boolean,object:z.object,record:z.record,string:z.string,richEditorContent:it,union:z.union};function gr(r){return r instanceof z.ZodOptional?gr(r.unwrap()):r}0&&(module.exports={AnyBlockDocument,CURLY_BRACKETS_SYMBOL,CurlyBrackets,EnterHandler,EscHandler,FORMATTING_EXTENSIONS,Link,MENTION_SYMBOL,Mention,ROLLOUTHQ_VARIABLE_PREFIX,SCHEMA_EXTENSIONS,ShiftEnterHandler,SingleParagraphDocument,appendText,capitalize,createDocument,createDocumentWithMention,createMention,createParagraph,curlyBracketsConfig,curlyTemplate,flatMapMentions,getCurlyBracketsSuggestions,getSuggestions,getTextSeralizersFromSchema,inputDefToZodObject,isVariable,isZRichEditorContent,mentionConfig,passesValidation,plainToRichText,prependText,resolveMentions,richTextToPlain,schema,toHTML,toTextNode,unresolveMentions,unwrapOptional,z,zRichEditorContent,zodGuard});
//# sourceMappingURL=index.cjs.js.map