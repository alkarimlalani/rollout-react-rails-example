import{Extension as _e}from"@tiptap/core";var nn=_e.create({name:"EnterHandler",addKeyboardShortcuts(){return{Enter:n=>this.options.handler(n)??!1}}});import{Extension as Pe}from"@tiptap/core";var fn=Pe.create({name:"EscHandler",addKeyboardShortcuts(){return{Escape:n=>this.options.handler(n)??!1}}});import Ht from"@tiptap/extension-link";var Vt=Ht.extend({addOptions(){return{...Ht.options,openOnClick:!1}}});import{Node as De,mergeAttributes as Le}from"@tiptap/core";var Zt="@",qe={name:"mention",priority:110,group:"inline",inline:!0,selectable:!1,atom:!0,addCommands(){return{insertMentionSymbol:()=>({chain:n})=>n().insertContent(Zt).focus().run()}},addStorage(){var n;return{variables:((n=this.options)==null?void 0:n.variables)??null,setVariables(t){this.variables=t},menuContainer:null}},addAttributes(){return{variable:{default:null,parseHTML:n=>({id:n.getAttribute("data-variable-id"),label:n.getAttribute("data-variable-label"),type:n.getAttribute("data-variable-type")}),renderHTML:n=>n.variable?{"data-variable-id":n.variable.id,"data-variable-label":n.variable.label,"data-variable-type":n.variable.type}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:n,HTMLAttributes:t}){var e;return["span",Le({"data-type":this.name},t),`${(e=n.attrs.variable)==null?void 0:e.label}`]},renderText({node:n}){let t=n.attrs.variable;return`${t.label??t.id}`},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:n,state:t})=>{let e=!1,{selection:r}=t,{empty:i,anchor:o}=r;return i?(t.doc.nodesBetween(o-1,o,(a,s)=>{if(a.type.name===this.name)return e=!0,n.insertText(Zt,s,s+a.nodeSize),!1}),e):!1})}}},jt=De.create(qe);import{matchSorter as Ut}from"match-sorter";function We(n,t){return Ut(n,t,{keys:[e=>e.label],threshold:Ut.rankings.ACRONYM})}function mn(n,t){let e=n.storage.mention,{variables:r}=e;return r?We(r,t):[]}import{Node as He,mergeAttributes as Ve}from"@tiptap/core";var Gt="{{",Ze={name:"curly-brackets",priority:110,group:"inline",inline:!0,selectable:!1,atom:!0,addCommands(){return{insertCurlyBracketsSymbol:()=>({chain:n})=>n().insertContent(Gt).focus().run()}},addStorage(){var n;return{variables:((n=this.options)==null?void 0:n.variables)??null,setVariables(t){this.variables=t},menuContainer:null}},addAttributes(){return{variable:{default:null,parseHTML:n=>({id:n.getAttribute("data-variable-id"),label:n.getAttribute("data-variable-label")}),renderHTML:n=>n.variable?{"data-variable-id":n.variable.id,"data-variable-label":n.variable.label}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:n,HTMLAttributes:t}){var e;return["span",Ve({"data-type":this.name},t),`${(e=n.attrs.variable)==null?void 0:e.label}`]},renderText({node:n}){let t=n.attrs.variable;return`${t.label??t.id}`},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:n,state:t})=>{let e=!1,{selection:r}=t,{empty:i,anchor:o}=r;return i?(t.doc.nodesBetween(o-1,o,(a,s)=>{if(a.type.name===this.name)return e=!0,n.insertText(Gt,s,s+a.nodeSize),!1}),e):!1})}}},Xt=He.create(Ze);import{matchSorter as Yt}from"match-sorter";function je(n,t){return Yt(n,t,{keys:[e=>e.label],threshold:Yt.rankings.ACRONYM})}function bn(n,t){let e=n.storage["curly-brackets"],{variables:r}=e;return r?je(r,t):[]}import{Extension as Ue}from"@tiptap/core";var Mn=Ue.create({name:"ShiftEnterHandler",addKeyboardShortcuts(){return{"Shift-Enter":n=>this.options.handler(n)??!1}}});import Ge from"@tiptap/extension-blockquote";import Xe from"@tiptap/extension-bold";import Ye from"@tiptap/extension-bullet-list";import Qe from"@tiptap/extension-code";import Ke from"@tiptap/extension-code-block";import $e from"@tiptap/extension-gapcursor";import tr from"@tiptap/extension-hard-break";import er from"@tiptap/extension-heading";import rr from"@tiptap/extension-horizontal-rule";import nr from"@tiptap/extension-italic";import ir from"@tiptap/extension-list-item";import or from"@tiptap/extension-ordered-list";import ar from"@tiptap/extension-strike";import sr from"@tiptap/extension-underline";var Qt=[Ge,Xe,Ye,Qe,Ke,$e,tr,er,rr,nr,ir,or,ar,sr];import{Node as fr}from"@tiptap/core";var Kt=fr.create({name:"doc",topNode:!0,content:"block+"});import{Node as pr}from"@tiptap/core";var jn=pr.create({name:"doc",topNode:!0,content:"paragraph"});import{getSchema as ur}from"@tiptap/core";import cr from"@tiptap/extension-paragraph";import hr from"@tiptap/extension-text";var St=[Kt,Vt,jt,cr,hr,Xt,...Qt],B=ur(St);function O(n){this.content=n}O.prototype={constructor:O,find:function(n){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===n)return t;return-1},get:function(n){var t=this.find(n);return t==-1?void 0:this.content[t+1]},update:function(n,t,e){var r=e&&e!=n?this.remove(e):this,i=r.find(n),o=r.content.slice();return i==-1?o.push(e||n,t):(o[i+1]=t,e&&(o[i]=e)),new O(o)},remove:function(n){var t=this.find(n);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new O(e)},addToStart:function(n,t){return new O([n,t].concat(this.remove(n).content))},addToEnd:function(n,t){var e=this.remove(n).content.slice();return e.push(n,t),new O(e)},addBefore:function(n,t,e){var r=this.remove(t),i=r.content.slice(),o=r.find(n);return i.splice(o==-1?i.length:o,0,t,e),new O(i)},forEach:function(n){for(var t=0;t<this.content.length;t+=2)n(this.content[t],this.content[t+1])},prepend:function(n){return n=O.from(n),n.size?new O(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=O.from(n),n.size?new O(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var t=this;n=O.from(n);for(var e=0;e<n.content.length;e+=2)t=t.remove(n.content[e]);return t},get size(){return this.content.length>>1}};O.from=function(n){if(n instanceof O)return n;var t=[];if(n)for(var e in n)t.push(e,n[e]);return new O(t)};var lr=O,wt=lr;function ne(n,t,e){for(var r=0;;r++){if(r==n.childCount||r==t.childCount)return n.childCount==t.childCount?null:e;var i=n.child(r),o=t.child(r);if(i==o){e+=i.nodeSize;continue}if(!i.sameMarkup(o))return e;if(i.isText&&i.text!=o.text){for(var a=0;i.text[a]==o.text[a];a++)e++;return e}if(i.content.size||o.content.size){var s=ne(i.content,o.content,e+1);if(s!=null)return s}e+=i.nodeSize}}function ie(n,t,e,r){for(var i=n.childCount,o=t.childCount;;){if(i==0||o==0)return i==o?null:{a:e,b:r};var a=n.child(--i),s=t.child(--o),f=a.nodeSize;if(a==s){e-=f,r-=f;continue}if(!a.sameMarkup(s))return{a:e,b:r};if(a.isText&&a.text!=s.text){for(var p=0,u=Math.min(a.text.length,s.text.length);p<u&&a.text[a.text.length-p-1]==s.text[s.text.length-p-1];)p++,e--,r--;return{a:e,b:r}}if(a.content.size||s.content.size){var h=ie(a.content,s.content,e-1,r-1);if(h)return h}e-=f,r-=f}}var c=function(t,e){if(this.content=t,this.size=e||0,e==null)for(var r=0;r<t.length;r++)this.size+=t[r].nodeSize},lt={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};c.prototype.nodesBetween=function(t,e,r,i,o){i===void 0&&(i=0);for(var a=0,s=0;s<e;a++){var f=this.content[a],p=s+f.nodeSize;if(p>t&&r(f,i+s,o,a)!==!1&&f.content.size){var u=s+1;f.nodesBetween(Math.max(0,t-u),Math.min(f.content.size,e-u),r,i+u)}s=p}};c.prototype.descendants=function(t){this.nodesBetween(0,this.size,t)};c.prototype.textBetween=function(t,e,r,i){var o="",a=!0;return this.nodesBetween(t,e,function(s,f){s.isText?(o+=s.text.slice(Math.max(t,f)-f,e-f),a=!r):s.isLeaf&&i?(o+=typeof i=="function"?i(s):i,a=!r):!a&&s.isBlock&&(o+=r,a=!0)},0),o};c.prototype.append=function(t){if(!t.size)return this;if(!this.size)return t;var e=this.lastChild,r=t.firstChild,i=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(r)&&(i[i.length-1]=e.withText(e.text+r.text),o=1);o<t.content.length;o++)i.push(t.content[o]);return new c(i,this.size+t.size)};c.prototype.cut=function(t,e){if(e==null&&(e=this.size),t==0&&e==this.size)return this;var r=[],i=0;if(e>t)for(var o=0,a=0;a<e;o++){var s=this.content[o],f=a+s.nodeSize;f>t&&((a<t||f>e)&&(s.isText?s=s.cut(Math.max(0,t-a),Math.min(s.text.length,e-a)):s=s.cut(Math.max(0,t-a-1),Math.min(s.content.size,e-a-1))),r.push(s),i+=s.nodeSize),a=f}return new c(r,i)};c.prototype.cutByIndex=function(t,e){return t==e?c.empty:t==0&&e==this.content.length?this:new c(this.content.slice(t,e))};c.prototype.replaceChild=function(t,e){var r=this.content[t];if(r==e)return this;var i=this.content.slice(),o=this.size+e.nodeSize-r.nodeSize;return i[t]=e,new c(i,o)};c.prototype.addToStart=function(t){return new c([t].concat(this.content),this.size+t.nodeSize)};c.prototype.addToEnd=function(t){return new c(this.content.concat(t),this.size+t.nodeSize)};c.prototype.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0};lt.firstChild.get=function(){return this.content.length?this.content[0]:null};lt.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};lt.childCount.get=function(){return this.content.length};c.prototype.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e};c.prototype.maybeChild=function(t){return this.content[t]};c.prototype.forEach=function(t){for(var e=0,r=0;e<this.content.length;e++){var i=this.content[e];t(i,r,e),r+=i.nodeSize}};c.prototype.findDiffStart=function(t,e){return e===void 0&&(e=0),ne(this,t,e)};c.prototype.findDiffEnd=function(t,e,r){return e===void 0&&(e=this.size),r===void 0&&(r=t.size),ie(this,t,e,r)};c.prototype.findIndex=function(t,e){if(e===void 0&&(e=-1),t==0)return ft(0,t);if(t==this.size)return ft(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var r=0,i=0;;r++){var o=this.child(r),a=i+o.nodeSize;if(a>=t)return a==t||e>0?ft(r+1,a):ft(r,i);i=a}};c.prototype.toString=function(){return"<"+this.toStringInner()+">"};c.prototype.toStringInner=function(){return this.content.join(", ")};c.prototype.toJSON=function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null};c.fromJSON=function(t,e){if(!e)return c.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new c(e.map(t.nodeFromJSON))};c.fromArray=function(t){if(!t.length)return c.empty;for(var e,r=0,i=0;i<t.length;i++){var o=t[i];r+=o.nodeSize,i&&o.isText&&t[i-1].sameMarkup(o)?(e||(e=t.slice(0,i)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new c(e||t,r)};c.from=function(t){if(!t)return c.empty;if(t instanceof c)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new c([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(c.prototype,lt);var bt={index:0,offset:0};function ft(n,t){return bt.index=n,bt.offset=t,bt}c.empty=new c([],0);function pt(n,t){if(n===t)return!0;if(!(n&&typeof n=="object")||!(t&&typeof t=="object"))return!1;var e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(var r=0;r<n.length;r++)if(!pt(n[r],t[r]))return!1}else{for(var i in n)if(!(i in t)||!pt(n[i],t[i]))return!1;for(var o in t)if(!(o in n))return!1}return!0}var y=function(t,e){this.type=t,this.attrs=e};y.prototype.addToSet=function(t){for(var e,r=!1,i=0;i<t.length;i++){var o=t[i];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,i));else{if(o.type.excludes(this.type))return t;!r&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,i)),e.push(this),r=!0),e&&e.push(o)}}return e||(e=t.slice()),r||e.push(this),e};y.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t};y.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1};y.prototype.eq=function(t){return this==t||this.type==t.type&&pt(this.attrs,t.attrs)};y.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t};y.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var r=t.marks[e.type];if(!r)throw new RangeError("There is no mark type "+e.type+" in this schema");return r.create(e.attrs)};y.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!t[r].eq(e[r]))return!1;return!0};y.setFrom=function(t){if(!t||t.length==0)return y.none;if(t instanceof y)return[t];var e=t.slice();return e.sort(function(r,i){return r.type.rank-i.type.rank}),e};y.none=[];function _(n){var t=Error.call(this,n);return t.__proto__=_.prototype,t}_.prototype=Object.create(Error.prototype);_.prototype.constructor=_;_.prototype.name="ReplaceError";var d=function(t,e,r){this.content=t,this.openStart=e,this.openEnd=r},oe={size:{configurable:!0}};oe.size.get=function(){return this.content.size-this.openStart-this.openEnd};d.prototype.insertAt=function(t,e){var r=se(this.content,t+this.openStart,e,null);return r&&new d(r,this.openStart,this.openEnd)};d.prototype.removeBetween=function(t,e){return new d(ae(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)};d.prototype.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd};d.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};d.prototype.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t};d.fromJSON=function(t,e){if(!e)return d.empty;var r=e.openStart||0,i=e.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new d(c.fromJSON(t,e.content),r,i)};d.maxOpen=function(t,e){e===void 0&&(e=!0);for(var r=0,i=0,o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)r++;for(var a=t.lastChild;a&&!a.isLeaf&&(e||!a.type.spec.isolating);a=a.lastChild)i++;return new d(t,r,i)};Object.defineProperties(d.prototype,oe);function ae(n,t,e){var r=n.findIndex(t),i=r.index,o=r.offset,a=n.maybeChild(i),s=n.findIndex(e),f=s.index,p=s.offset;if(o==t||a.isText){if(p!=e&&!n.child(f).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(i!=f)throw new RangeError("Removing non-flat range");return n.replaceChild(i,a.copy(ae(a.content,t-o-1,e-o-1)))}function se(n,t,e,r){var i=n.findIndex(t),o=i.index,a=i.offset,s=n.maybeChild(o);if(a==t||s.isText)return r&&!r.canReplace(o,o,e)?null:n.cut(0,t).append(e).append(n.cut(t));var f=se(s.content,t-a-1,e);return f&&n.replaceChild(o,s.copy(f))}d.empty=new d(c.empty,0,0);function dr(n,t,e){if(e.openStart>n.depth)throw new _("Inserted content deeper than insertion position");if(n.depth-e.openStart!=t.depth-e.openEnd)throw new _("Inconsistent open depths");return fe(n,t,e,0)}function fe(n,t,e,r){var i=n.index(r),o=n.node(r);if(i==t.index(r)&&r<n.depth-e.openStart){var a=fe(n,t,e,r+1);return o.copy(o.content.replaceChild(i,a))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&n.depth==r&&t.depth==r){var s=n.parent,f=s.content;return V(s,f.cut(0,n.parentOffset).append(e.content).append(f.cut(t.parentOffset)))}else{var p=vr(e,n),u=p.start,h=p.end;return V(o,ue(n,u,h,t,r))}else return V(o,ut(n,t,r))}function pe(n,t){if(!t.type.compatibleContent(n.type))throw new _("Cannot join "+t.type.name+" onto "+n.type.name)}function Ot(n,t,e){var r=n.node(e);return pe(r,t.node(e)),r}function H(n,t){var e=t.length-1;e>=0&&n.isText&&n.sameMarkup(t[e])?t[e]=n.withText(t[e].text+n.text):t.push(n)}function et(n,t,e,r){var i=(t||n).node(e),o=0,a=t?t.index(e):i.childCount;n&&(o=n.index(e),n.depth>e?o++:n.textOffset&&(H(n.nodeAfter,r),o++));for(var s=o;s<a;s++)H(i.child(s),r);t&&t.depth==e&&t.textOffset&&H(t.nodeBefore,r)}function V(n,t){if(!n.type.validContent(t))throw new _("Invalid content for node "+n.type.name);return n.copy(t)}function ue(n,t,e,r,i){var o=n.depth>i&&Ot(n,t,i+1),a=r.depth>i&&Ot(e,r,i+1),s=[];return et(null,n,i,s),o&&a&&t.index(i)==e.index(i)?(pe(o,a),H(V(o,ue(n,t,e,r,i+1)),s)):(o&&H(V(o,ut(n,t,i+1)),s),et(t,e,i,s),a&&H(V(a,ut(e,r,i+1)),s)),et(r,null,i,s),new c(s)}function ut(n,t,e){var r=[];if(et(null,n,e,r),n.depth>e){var i=Ot(n,t,e+1);H(V(i,ut(n,t,e+1)),r)}return et(t,null,e,r),new c(r)}function vr(n,t){for(var e=t.depth-n.openStart,r=t.node(e),i=r.copy(n.content),o=e-1;o>=0;o--)i=t.node(o).copy(c.from(i));return{start:i.resolveNoCache(n.openStart+e),end:i.resolveNoCache(i.content.size-n.openEnd-e)}}var w=function(t,e,r){this.pos=t,this.path=e,this.depth=e.length/3-1,this.parentOffset=r},X={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};w.prototype.resolveDepth=function(t){return t==null?this.depth:t<0?this.depth+t:t};X.parent.get=function(){return this.node(this.depth)};X.doc.get=function(){return this.node(0)};w.prototype.node=function(t){return this.path[this.resolveDepth(t)*3]};w.prototype.index=function(t){return this.path[this.resolveDepth(t)*3+1]};w.prototype.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)};w.prototype.start=function(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1};w.prototype.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size};w.prototype.before=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]};w.prototype.after=function(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize};X.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};X.nodeAfter.get=function(){var n=this.parent,t=this.index(this.depth);if(t==n.childCount)return null;var e=this.pos-this.path[this.path.length-1],r=n.child(t);return e?n.child(t).cut(e):r};X.nodeBefore.get=function(){var n=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(n).cut(0,t):n==0?null:this.parent.child(n-1)};w.prototype.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var r=this.path[e*3],i=e==0?0:this.path[e*3-1]+1,o=0;o<t;o++)i+=r.child(o).nodeSize;return i};w.prototype.marks=function(){var t=this.parent,e=this.index();if(t.content.size==0)return y.none;if(this.textOffset)return t.child(e).marks;var r=t.maybeChild(e-1),i=t.maybeChild(e);if(!r){var o=r;r=i,i=o}for(var a=r.marks,s=0;s<a.length;s++)a[s].type.spec.inclusive===!1&&(!i||!a[s].isInSet(i.marks))&&(a=a[s--].removeFromSet(a));return a};w.prototype.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var r=e.marks,i=t.parent.maybeChild(t.index()),o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!i||!r[o].isInSet(i.marks))&&(r=r[o--].removeFromSet(r));return r};w.prototype.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0};w.prototype.blockRange=function(t,e){if(t===void 0&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var r=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);r>=0;r--)if(t.pos<=this.end(r)&&(!e||e(this.node(r))))return new ce(this,t,r)};w.prototype.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset};w.prototype.max=function(t){return t.pos>this.pos?t:this};w.prototype.min=function(t){return t.pos<this.pos?t:this};w.prototype.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset};w.resolve=function(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");for(var r=[],i=0,o=e,a=t;;){var s=a.content.findIndex(o),f=s.index,p=s.offset,u=o-p;if(r.push(a,f,i+p),!u||(a=a.child(f),a.isText))break;o=u-1,i+=p+1}return new w(e,r,o)};w.resolveCached=function(t,e){for(var r=0;r<kt.length;r++){var i=kt[r];if(i.pos==e&&i.doc==t)return i}var o=kt[Ct]=w.resolve(t,e);return Ct=(Ct+1)%mr,o};Object.defineProperties(w.prototype,X);var kt=[],Ct=0,mr=12,ce=function(t,e,r){this.$from=t,this.$to=e,this.depth=r},Y={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};Y.start.get=function(){return this.$from.before(this.depth+1)};Y.end.get=function(){return this.$to.after(this.depth+1)};Y.parent.get=function(){return this.$from.node(this.depth)};Y.startIndex.get=function(){return this.$from.index(this.depth)};Y.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(ce.prototype,Y);var yr=Object.create(null),m=function(t,e,r,i){this.type=t,this.attrs=e,this.content=r||c.empty,this.marks=i||y.none},I={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};I.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};I.childCount.get=function(){return this.content.childCount};m.prototype.child=function(t){return this.content.child(t)};m.prototype.maybeChild=function(t){return this.content.maybeChild(t)};m.prototype.forEach=function(t){this.content.forEach(t)};m.prototype.nodesBetween=function(t,e,r,i){i===void 0&&(i=0),this.content.nodesBetween(t,e,r,i,this)};m.prototype.descendants=function(t){this.nodesBetween(0,this.content.size,t)};I.textContent.get=function(){return this.textBetween(0,this.content.size,"")};m.prototype.textBetween=function(t,e,r,i){return this.content.textBetween(t,e,r,i)};I.firstChild.get=function(){return this.content.firstChild};I.lastChild.get=function(){return this.content.lastChild};m.prototype.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)};m.prototype.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)};m.prototype.hasMarkup=function(t,e,r){return this.type==t&&pt(this.attrs,e||t.defaultAttrs||yr)&&y.sameSet(this.marks,r||y.none)};m.prototype.copy=function(t){return t===void 0&&(t=null),t==this.content?this:new this.constructor(this.type,this.attrs,t,this.marks)};m.prototype.mark=function(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)};m.prototype.cut=function(t,e){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))};m.prototype.slice=function(t,e,r){if(e===void 0&&(e=this.content.size),r===void 0&&(r=!1),t==e)return d.empty;var i=this.resolve(t),o=this.resolve(e),a=r?0:i.sharedDepth(e),s=i.start(a),f=i.node(a),p=f.content.cut(i.pos-s,o.pos-s);return new d(p,i.depth-a,o.depth-a)};m.prototype.replace=function(t,e,r){return dr(this.resolve(t),this.resolve(e),r)};m.prototype.nodeAt=function(t){for(var e=this;;){var r=e.content.findIndex(t),i=r.index,o=r.offset;if(e=e.maybeChild(i),!e)return null;if(o==t||e.isText)return e;t-=o+1}};m.prototype.childAfter=function(t){var e=this.content.findIndex(t),r=e.index,i=e.offset;return{node:this.content.maybeChild(r),index:r,offset:i}};m.prototype.childBefore=function(t){if(t==0)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),r=e.index,i=e.offset;if(i<t)return{node:this.content.child(r),index:r,offset:i};var o=this.content.child(r-1);return{node:o,index:r-1,offset:i-o.nodeSize}};m.prototype.resolve=function(t){return w.resolveCached(this,t)};m.prototype.resolveNoCache=function(t){return w.resolve(this,t)};m.prototype.rangeHasMark=function(t,e,r){var i=!1;return e>t&&this.nodesBetween(t,e,function(o){return r.isInSet(o.marks)&&(i=!0),!i}),i};I.isBlock.get=function(){return this.type.isBlock};I.isTextblock.get=function(){return this.type.isTextblock};I.inlineContent.get=function(){return this.type.inlineContent};I.isInline.get=function(){return this.type.isInline};I.isText.get=function(){return this.type.isText};I.isLeaf.get=function(){return this.type.isLeaf};I.isAtom.get=function(){return this.type.isAtom};m.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),he(this.marks,t)};m.prototype.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e};m.prototype.canReplace=function(t,e,r,i,o){r===void 0&&(r=c.empty),i===void 0&&(i=0),o===void 0&&(o=r.childCount);var a=this.contentMatchAt(t).matchFragment(r,i,o),s=a&&a.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var f=i;f<o;f++)if(!this.type.allowsMarks(r.child(f).marks))return!1;return!0};m.prototype.canReplaceWith=function(t,e,r,i){if(i&&!this.type.allowsMarks(i))return!1;var o=this.contentMatchAt(t).matchType(r),a=o&&o.matchFragment(this.content,e);return a?a.validEnd:!1};m.prototype.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)};m.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var t=y.none,e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!y.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(r){return r.type.name}));this.content.forEach(function(r){return r.check()})};m.prototype.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(r){return r.toJSON()})),t};m.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var r=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,r)}var i=c.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,i,r)};Object.defineProperties(m.prototype,I);var gr=function(n){function t(r,i,o,a){if(n.call(this,r,i,null,a),!o)throw new RangeError("Empty text nodes are not allowed");this.text=o}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={textContent:{configurable:!0},nodeSize:{configurable:!0}};return t.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):he(this.marks,JSON.stringify(this.text))},e.textContent.get=function(){return this.text},t.prototype.textBetween=function(i,o){return this.text.slice(i,o)},e.nodeSize.get=function(){return this.text.length},t.prototype.mark=function(i){return i==this.marks?this:new t(this.type,this.attrs,this.text,i)},t.prototype.withText=function(i){return i==this.text?this:new t(this.type,this.attrs,i,this.marks)},t.prototype.cut=function(i,o){return i===void 0&&(i=0),o===void 0&&(o=this.text.length),i==0&&o==this.text.length?this:this.withText(this.text.slice(i,o))},t.prototype.eq=function(i){return this.sameMarkup(i)&&this.text==i.text},t.prototype.toJSON=function(){var i=n.prototype.toJSON.call(this);return i.text=this.text,i},Object.defineProperties(t.prototype,e),t}(m);function he(n,t){for(var e=n.length-1;e>=0;e--)t=n[e].type.name+"("+t+")";return t}var M=function(t){this.validEnd=t,this.next=[],this.wrapCache=[]},dt={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};M.parse=function(t,e){var r=new vt(t,e);if(r.next==null)return M.empty;var i=de(r);r.next&&r.err("Unexpected trailing text");var o=Or(Cr(i));return Mr(o,r),o};M.prototype.matchType=function(t){for(var e=0;e<this.next.length;e+=2)if(this.next[e]==t)return this.next[e+1];return null};M.prototype.matchFragment=function(t,e,r){e===void 0&&(e=0),r===void 0&&(r=t.childCount);for(var i=this,o=e;i&&o<r;o++)i=i.matchType(t.child(o).type);return i};dt.inlineContent.get=function(){var n=this.next[0];return n?n.isInline:!1};dt.defaultType.get=function(){for(var n=0;n<this.next.length;n+=2){var t=this.next[n];if(!(t.isText||t.hasRequiredAttrs()))return t}};M.prototype.compatible=function(t){for(var e=0;e<this.next.length;e+=2)for(var r=0;r<t.next.length;r+=2)if(this.next[e]==t.next[r])return!0;return!1};M.prototype.fillBefore=function(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=0);var i=[this];function o(a,s){var f=a.matchFragment(t,r);if(f&&(!e||f.validEnd))return c.from(s.map(function(v){return v.createAndFill()}));for(var p=0;p<a.next.length;p+=2){var u=a.next[p],h=a.next[p+1];if(!(u.isText||u.hasRequiredAttrs())&&i.indexOf(h)==-1){i.push(h);var l=o(h,s.concat(u));if(l)return l}}}return o(this,[])};M.prototype.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var r=this.computeWrapping(t);return this.wrapCache.push(t,r),r};M.prototype.computeWrapping=function(t){for(var e=Object.create(null),r=[{match:this,type:null,via:null}];r.length;){var i=r.shift(),o=i.match;if(o.matchType(t)){for(var a=[],s=i;s.type;s=s.via)a.push(s.type);return a.reverse()}for(var f=0;f<o.next.length;f+=2){var p=o.next[f];!p.isLeaf&&!p.hasRequiredAttrs()&&!(p.name in e)&&(!i.type||o.next[f+1].validEnd)&&(r.push({match:p.contentMatch,type:p,via:i}),e[p.name]=!0)}}};dt.edgeCount.get=function(){return this.next.length>>1};M.prototype.edge=function(t){var e=t<<1;if(e>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return{type:this.next[e],next:this.next[e+1]}};M.prototype.toString=function(){var t=[];function e(r){t.push(r);for(var i=1;i<r.next.length;i+=2)t.indexOf(r.next[i])==-1&&e(r.next[i])}return e(this),t.map(function(r,i){for(var o=i+(r.validEnd?"*":" ")+" ",a=0;a<r.next.length;a+=2)o+=(a?", ":"")+r.next[a].name+"->"+t.indexOf(r.next[a+1]);return o}).join(`
`)};Object.defineProperties(M.prototype,dt);M.empty=new M(!0);var vt=function(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},le={next:{configurable:!0}};le.next.get=function(){return this.tokens[this.pos]};vt.prototype.eat=function(t){return this.next==t&&(this.pos++||!0)};vt.prototype.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")};Object.defineProperties(vt.prototype,le);function de(n){var t=[];do t.push(xr(n));while(n.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function xr(n){var t=[];do t.push(Sr(n));while(n.next&&n.next!=")"&&n.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function Sr(n){for(var t=kr(n);;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else if(n.eat("{"))t=wr(n,t);else break;return t}function $t(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");var t=Number(n.next);return n.pos++,t}function wr(n,t){var e=$t(n),r=e;return n.eat(",")&&(n.next!="}"?r=$t(n):r=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:e,max:r,expr:t}}function br(n,t){var e=n.nodeTypes,r=e[t];if(r)return[r];var i=[];for(var o in e){var a=e[o];a.groups.indexOf(t)>-1&&i.push(a)}return i.length==0&&n.err("No node type or group '"+t+"' found"),i}function kr(n){if(n.eat("(")){var t=de(n);return n.eat(")")||n.err("Missing closing paren"),t}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{var e=br(n,n.next).map(function(r){return n.inline==null?n.inline=r.isInline:n.inline!=r.isInline&&n.err("Mixing inline and block content"),{type:"name",value:r}});return n.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Cr(n){var t=[[]];return i(o(n,0),e()),t;function e(){return t.push([])-1}function r(a,s,f){var p={term:f,to:s};return t[a].push(p),p}function i(a,s){a.forEach(function(f){return f.to=s})}function o(a,s){if(a.type=="choice")return a.exprs.reduce(function(J,P){return J.concat(o(P,s))},[]);if(a.type=="seq")for(var f=0;;f++){var p=o(a.exprs[f],s);if(f==a.exprs.length-1)return p;i(p,s=e())}else if(a.type=="star"){var u=e();return r(s,u),i(o(a.expr,u),u),[r(u)]}else if(a.type=="plus"){var h=e();return i(o(a.expr,s),h),i(o(a.expr,h),h),[r(h)]}else{if(a.type=="opt")return[r(s)].concat(o(a.expr,s));if(a.type=="range"){for(var l=s,v=0;v<a.min;v++){var g=e();i(o(a.expr,l),g),l=g}if(a.max==-1)i(o(a.expr,l),l);else for(var x=a.min;x<a.max;x++){var k=e();r(l,k),i(o(a.expr,l),k),l=k}return[r(l)]}else if(a.type=="name")return[r(s,null,a.value)]}}}function ve(n,t){return t-n}function te(n,t){var e=[];return r(t),e.sort(ve);function r(i){var o=n[i];if(o.length==1&&!o[0].term)return r(o[0].to);e.push(i);for(var a=0;a<o.length;a++){var s=o[a],f=s.term,p=s.to;!f&&e.indexOf(p)==-1&&r(p)}}}function Or(n){var t=Object.create(null);return e(te(n,0));function e(r){var i=[];r.forEach(function(f){n[f].forEach(function(p){var u=p.term,h=p.to;if(!!u){var l=i.indexOf(u),v=l>-1&&i[l+1];te(n,h).forEach(function(g){v||i.push(u,v=[]),v.indexOf(g)==-1&&v.push(g)})}})});for(var o=t[r.join(",")]=new M(r.indexOf(n.length-1)>-1),a=0;a<i.length;a+=2){var s=i[a+1].sort(ve);o.next.push(i[a],t[s.join(",")]||e(s))}return o}}function Mr(n,t){for(var e=0,r=[n];e<r.length;e++){for(var i=r[e],o=!i.validEnd,a=[],s=0;s<i.next.length;s+=2){var f=i.next[s],p=i.next[s+1];a.push(f.name),o&&!(f.isText||f.hasRequiredAttrs())&&(o=!1),r.indexOf(p)==-1&&r.push(p)}o&&t.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function me(n){var t=Object.create(null);for(var e in n){var r=n[e];if(!r.hasDefault)return null;t[e]=r.default}return t}function ye(n,t){var e=Object.create(null);for(var r in n){var i=t&&t[r];if(i===void 0){var o=n[r];if(o.hasDefault)i=o.default;else throw new RangeError("No value supplied for attribute "+r)}e[r]=i}return e}function ge(n){var t=Object.create(null);if(n)for(var e in n)t[e]=new xe(n[e]);return t}var E=function(t,e,r){this.name=t,this.schema=e,this.spec=r,this.groups=r.group?r.group.split(" "):[],this.attrs=ge(r.attrs),this.defaultAttrs=me(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(r.inline||t=="text"),this.isText=t=="text"},Q={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};Q.isInline.get=function(){return!this.isBlock};Q.isTextblock.get=function(){return this.isBlock&&this.inlineContent};Q.isLeaf.get=function(){return this.contentMatch==M.empty};Q.isAtom.get=function(){return this.isLeaf||this.spec.atom};Q.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")};E.prototype.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1};E.prototype.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)};E.prototype.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:ye(this.attrs,t)};E.prototype.create=function(t,e,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new m(this,this.computeAttrs(t),c.from(e),y.setFrom(r))};E.prototype.createChecked=function(t,e,r){if(e=c.from(e),!this.validContent(e))throw new RangeError("Invalid content for node "+this.name);return new m(this,this.computeAttrs(t),e,y.setFrom(r))};E.prototype.createAndFill=function(t,e,r){if(t=this.computeAttrs(t),e=c.from(e),e.size){var i=this.contentMatch.fillBefore(e);if(!i)return null;e=i.append(e)}var o=this.contentMatch.matchFragment(e).fillBefore(c.empty,!0);return o?new m(this,t,e.append(o),y.setFrom(r)):null};E.prototype.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var r=0;r<t.childCount;r++)if(!this.allowsMarks(t.child(r).marks))return!1;return!0};E.prototype.allowsMarkType=function(t){return this.markSet==null||this.markSet.indexOf(t)>-1};E.prototype.allowsMarks=function(t){if(this.markSet==null)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0};E.prototype.allowedMarks=function(t){if(this.markSet==null)return t;for(var e,r=0;r<t.length;r++)this.allowsMarkType(t[r].type)?e&&e.push(t[r]):e||(e=t.slice(0,r));return e?e.length?e:y.empty:t};E.compile=function(t,e){var r=Object.create(null);t.forEach(function(a,s){return r[a]=new E(a,e,s)});var i=e.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(var o in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r};Object.defineProperties(E.prototype,Q);var xe=function(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default},Se={isRequired:{configurable:!0}};Se.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(xe.prototype,Se);var L=function(t,e,r,i){this.name=t,this.schema=r,this.spec=i,this.attrs=ge(i.attrs),this.rank=e,this.excluded=null;var o=me(this.attrs);this.instance=o&&new y(this,o)};L.prototype.create=function(t){return!t&&this.instance?this.instance:new y(this,ye(this.attrs,t))};L.compile=function(t,e){var r=Object.create(null),i=0;return t.forEach(function(o,a){return r[o]=new L(o,i++,e,a)}),r};L.prototype.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t};L.prototype.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]};L.prototype.excludes=function(t){return this.excluded.indexOf(t)>-1};var K=function(t){this.spec={};for(var e in t)this.spec[e]=t[e];this.spec.nodes=wt.from(t.nodes),this.spec.marks=wt.from(t.marks),this.nodes=E.compile(this.spec.nodes,this),this.marks=L.compile(this.spec.marks,this);var r=Object.create(null);for(var i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");var o=this.nodes[i],a=o.spec.content||"",s=o.spec.marks;o.contentMatch=r[a]||(r[a]=M.parse(a,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.markSet=s=="_"?null:s?ee(this,s.split(" ")):s==""||!o.inlineContent?[]:null}for(var f in this.marks){var p=this.marks[f],u=p.spec.excludes;p.excluded=u==null?[p]:u==""?[]:ee(this,u.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};K.prototype.node=function(t,e,r,i){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof E){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,r,i)};K.prototype.text=function(t,e){var r=this.nodes.text;return new gr(r,r.defaultAttrs,t,y.setFrom(e))};K.prototype.mark=function(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)};K.prototype.nodeFromJSON=function(t){return m.fromJSON(this,t)};K.prototype.markFromJSON=function(t){return y.fromJSON(this,t)};K.prototype.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e};function ee(n,t){for(var e=[],r=0;r<t.length;r++){var i=t[r],o=n.marks[i],a=o;if(o)e.push(o);else for(var s in n.marks){var f=n.marks[s];(i=="_"||f.spec.group&&f.spec.group.split(" ").indexOf(i)>-1)&&e.push(a=f)}if(!a)throw new SyntaxError("Unknown mark type: '"+t[r]+"'")}return e}var q=function(t,e){var r=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach(function(i){i.tag?r.tags.push(i):i.style&&r.styles.push(i)}),this.normalizeLists=!this.tags.some(function(i){if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;var o=t.nodes[i.node];return o.contentMatch.matchType(o)})};q.prototype.parse=function(t,e){e===void 0&&(e={});var r=new S(this,e,!1);return r.addAll(t,null,e.from,e.to),r.finish()};q.prototype.parseSlice=function(t,e){e===void 0&&(e={});var r=new S(this,e,!0);return r.addAll(t,null,e.from,e.to),d.maxOpen(r.finish())};q.prototype.matchTag=function(t,e,r){for(var i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){var o=this.tags[i];if(Nr(t,o.tag)&&(o.namespace===void 0||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){var a=o.getAttrs(t);if(a===!1)continue;o.attrs=a}return o}}};q.prototype.matchStyle=function(t,e,r,i){for(var o=i?this.styles.indexOf(i)+1:0;o<this.styles.length;o++){var a=this.styles[o];if(!(a.style.indexOf(t)!=0||a.context&&!r.matchesContext(a.context)||a.style.length>t.length&&(a.style.charCodeAt(t.length)!=61||a.style.slice(t.length+1)!=e))){if(a.getAttrs){var s=a.getAttrs(e);if(s===!1)continue;a.attrs=s}return a}}};q.schemaRules=function(t){var e=[];function r(f){for(var p=f.priority==null?50:f.priority,u=0;u<e.length;u++){var h=e[u],l=h.priority==null?50:h.priority;if(l<p)break}e.splice(u,0,f)}var i=function(f){var p=t.marks[f].spec.parseDOM;p&&p.forEach(function(u){r(u=re(u)),u.mark=f})};for(var o in t.marks)i(o);var a=function(f){var p=t.nodes[s].spec.parseDOM;p&&p.forEach(function(u){r(u=re(u)),u.node=s})};for(var s in t.nodes)a();return e};q.fromSchema=function(t){return t.cached.domParser||(t.cached.domParser=new q(t,q.schemaRules(t)))};var Mt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Tr={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},we={ol:!0,ul:!0},ct=1,ht=2,rt=4;function be(n,t,e){return t!=null?(t?ct:0)|(t==="full"?ht:0):n&&n.whitespace=="pre"?ct|ht:e&~rt}var D=function(t,e,r,i,o,a,s){this.type=t,this.attrs=e,this.solid=o,this.match=a||(s&rt?null:t.contentMatch),this.options=s,this.content=[],this.marks=r,this.activeMarks=y.none,this.pendingMarks=i,this.stashMarks=[]};D.prototype.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(c.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{var r=this.type.contentMatch,i;return(i=r.findWrapping(t.type))?(this.match=r,i):null}}return this.match.findWrapping(t.type)};D.prototype.finish=function(t){if(!(this.options&ct)){var e=this.content[this.content.length-1],r;e&&e.isText&&(r=/[ \t\r\n\u000c]+$/.exec(e.text))&&(e.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=e.withText(e.text.slice(0,e.text.length-r[0].length)))}var i=c.from(this.content);return!t&&this.match&&(i=i.append(this.match.fillBefore(c.empty,!0))),this.type?this.type.create(this.attrs,i,this.marks):i};D.prototype.popFromStashMark=function(t){for(var e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]};D.prototype.applyPending=function(t){for(var e=0,r=this.pendingMarks;e<r.length;e++){var i=r[e];(this.type?this.type.allowsMarkType(i.type):Ir(i.type,t))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}};D.prototype.inlineContext=function(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!Mt.hasOwnProperty(t.parentNode.nodeName.toLowerCase())};var S=function(t,e,r){this.parser=t,this.options=e,this.isOpen=r;var i=e.topNode,o,a=be(null,e.preserveWhitespace,0)|(r?rt:0);i?o=new D(i.type,i.attrs,y.none,y.none,!0,e.topMatch||i.type.contentMatch,a):r?o=new D(null,null,y.none,y.none,!0,null,a):o=new D(t.schema.topNodeType,null,y.none,y.none,!0,null,a),this.nodes=[o],this.open=0,this.find=e.findPositions,this.needsBlock=!1},Tt={top:{configurable:!0},currentPos:{configurable:!0}};Tt.top.get=function(){return this.nodes[this.open]};S.prototype.addDOM=function(t){if(t.nodeType==3)this.addTextNode(t);else if(t.nodeType==1){var e=t.getAttribute("style"),r=e?this.readStyles(Rr(e)):null,i=this.top;if(r!=null)for(var o=0;o<r.length;o++)this.addPendingMark(r[o]);if(this.addElement(t),r!=null)for(var a=0;a<r.length;a++)this.removePendingMark(r[a],i)}};S.prototype.addTextNode=function(t){var e=t.nodeValue,r=this.top;if(r.options&ht||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(r.options&ct)r.options&ht?e=e.replace(/\r\n?/g,`
`):e=e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){var i=r.content[r.content.length-1],o=t.previousSibling;(!i||o&&o.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)};S.prototype.addElement=function(t,e){var r=t.nodeName.toLowerCase(),i;we.hasOwnProperty(r)&&this.parser.normalizeLists&&Er(t);var o=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,e));if(o?o.ignore:Tr.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!o||o.skip||o.closeParent){o&&o.closeParent?this.open=Math.max(0,this.open-1):o&&o.skip.nodeType&&(t=o.skip);var a,s=this.top,f=this.needsBlock;if(Mt.hasOwnProperty(r))a=!0,s.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t),a&&this.sync(s),this.needsBlock=f}else this.addElementByRule(t,o,o.consuming===!1?i:null)};S.prototype.leafFallback=function(t){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`))};S.prototype.ignoreFallback=function(t){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};S.prototype.readStyles=function(t){var e=y.none;t:for(var r=0;r<t.length;r+=2)for(var i=null;;){var o=this.parser.matchStyle(t[r],t[r+1],this,i);if(!o)continue t;if(o.ignore)return null;if(e=this.parser.schema.marks[o.mark].create(o.attrs).addToSet(e),o.consuming===!1)i=o;else break}return e};S.prototype.addElementByRule=function(t,e,r){var i=this,o,a,s,f;e.node?(a=this.parser.schema.nodes[e.node],a.isLeaf?this.insertNode(a.create(e.attrs))||this.leafFallback(t):o=this.enter(a,e.attrs,e.preserveWhitespace)):(s=this.parser.schema.marks[e.mark],f=s.create(e.attrs),this.addPendingMark(f));var p=this.top;if(a&&a.isLeaf)this.findInside(t);else if(r)this.addElement(t,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(function(h){return i.insertNode(h)});else{var u=e.contentElement;typeof u=="string"?u=t.querySelector(u):typeof u=="function"&&(u=u(t)),u||(u=t),this.findAround(t,u,!0),this.addAll(u,o)}o&&(this.sync(p),this.open--),f&&this.removePendingMark(f,p)};S.prototype.addAll=function(t,e,r,i){for(var o=r||0,a=r?t.childNodes[r]:t.firstChild,s=i==null?null:t.childNodes[i];a!=s;a=a.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(a),e&&Mt.hasOwnProperty(a.nodeName.toLowerCase())&&this.sync(e);this.findAtPoint(t,o)};S.prototype.findPlace=function(t){for(var e,r,i=this.open;i>=0;i--){var o=this.nodes[i],a=o.findWrapping(t);if(a&&(!e||e.length>a.length)&&(e=a,r=o,!a.length)||o.solid)break}if(!e)return!1;this.sync(r);for(var s=0;s<e.length;s++)this.enterInner(e[s],null,!1);return!0};S.prototype.insertNode=function(t){if(t.isInline&&this.needsBlock&&!this.top.type){var e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();var r=this.top;r.applyPending(t.type),r.match&&(r.match=r.match.matchType(t.type));for(var i=r.activeMarks,o=0;o<t.marks.length;o++)(!r.type||r.type.allowsMarkType(t.marks[o].type))&&(i=t.marks[o].addToSet(i));return r.content.push(t.mark(i)),!0}return!1};S.prototype.enter=function(t,e,r){var i=this.findPlace(t.create(e));return i&&this.enterInner(t,e,!0,r),i};S.prototype.enterInner=function(t,e,r,i){this.closeExtra();var o=this.top;o.applyPending(t),o.match=o.match&&o.match.matchType(t,e);var a=be(t,i,o.options);o.options&rt&&o.content.length==0&&(a|=rt),this.nodes.push(new D(t,e,o.activeMarks,o.pendingMarks,r,null,a)),this.open++};S.prototype.closeExtra=function(t){var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}};S.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};S.prototype.sync=function(t){for(var e=this.open;e>=0;e--)if(this.nodes[e]==t){this.open=e;return}};Tt.currentPos.get=function(){this.closeExtra();for(var n=0,t=this.open;t>=0;t--){for(var e=this.nodes[t].content,r=e.length-1;r>=0;r--)n+=e[r].nodeSize;t&&n++}return n};S.prototype.findAtPoint=function(t,e){if(this.find)for(var r=0;r<this.find.length;r++)this.find[r].node==t&&this.find[r].offset==e&&(this.find[r].pos=this.currentPos)};S.prototype.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)};S.prototype.findAround=function(t,e,r){if(t!=e&&this.find){for(var i=0;i<this.find.length;i++)if(this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)){var o=e.compareDocumentPosition(this.find[i].node);o&(r?2:4)&&(this.find[i].pos=this.currentPos)}}};S.prototype.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))};S.prototype.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var r=t.split("/"),i=this.options.context,o=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),a=-(i?i.depth+1:0)+(o?0:1),s=function(f,p){for(;f>=0;f--){var u=r[f];if(u==""){if(f==r.length-1||f==0)continue;for(;p>=a;p--)if(s(f-1,p))return!0;return!1}else{var h=p>0||p==0&&o?e.nodes[p].type:i&&p>=a?i.node(p-a).type:null;if(!h||h.name!=u&&h.groups.indexOf(u)==-1)return!1;p--}}return!0};return s(r.length-1,this.open)};S.prototype.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var r=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(var i in this.parser.schema.nodes){var o=this.parser.schema.nodes[i];if(o.isTextblock&&o.defaultAttrs)return o}};S.prototype.addPendingMark=function(t){var e=zr(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)};S.prototype.removePendingMark=function(t,e){for(var r=this.open;r>=0;r--){var i=this.nodes[r],o=i.pendingMarks.lastIndexOf(t);if(o>-1)i.pendingMarks=t.removeFromSet(i.pendingMarks);else{i.activeMarks=t.removeFromSet(i.activeMarks);var a=i.popFromStashMark(t);a&&i.type&&i.type.allowsMarkType(a.type)&&(i.activeMarks=a.addToSet(i.activeMarks))}if(i==e)break}};Object.defineProperties(S.prototype,Tt);function Er(n){for(var t=n.firstChild,e=null;t;t=t.nextSibling){var r=t.nodeType==1?t.nodeName.toLowerCase():null;r&&we.hasOwnProperty(r)&&e?(e.appendChild(t),t=e):r=="li"?e=t:r&&(e=null)}}function Nr(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function Rr(n){for(var t=/\s*([\w-]+)\s*:\s*([^;]+)/g,e,r=[];e=t.exec(n);)r.push(e[1],e[2].trim());return r}function re(n){var t={};for(var e in n)t[e]=n[e];return t}function Ir(n,t){var e=t.schema.nodes,r=function(a){var s=e[a];if(!!s.allowsMarkType(n)){var f=[],p=function(u){f.push(u);for(var h=0;h<u.edgeCount;h++){var l=u.edge(h),v=l.type,g=l.next;if(v==t||f.indexOf(g)<0&&p(g))return!0}};if(p(s.contentMatch))return{v:!0}}};for(var i in e){var o=r(i);if(o)return o.v}}function zr(n,t){for(var e=0;e<t.length;e++)if(n.eq(t[e]))return t[e]}var A=function(t,e){this.nodes=t||{},this.marks=e||{}};A.prototype.serializeFragment=function(t,e,r){var i=this;e===void 0&&(e={}),r||(r=Et(e).createDocumentFragment());var o=r,a=null;return t.forEach(function(s){if(a||s.marks.length){a||(a=[]);for(var f=0,p=0;f<a.length&&p<s.marks.length;){var u=s.marks[p];if(!i.marks[u.type.name]){p++;continue}if(!u.eq(a[f])||u.type.spec.spanning===!1)break;f+=2,p++}for(;f<a.length;)o=a.pop(),a.pop();for(;p<s.marks.length;){var h=s.marks[p++],l=i.serializeMark(h,s.isInline,e);l&&(a.push(h,o),o.appendChild(l.dom),o=l.contentDOM||l.dom)}}o.appendChild(i.serializeNodeInner(s,e))}),r};A.prototype.serializeNodeInner=function(t,e){e===void 0&&(e={});var r=A.renderSpec(Et(e),this.nodes[t.type.name](t)),i=r.dom,o=r.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");e.onContent?e.onContent(t,o,e):this.serializeFragment(t.content,e,o)}return i};A.prototype.serializeNode=function(t,e){e===void 0&&(e={});for(var r=this.serializeNodeInner(t,e),i=t.marks.length-1;i>=0;i--){var o=this.serializeMark(t.marks[i],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(r),r=o.dom)}return r};A.prototype.serializeMark=function(t,e,r){r===void 0&&(r={});var i=this.marks[t.type.name];return i&&A.renderSpec(Et(r),i(t,e))};A.renderSpec=function(t,e,r){if(r===void 0&&(r=null),typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;var i=e[0],o=i.indexOf(" ");o>0&&(r=i.slice(0,o),i=i.slice(o+1));var a=null,s=r?t.createElementNS(r,i):t.createElement(i),f=e[1],p=1;if(f&&typeof f=="object"&&f.nodeType==null&&!Array.isArray(f)){p=2;for(var u in f)if(f[u]!=null){var h=u.indexOf(" ");h>0?s.setAttributeNS(u.slice(0,h),u.slice(h+1),f[u]):s.setAttribute(u,f[u])}}for(var l=p;l<e.length;l++){var v=e[l];if(v===0){if(l<e.length-1||l>p)throw new RangeError("Content hole must be the only child of its parent node");return{dom:s,contentDOM:s}}else{var g=A.renderSpec(t,v,r),x=g.dom,k=g.contentDOM;if(s.appendChild(x),k){if(a)throw new RangeError("Multiple content holes");a=k}}}return{dom:s,contentDOM:a}};A.fromSchema=function(t){return t.cached.domSerializer||(t.cached.domSerializer=new A(this.nodesFromSchema(t),this.marksFromSchema(t)))};A.nodesFromSchema=function(t){var e=ke(t.nodes);return e.text||(e.text=function(r){return r.text}),e};A.marksFromSchema=function(t){return ke(t.marks)};function ke(n){var t={};for(var e in n){var r=n[e].spec.toDOM;r&&(t[e]=r)}return t}function Et(n){return n.document||window.document}var Ce=65535,Oe=Math.pow(2,16);function Ar(n,t){return n+t*Oe}function Me(n){return n&Ce}function Fr(n){return(n-(n&Ce))/Oe}var Nt=function(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=null),this.pos=t,this.deleted=e,this.recover=r},C=function n(t,e){if(e===void 0&&(e=!1),!t.length&&n.empty)return n.empty;this.ranges=t,this.inverted=e};C.prototype.recover=function(t){var e=0,r=Me(t);if(!this.inverted)for(var i=0;i<r;i++)e+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+e+Fr(t)};C.prototype.mapResult=function(t,e){return e===void 0&&(e=1),this._map(t,e,!1)};C.prototype.map=function(t,e){return e===void 0&&(e=1),this._map(t,e,!0)};C.prototype._map=function(t,e,r){for(var i=0,o=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var f=this.ranges[s]-(this.inverted?i:0);if(f>t)break;var p=this.ranges[s+o],u=this.ranges[s+a],h=f+p;if(t<=h){var l=p?t==f?-1:t==h?1:e:e,v=f+i+(l<0?0:u);if(r)return v;var g=t==(e<0?f:h)?null:Ar(s/3,t-f);return new Nt(v,e<0?t!=f:t!=h,g)}i+=u-p}return r?t+i:new Nt(t+i)};C.prototype.touches=function(t,e){for(var r=0,i=Me(e),o=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var f=this.ranges[s]-(this.inverted?r:0);if(f>t)break;var p=this.ranges[s+o],u=f+p;if(t<=u&&s==i*3)return!0;r+=this.ranges[s+a]-p}return!1};C.prototype.forEach=function(t){for(var e=this.inverted?2:1,r=this.inverted?1:2,i=0,o=0;i<this.ranges.length;i+=3){var a=this.ranges[i],s=a-(this.inverted?o:0),f=a+(this.inverted?0:o),p=this.ranges[i+e],u=this.ranges[i+r];t(s,s+p,f,f+u),o+=u-p}};C.prototype.invert=function(){return new C(this.ranges,!this.inverted)};C.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};C.offset=function(t){return t==0?C.empty:new C(t<0?[0,-t,0]:[0,0,t])};C.empty=new C([]);var R=function(t,e,r,i){this.maps=t||[],this.from=r||0,this.to=i??this.maps.length,this.mirror=e};R.prototype.slice=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=this.maps.length),new R(this.maps,this.mirror,t,e)};R.prototype.copy=function(){return new R(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};R.prototype.appendMap=function(t,e){this.to=this.maps.push(t),e!=null&&this.setMirror(this.maps.length-1,e)};R.prototype.appendMapping=function(t){for(var e=0,r=this.maps.length;e<t.maps.length;e++){var i=t.getMirror(e);this.appendMap(t.maps[e],i!=null&&i<e?r+i:null)}};R.prototype.getMirror=function(t){if(this.mirror){for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}};R.prototype.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)};R.prototype.appendMappingInverted=function(t){for(var e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){var i=t.getMirror(e);this.appendMap(t.maps[e].invert(),i!=null&&i>e?r-i-1:null)}};R.prototype.invert=function(){var t=new R;return t.appendMappingInverted(this),t};R.prototype.map=function(t,e){if(e===void 0&&(e=1),this.mirror)return this._map(t,e,!0);for(var r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t};R.prototype.mapResult=function(t,e){return e===void 0&&(e=1),this._map(t,e,!1)};R.prototype._map=function(t,e,r){for(var i=!1,o=this.from;o<this.to;o++){var a=this.maps[o],s=a.mapResult(t,e);if(s.recover!=null){var f=this.getMirror(o);if(f!=null&&f>o&&f<this.to){o=f,t=this.maps[f].recover(s.recover);continue}}s.deleted&&(i=!0),t=s.pos}return r?t:new Nt(t,i)};function $(n){var t=Error.call(this,n);return t.__proto__=$.prototype,t}$.prototype=Object.create(Error.prototype);$.prototype.constructor=$;$.prototype.name="TransformError";var b=function(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new R},At={before:{configurable:!0},docChanged:{configurable:!0}};At.before.get=function(){return this.docs.length?this.docs[0]:this.doc};b.prototype.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new $(e.failed);return this};b.prototype.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e};At.docChanged.get=function(){return this.steps.length>0};b.prototype.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e};Object.defineProperties(b.prototype,At);function mt(){throw new Error("Override me")}var Rt=Object.create(null),T=function(){};T.prototype.apply=function(t){return mt()};T.prototype.getMap=function(){return C.empty};T.prototype.invert=function(t){return mt()};T.prototype.map=function(t){return mt()};T.prototype.merge=function(t){return null};T.prototype.toJSON=function(){return mt()};T.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var r=Rt[e.stepType];if(!r)throw new RangeError("No step type "+e.stepType+" defined");return r.fromJSON(t,e)};T.jsonID=function(t,e){if(t in Rt)throw new RangeError("Duplicate use of step JSON ID "+t);return Rt[t]=e,e.prototype.jsonID=t,e};var N=function(t,e){this.doc=t,this.failed=e};N.ok=function(t){return new N(t,null)};N.fail=function(t){return new N(null,t)};N.fromReplace=function(t,e,r,i){try{return N.ok(t.replace(e,r,i))}catch(o){if(o instanceof _)return N.fail(o.message);throw o}};var Z=function(n){function t(e,r,i,o){n.call(this),this.from=e,this.to=r,this.slice=i,this.structure=!!o}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){return this.structure&&It(r,this.from,this.to)?N.fail("Structure replace would overwrite content"):N.fromReplace(r,this.from,this.to,this.slice)},t.prototype.getMap=function(){return new C([this.from,this.to-this.from,this.slice.size])},t.prototype.invert=function(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted?null:new t(i.pos,Math.max(i.pos,o.pos),this.slice)},t.prototype.merge=function(r){if(!(r instanceof t)||r.structure||this.structure)return null;if(this.from+this.slice.size==r.from&&!this.slice.openEnd&&!r.slice.openStart){var i=this.slice.size+r.slice.size==0?d.empty:new d(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),i,this.structure)}else if(r.to==this.from&&!this.slice.openStart&&!r.slice.openEnd){var o=this.slice.size+r.slice.size==0?d.empty:new d(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,o,this.structure)}else return null},t.prototype.toJSON=function(){var r={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new t(i.from,i.to,d.fromJSON(r,i.slice),!!i.structure)},t}(T);T.jsonID("replace",Z);var tt=function(n){function t(e,r,i,o,a,s,f){n.call(this),this.from=e,this.to=r,this.gapFrom=i,this.gapTo=o,this.slice=a,this.insert=s,this.structure=!!f}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){if(this.structure&&(It(r,this.from,this.gapFrom)||It(r,this.gapTo,this.to)))return N.fail("Structure gap-replace would overwrite content");var i=r.slice(this.gapFrom,this.gapTo);if(i.openStart||i.openEnd)return N.fail("Gap is not a flat range");var o=this.slice.insertAt(this.insert,i.content);return o?N.fromReplace(r,this.from,this.to,o):N.fail("Content does not fit in gap")},t.prototype.getMap=function(){return new C([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},t.prototype.invert=function(r){var i=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+i,this.from+this.insert,this.from+this.insert+i,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1),a=r.map(this.gapFrom,-1),s=r.map(this.gapTo,1);return i.deleted&&o.deleted||a<i.pos||s>o.pos?null:new t(i.pos,o.pos,a,s,this.slice,this.insert,this.structure)},t.prototype.toJSON=function(){var r={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(r.slice=this.slice.toJSON()),this.structure&&(r.structure=!0),r},t.fromJSON=function(r,i){if(typeof i.from!="number"||typeof i.to!="number"||typeof i.gapFrom!="number"||typeof i.gapTo!="number"||typeof i.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new t(i.from,i.to,i.gapFrom,i.gapTo,d.fromJSON(r,i.slice),i.insert,!!i.structure)},t}(T);T.jsonID("replaceAround",tt);function It(n,t,e){for(var r=n.resolve(t),i=e-t,o=r.depth;i>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,i--;if(i>0)for(var a=r.node(o).maybeChild(r.indexAfter(o));i>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,i--}return!1}b.prototype.lift=function(n,t){for(var e=n.$from,r=n.$to,i=n.depth,o=e.before(i+1),a=r.after(i+1),s=o,f=a,p=c.empty,u=0,h=i,l=!1;h>t;h--)l||e.index(h)>0?(l=!0,p=c.from(e.node(h).copy(p)),u++):s--;for(var v=c.empty,g=0,x=i,k=!1;x>t;x--)k||r.after(x+1)<r.end(x)?(k=!0,v=c.from(r.node(x).copy(v)),g++):f++;return this.step(new tt(s,f,o,a,new d(p.append(v),u,g),p.size-u,!0))};b.prototype.wrap=function(n,t){for(var e=c.empty,r=t.length-1;r>=0;r--){if(e.size){var i=t[r].type.contentMatch.matchFragment(e);if(!i||!i.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}e=c.from(t[r].type.create(t[r].attrs,e))}var o=n.start,a=n.end;return this.step(new tt(o,a,o,a,new d(e,0,0),t.length,!0))};b.prototype.setBlockType=function(n,t,e,r){var i=this;if(t===void 0&&(t=n),!e.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var o=this.steps.length;return this.doc.nodesBetween(n,t,function(a,s){if(a.isTextblock&&!a.hasMarkup(e,r)&&Jr(i.doc,i.mapping.slice(o).map(s),e)){i.clearIncompatible(i.mapping.slice(o).map(s,1),e);var f=i.mapping.slice(o),p=f.map(s,1),u=f.map(s+a.nodeSize,1);return i.step(new tt(p,u,p+1,u-1,new d(c.from(e.create(r,null,a.marks)),0,0),1,!0)),!1}}),this};function Jr(n,t,e){var r=n.resolve(t),i=r.index();return r.parent.canReplaceWith(i,i+1,e)}b.prototype.setNodeMarkup=function(n,t,e,r){var i=this.doc.nodeAt(n);if(!i)throw new RangeError("No node at given position");t||(t=i.type);var o=t.create(e,null,r||i.marks);if(i.isLeaf)return this.replaceWith(n,n+i.nodeSize,o);if(!t.validContent(i.content))throw new RangeError("Invalid content for node type "+t.name);return this.step(new tt(n,n+i.nodeSize,n+1,n+i.nodeSize-1,new d(c.from(o),0,0),1,!0))};b.prototype.split=function(n,t,e){t===void 0&&(t=1);for(var r=this.doc.resolve(n),i=c.empty,o=c.empty,a=r.depth,s=r.depth-t,f=t-1;a>s;a--,f--){i=c.from(r.node(a).copy(i));var p=e&&e[f];o=c.from(p?p.type.create(p.attrs,o):r.node(a).copy(o))}return this.step(new Z(n,n,new d(i.append(o),t,t),!0))};b.prototype.join=function(n,t){t===void 0&&(t=1);var e=new Z(n-t,n+t,d.empty,!0);return this.step(e)};function Br(n,t,e){var r=n.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),e))return t;if(r.parentOffset==0)for(var i=r.depth-1;i>=0;i--){var o=r.index(i);if(r.node(i).canReplaceWith(o,o,e))return r.before(i+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(var a=r.depth-1;a>=0;a--){var s=r.indexAfter(a);if(r.node(a).canReplaceWith(s,s,e))return r.after(a+1);if(s<r.node(a).childCount)return null}}function Ft(n,t,e){for(var r=[],i=0;i<n.childCount;i++){var o=n.child(i);o.content.size&&(o=o.copy(Ft(o.content,t,o))),o.isInline&&(o=t(o,e,i)),r.push(o)}return c.fromArray(r)}var Jt=function(n){function t(e,r,i){n.call(this),this.from=e,this.to=r,this.mark=i}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){var i=this,o=r.slice(this.from,this.to),a=r.resolve(this.from),s=a.node(a.sharedDepth(this.to)),f=new d(Ft(o.content,function(p,u){return!p.isAtom||!u.type.allowsMarkType(i.mark.type)?p:p.mark(i.mark.addToSet(p.marks))},s),o.openStart,o.openEnd);return N.fromReplace(r,this.from,this.to,f)},t.prototype.invert=function(){return new it(this.from,this.to,this.mark)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted||i.pos>=o.pos?null:new t(i.pos,o.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new t(i.from,i.to,r.markFromJSON(i.mark))},t}(T);T.jsonID("addMark",Jt);var it=function(n){function t(e,r,i){n.call(this),this.from=e,this.to=r,this.mark=i}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.apply=function(r){var i=this,o=r.slice(this.from,this.to),a=new d(Ft(o.content,function(s){return s.mark(i.mark.removeFromSet(s.marks))}),o.openStart,o.openEnd);return N.fromReplace(r,this.from,this.to,a)},t.prototype.invert=function(){return new Jt(this.from,this.to,this.mark)},t.prototype.map=function(r){var i=r.mapResult(this.from,1),o=r.mapResult(this.to,-1);return i.deleted&&o.deleted||i.pos>=o.pos?null:new t(i.pos,o.pos,this.mark)},t.prototype.merge=function(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from)return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)},t.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},t.fromJSON=function(r,i){if(typeof i.from!="number"||typeof i.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new t(i.from,i.to,r.markFromJSON(i.mark))},t}(T);T.jsonID("removeMark",it);b.prototype.addMark=function(n,t,e){var r=this,i=[],o=[],a=null,s=null;return this.doc.nodesBetween(n,t,function(f,p,u){if(!!f.isInline){var h=f.marks;if(!e.isInSet(h)&&u.type.allowsMarkType(e.type)){for(var l=Math.max(p,n),v=Math.min(p+f.nodeSize,t),g=e.addToSet(h),x=0;x<h.length;x++)h[x].isInSet(g)||(a&&a.to==l&&a.mark.eq(h[x])?a.to=v:i.push(a=new it(l,v,h[x])));s&&s.to==l?s.to=v:o.push(s=new Jt(l,v,e))}}}),i.forEach(function(f){return r.step(f)}),o.forEach(function(f){return r.step(f)}),this};b.prototype.removeMark=function(n,t,e){var r=this;e===void 0&&(e=null);var i=[],o=0;return this.doc.nodesBetween(n,t,function(a,s){if(!!a.isInline){o++;var f=null;if(e instanceof L)for(var p=a.marks,u;u=e.isInSet(p);)(f||(f=[])).push(u),p=u.removeFromSet(p);else e?e.isInSet(a.marks)&&(f=[e]):f=a.marks;if(f&&f.length)for(var h=Math.min(s+a.nodeSize,t),l=0;l<f.length;l++){for(var v=f[l],g=void 0,x=0;x<i.length;x++){var k=i[x];k.step==o-1&&v.eq(i[x].style)&&(g=k)}g?(g.to=h,g.step=o):i.push({style:v,from:Math.max(s,n),to:h,step:o})}}}),i.forEach(function(a){return r.step(new it(a.from,a.to,a.style))}),this};b.prototype.clearIncompatible=function(n,t,e){e===void 0&&(e=t.contentMatch);for(var r=this.doc.nodeAt(n),i=[],o=n+1,a=0;a<r.childCount;a++){var s=r.child(a),f=o+s.nodeSize,p=e.matchType(s.type,s.attrs);if(!p)i.push(new Z(o,f,d.empty));else{e=p;for(var u=0;u<s.marks.length;u++)t.allowsMarkType(s.marks[u].type)||this.step(new it(o,f,s.marks[u]))}o=f}if(!e.validEnd){var h=e.fillBefore(c.empty,!0);this.replace(o,o,new d(h,0,0))}for(var l=i.length-1;l>=0;l--)this.step(i[l]);return this};function _r(n,t,e,r){if(e===void 0&&(e=t),r===void 0&&(r=d.empty),t==e&&!r.size)return null;var i=n.resolve(t),o=n.resolve(e);return Te(i,o,r)?new Z(t,e,r):new F(i,o,r).fit()}b.prototype.replace=function(n,t,e){t===void 0&&(t=n),e===void 0&&(e=d.empty);var r=_r(this.doc,n,t,e);return r&&this.step(r),this};b.prototype.replaceWith=function(n,t,e){return this.replace(n,t,new d(c.from(e),0,0))};b.prototype.delete=function(n,t){return this.replace(n,t,d.empty)};b.prototype.insert=function(n,t){return this.replaceWith(n,n,t)};function Te(n,t,e){return!e.openStart&&!e.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),e.content)}var F=function(t,e,r){this.$to=e,this.$from=t,this.unplaced=r,this.frontier=[];for(var i=0;i<=t.depth;i++){var o=t.node(i);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(i))})}this.placed=c.empty;for(var a=t.depth;a>0;a--)this.placed=c.from(t.node(a).copy(this.placed))},Ee={depth:{configurable:!0}};Ee.depth.get=function(){return this.frontier.length-1};F.prototype.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,i=this.$from,o=this.close(e<0?this.$to:i.doc.resolve(e));if(!o)return null;for(var a=this.placed,s=i.depth,f=o.depth;s&&f&&a.childCount==1;)a=a.firstChild.content,s--,f--;var p=new d(a,s,f);if(e>-1)return new tt(i.pos,e,this.$to.pos,this.$to.end(),p,r);if(p.size||i.pos!=this.$to.pos)return new Z(i.pos,o.pos,p)};F.prototype.findFittable=function(){for(var t=1;t<=2;t++)for(var e=this.unplaced.openStart;e>=0;e--){var r=void 0,i=void 0;e?(i=Bt(this.unplaced.content,e-1).firstChild,r=i.content):r=this.unplaced.content;for(var o=r.firstChild,a=this.depth;a>=0;a--){var s=this.frontier[a],f=s.type,p=s.match,u=void 0,h=void 0;if(t==1&&(o?p.matchType(o.type)||(h=p.fillBefore(c.from(o),!1)):f.compatibleContent(i.type)))return{sliceDepth:e,frontierDepth:a,parent:i,inject:h};if(t==2&&o&&(u=p.findWrapping(o.type)))return{sliceDepth:e,frontierDepth:a,parent:i,wrap:u};if(i&&p.matchType(i.type))break}}};F.prototype.openMore=function(){var t=this.unplaced,e=t.content,r=t.openStart,i=t.openEnd,o=Bt(e,r);return!o.childCount||o.firstChild.isLeaf?!1:(this.unplaced=new d(e,r+1,Math.max(i,o.size+r>=e.size-i?r+1:0)),!0)};F.prototype.dropNode=function(){var t=this.unplaced,e=t.content,r=t.openStart,i=t.openEnd,o=Bt(e,r);if(o.childCount<=1&&r>0){var a=e.size-r<=r+o.size;this.unplaced=new d(nt(e,r-1,1),r-1,a?r-1:i)}else this.unplaced=new d(nt(e,r,1),r,i)};F.prototype.placeNodes=function(t){for(var e=t.sliceDepth,r=t.frontierDepth,i=t.parent,o=t.inject,a=t.wrap;this.depth>r;)this.closeFrontierNode();if(a)for(var s=0;s<a.length;s++)this.openFrontierNode(a[s]);var f=this.unplaced,p=i?i.content:f.content,u=f.openStart-e,h=0,l=[],v=this.frontier[r],g=v.match,x=v.type;if(o){for(var k=0;k<o.childCount;k++)l.push(o.child(k));g=g.matchFragment(o)}for(var J=p.size+e-(f.content.size-f.openEnd);h<p.childCount;){var P=p.child(h),j=g.matchType(P.type);if(!j)break;h++,(h>1||u==0||P.content.size)&&(g=j,l.push(Ne(P.mark(x.allowedMarks(P.marks)),h==1?u:0,h==p.childCount?J:-1)))}var W=h==p.childCount;W||(J=-1),this.placed=ot(this.placed,r,c.from(l)),this.frontier[r].match=g,W&&J<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var U=0,G=p;U<J;U++){var z=G.lastChild;this.frontier.push({type:z.type,match:z.contentMatchAt(z.childCount)}),G=z.content}this.unplaced=W?e==0?d.empty:new d(nt(f.content,e-1,1),e-1,J<0?f.openEnd:e-1):new d(nt(f.content,e,h),f.openStart,f.openEnd)};F.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock)return-1;var t=this.frontier[this.depth],e;if(!t.type.isTextblock||!zt(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;for(var r=this.$to,i=r.depth,o=this.$to.after(i);i>1&&o==this.$to.end(--i);)++o;return o};F.prototype.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var r=this.frontier[e],i=r.match,o=r.type,a=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=zt(t,e,o,i,a);if(!!s){for(var f=e-1;f>=0;f--){var p=this.frontier[f],u=p.match,h=p.type,l=zt(t,f,h,u,!0);if(!l||l.childCount)continue t}return{depth:e,fit:s,move:a?t.doc.resolve(t.after(e+1)):t}}}};F.prototype.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=ot(this.placed,e.depth,e.fit)),t=e.move;for(var r=e.depth+1;r<=t.depth;r++){var i=t.node(r),o=i.type.contentMatch.fillBefore(i.content,!0,t.index(r));this.openFrontierNode(i.type,i.attrs,o)}return t};F.prototype.openFrontierNode=function(t,e,r){var i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=ot(this.placed,this.depth,c.from(t.create(e,r))),this.frontier.push({type:t,match:t.contentMatch})};F.prototype.closeFrontierNode=function(){var t=this.frontier.pop(),e=t.match.fillBefore(c.empty,!0);e.childCount&&(this.placed=ot(this.placed,this.frontier.length,e))};Object.defineProperties(F.prototype,Ee);function nt(n,t,e){return t==0?n.cutByIndex(e):n.replaceChild(0,n.firstChild.copy(nt(n.firstChild.content,t-1,e)))}function ot(n,t,e){return t==0?n.append(e):n.replaceChild(n.childCount-1,n.lastChild.copy(ot(n.lastChild.content,t-1,e)))}function Bt(n,t){for(var e=0;e<t;e++)n=n.firstChild.content;return n}function Ne(n,t,e){if(t<=0)return n;var r=n.content;return t>1&&(r=r.replaceChild(0,Ne(r.firstChild,t-1,r.childCount==1?e-1:0))),t>0&&(r=n.type.contentMatch.fillBefore(r).append(r),e<=0&&(r=r.append(n.type.contentMatch.matchFragment(r).fillBefore(c.empty,!0)))),n.copy(r)}function zt(n,t,e,r,i){var o=n.node(t),a=i?n.indexAfter(t):n.index(t);if(a==o.childCount&&!e.compatibleContent(o.type))return null;var s=r.fillBefore(o.content,!0,a);return s&&!Pr(e,o.content,a)?s:null}function Pr(n,t,e){for(var r=e;r<t.childCount;r++)if(!n.allowsMarks(t.child(r).marks))return!0;return!1}function Dr(n){return n.spec.defining||n.spec.definingForContent}b.prototype.replaceRange=function(n,t,e){if(!e.size)return this.deleteRange(n,t);var r=this.doc.resolve(n),i=this.doc.resolve(t);if(Te(r,i,e))return this.step(new Z(n,t,e));var o=Ie(r,this.doc.resolve(t));o[o.length-1]==0&&o.pop();var a=-(r.depth+1);o.unshift(a);for(var s=r.depth,f=r.pos-1;s>0;s--,f--){var p=r.node(s).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(s)>-1?a=s:r.before(s)==f&&o.splice(1,0,-s)}for(var u=o.indexOf(a),h=[],l=e.openStart,v=e.content,g=0;;g++){var x=v.firstChild;if(h.push(x),g==e.openStart)break;v=x.content}for(var k=l-1;k>=0;k--){var J=h[k].type,P=Dr(J);if(P&&r.node(u).type!=J)l=k;else if(P||!J.isTextblock)break}for(var j=e.openStart;j>=0;j--){var W=(j+l+1)%(e.openStart+1),U=h[W];if(!!U)for(var G=0;G<o.length;G++){var z=o[(G+u)%o.length],qt=!0;z<0&&(qt=!1,z=-z);var Je=r.node(z-1),Wt=r.index(z-1);if(Je.canReplaceWith(Wt,Wt,U.type,U.marks))return this.replace(r.before(z),qt?i.after(z):t,new d(Re(e.content,0,e.openStart,W),W,e.openEnd))}}for(var Be=this.steps.length,gt=o.length-1;gt>=0&&(this.replace(n,t,e),!(this.steps.length>Be));gt--){var xt=o[gt];xt<0||(n=r.before(xt),t=i.after(xt))}return this};function Re(n,t,e,r,i){if(t<e){var o=n.firstChild;n=n.replaceChild(0,o.copy(Re(o.content,t+1,e,r,o)))}if(t>r){var a=i.contentMatchAt(0),s=a.fillBefore(n).append(n);n=s.append(a.matchFragment(s).fillBefore(c.empty,!0))}return n}b.prototype.replaceRangeWith=function(n,t,e){if(!e.isInline&&n==t&&this.doc.resolve(n).parent.content.size){var r=Br(this.doc,n,e.type);r!=null&&(n=t=r)}return this.replaceRange(n,t,new d(c.from(e),0,0))};b.prototype.deleteRange=function(n,t){for(var e=this.doc.resolve(n),r=this.doc.resolve(t),i=Ie(e,r),o=0;o<i.length;o++){var a=i[o],s=o==i.length-1;if(s&&a==0||e.node(a).type.contentMatch.validEnd)return this.delete(e.start(a),r.end(a));if(a>0&&(s||e.node(a-1).canReplace(e.index(a-1),r.indexAfter(a-1))))return this.delete(e.before(a),r.after(a))}for(var f=1;f<=e.depth&&f<=r.depth;f++)if(n-e.start(f)==e.depth-f&&t>e.end(f)&&r.end(f)-t!=r.depth-f)return this.delete(e.before(f),t);return this.delete(n,t)};function Ie(n,t){for(var e=[],r=Math.min(n.depth,t.depth),i=r;i>=0;i--){var o=n.start(i);if(o<n.pos-(n.depth-i)||t.end(i)>t.pos+(t.depth-i)||n.node(i).type.spec.isolating||t.node(i).type.spec.isolating)break;(o==t.start(i)||i==n.depth&&i==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&i&&t.start(i-1)==o-1)&&e.push(i)}return e}function yt(n){return{type:"doc",content:n}}function _t(n){return{type:"mention",attrs:{variable:{id:n}}}}function Pt(n){return{type:"paragraph",content:n}}function fi(n){return yt([Pt([_t(n)])])}function ze(n){let t=n===""?void 0:[Dt(n)];return yt([{type:"paragraph",...t?{content:t}:void 0}])}function Dt(n){return{type:"text",text:n}}function li(n,t){if(n==null)return ze(t);let e=B.nodeFromJSON(n),r=B.text(t),i=e.firstChild;return new b(i).insert(i.content.size,r).doc.toJSON()}function at(n,t){return n.type==="mention"?t(n):n.content!=null?{...n,content:n.content.flatMap(e=>at(e,t))}:n}function gi(n,t){let e=B.nodeFromJSON(n),r=B.text(t),i=e.firstChild;return new b(i).insert(0,r).doc.toJSON()}function wi(n,t){return n==null?null:at(n,e=>{let r=e.attrs.variable.id,i=t.find(o=>o.id===r);return[{...e,attrs:{variable:i}}]})}import{getText as Ae}from"@tiptap/core";function Ti(n,t=!1){let e=`

`,r=B.nodeFromJSON(n),i=Lr(B);return t?Ae(r,{blockSeparator:e,textSerializers:i}):Ae(r,{blockSeparator:e,textSerializers:{...i,mention:o=>o.node.attrs.value==null?"":i.mention(o)}})}function Lr(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}import{generateHTML as qr}from"@tiptap/html";function Ii(n){return qr(n,St)}function Fi(n){return n==null?null:at(n,t=>[{...t,attrs:{variable:{id:t.attrs.variable.id}}}])}function _i(n){let t=n.split(/({{\w+}})/g).filter(e=>e!=="").map(e=>/^{{\w+}}$/.test(e)?_t(e.slice(2,-2)):Dt(e));return yt([Pt(t)])}function Di(n){return`${n.slice(0,1).toUpperCase()}${n.slice(1)}`}var Wr="ROLLOUTHQ_VARIABLE_";function qi(n){return n!=null&&n.startsWith(Wr)}function Hi(n){return t=>Hr(n,t)}function Hr(n,t){return n.safeParse(t).success}import{boolean as Ur,object as Gr,record as Xr,string as Yr,ZodOptional as Qr,union as Kr,literal as $r}from"zod";import{z as Vr}from"zod";var st=Vr.object({}).passthrough().refine(n=>{try{return B.nodeFromJSON(n),!0}catch{return!1}},{message:"Object is not valid RichEditorContent"}).transform(n=>n),Fe=Symbol("IS_Z_RICH_EDITOR_CONTENT");Object.assign(st._def,{[Fe]:!0});function Xi(n){return Fe in n._def}import{unreachableCase as Zr}from"ts-assert-unreachable";import{z as Lt}from"zod";function jr(n){return Lt.object(Object.fromEntries(n.map(t=>{if(t.type==="plainText")return[t.key,Lt.string()];if(t.type==="dropdown")return[t.key,Lt.string()];if(t.type==="string")return[t.key,st];Zr(t.type)})))}var io={literal:$r,boolean:Ur,object:Gr,record:Xr,string:Yr,richEditorContent:st,union:Kr};function tn(n){return n instanceof Qr?tn(n.unwrap()):n}export{Kt as AnyBlockDocument,Gt as CURLY_BRACKETS_SYMBOL,Xt as CurlyBrackets,nn as EnterHandler,fn as EscHandler,Qt as FORMATTING_EXTENSIONS,Vt as Link,Zt as MENTION_SYMBOL,jt as Mention,Wr as ROLLOUTHQ_VARIABLE_PREFIX,St as SCHEMA_EXTENSIONS,Mn as ShiftEnterHandler,jn as SingleParagraphDocument,li as appendText,Di as capitalize,yt as createDocument,fi as createDocumentWithMention,_t as createMention,Pt as createParagraph,Ze as curlyBracketsConfig,_i as curlyTemplate,at as flatMapMentions,bn as getCurlyBracketsSuggestions,mn as getSuggestions,Lr as getTextSeralizersFromSchema,jr as inputDefToZodObject,qi as isVariable,Xi as isZRichEditorContent,qe as mentionConfig,Hr as passesValidation,ze as plainToRichText,gi as prependText,wi as resolveMentions,Ti as richTextToPlain,B as schema,Ii as toHTML,Dt as toTextNode,Fi as unresolveMentions,tn as unwrapOptional,io as z,st as zRichEditorContent,Hi as zodGuard};
//# sourceMappingURL=index.esm.js.map